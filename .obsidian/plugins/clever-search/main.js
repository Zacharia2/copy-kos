/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Dc=Object.create;var qn=Object.defineProperty;var qa=Object.getOwnPropertyDescriptor;var Lc=Object.getOwnPropertyNames;var Rc=Object.getPrototypeOf,Nc=Object.prototype.hasOwnProperty;var jc=(n,e)=>()=>(n&&(e=n(n=0)),e);var ee=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Ga=(n,e)=>{for(var t in e)qn(n,t,{get:e[t],enumerable:!0})},Xa=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Lc(e))!Nc.call(n,i)&&i!==t&&qn(n,i,{get:()=>e[i],enumerable:!(r=qa(e,i))||r.enumerable});return n};var ue=(n,e,t)=>(t=n!=null?Dc(Rc(n)):{},Xa(e||!n||!n.__esModule?qn(t,"default",{value:n,enumerable:!0}):t,n)),$r=n=>Xa(qn({},"__esModule",{value:!0}),n),B=(n,e,t,r)=>{for(var i=r>1?void 0:r?qa(e,t):e,s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=(r?o(e,t,i):o(i))||i);return r&&i&&qn(e,t,i),i},Wr=(n,e)=>(t,r)=>e(t,r,n);var Ur={};Ga(Ur,{__assign:()=>gs,__asyncDelegator:()=>Qc,__asyncGenerator:()=>Yc,__asyncValues:()=>Jc,__await:()=>Gn,__awaiter:()=>Wc,__classPrivateFieldGet:()=>nf,__classPrivateFieldSet:()=>rf,__createBinding:()=>Hc,__decorate:()=>Vc,__exportStar:()=>qc,__extends:()=>Bc,__generator:()=>Uc,__importDefault:()=>tf,__importStar:()=>ef,__makeTemplateObject:()=>Zc,__metadata:()=>$c,__param:()=>Kc,__read:()=>Qa,__rest:()=>zc,__spread:()=>Gc,__spreadArrays:()=>Xc,__values:()=>ys});function Bc(n,e){ms(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function zc(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function Vc(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}function Kc(n,e){return function(t,r){e(t,r,n)}}function $c(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function Wc(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?s(c.value):i(c.value).then(a,l)}u((r=r.apply(n,e||[])).next())})}function Uc(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(c){u=[6,c],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Hc(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}function qc(n,e){for(var t in n)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function ys(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Qa(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}function Gc(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(Qa(arguments[e]));return n}function Xc(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function Gn(n){return this instanceof Gn?(this.v=n,this):new Gn(n)}function Yc(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){r[f]&&(i[f]=function(d){return new Promise(function(p,m){s.push([f,d,p,m])>1||a(f,d)})})}function a(f,d){try{l(r[f](d))}catch(p){h(s[0][3],p)}}function l(f){f.value instanceof Gn?Promise.resolve(f.value.v).then(u,c):h(s[0][2],f)}function u(f){a("next",f)}function c(f){a("throw",f)}function h(f,d){f(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Qc(n){var e,t;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=n[i]?function(o){return(t=!t)?{value:Gn(n[i](o)),done:i==="return"}:s?s(o):o}:s}}function Jc(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof ys=="function"?ys(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,l){o=n[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(u){s({value:u,done:a})},o)}}function Zc(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}function ef(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)Object.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e.default=n,e}function tf(n){return n&&n.__esModule?n:{default:n}}function nf(n,e){if(!e.has(n))throw new TypeError("attempted to get private field on non-instance");return e.get(n)}function rf(n,e,t){if(!e.has(n))throw new TypeError("attempted to set private field on non-instance");return e.set(n,t),t}var ms,gs,Hr=jc(()=>{ms=function(n,e){return ms=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},ms(n,e)};gs=function(){return gs=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},gs.apply(this,arguments)}});var bs=ee(_s=>{"use strict";Object.defineProperty(_s,"__esModule",{value:!0});var vs;(function(n){n[n.Transient=0]="Transient",n[n.Singleton=1]="Singleton",n[n.ResolutionScoped=2]="ResolutionScoped",n[n.ContainerScoped=3]="ContainerScoped"})(vs||(vs={}));_s.default=vs});var Ja=ee(ws=>{"use strict";Object.defineProperty(ws,"__esModule",{value:!0});var sf=bs();Object.defineProperty(ws,"Lifecycle",{enumerable:!0,get:function(){return sf.default}})});var Xt=ee(Je=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});Je.defineInjectionTokenMetadata=Je.getParamInfo=Je.INJECTION_TOKEN_METADATA_KEY=void 0;Je.INJECTION_TOKEN_METADATA_KEY="injectionTokens";function of(n){let e=Reflect.getMetadata("design:paramtypes",n)||[],t=Reflect.getOwnMetadata(Je.INJECTION_TOKEN_METADATA_KEY,n)||{};return Object.keys(t).forEach(r=>{e[+r]=t[r]}),e}Je.getParamInfo=of;function af(n,e){return function(t,r,i){let s=Reflect.getOwnMetadata(Je.INJECTION_TOKEN_METADATA_KEY,t)||{};s[i]=e?{token:n,transform:e.transformToken,transformArgs:e.args||[]}:n,Reflect.defineMetadata(Je.INJECTION_TOKEN_METADATA_KEY,s,t)}}Je.defineInjectionTokenMetadata=af});var xs=ee(qr=>{"use strict";Object.defineProperty(qr,"__esModule",{value:!0});qr.isClassProvider=void 0;function lf(n){return!!n.useClass}qr.isClassProvider=lf});var Es=ee(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.isFactoryProvider=void 0;function uf(n){return!!n.useFactory}Gr.isFactoryProvider=uf});var Yr=ee(_n=>{"use strict";Object.defineProperty(_n,"__esModule",{value:!0});_n.delay=_n.DelayedConstructor=void 0;var Xr=class{constructor(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}createProxy(e){let t={},r=!1,i,s=()=>(r||(i=e(this.wrap()),r=!0),i);return new Proxy(t,this.createHandler(s))}createHandler(e){let t={},r=i=>{t[i]=(...s)=>{s[0]=e();let o=Reflect[i];return o(...s)}};return this.reflectMethods.forEach(r),t}};_n.DelayedConstructor=Xr;function cf(n){if(typeof n=="undefined")throw new Error("Attempt to `delay` undefined. Constructor must be wrapped in a callback");return new Xr(n)}_n.delay=cf});var Qr=ee(lt=>{"use strict";Object.defineProperty(lt,"__esModule",{value:!0});lt.isConstructorToken=lt.isTransformDescriptor=lt.isTokenDescriptor=lt.isNormalToken=void 0;var ff=Yr();function hf(n){return typeof n=="string"||typeof n=="symbol"}lt.isNormalToken=hf;function df(n){return typeof n=="object"&&"token"in n&&"multiple"in n}lt.isTokenDescriptor=df;function pf(n){return typeof n=="object"&&"token"in n&&"transform"in n}lt.isTransformDescriptor=pf;function mf(n){return typeof n=="function"||n instanceof ff.DelayedConstructor}lt.isConstructorToken=mf});var Ss=ee(Jr=>{"use strict";Object.defineProperty(Jr,"__esModule",{value:!0});Jr.isTokenProvider=void 0;function gf(n){return!!n.useToken}Jr.isTokenProvider=gf});var As=ee(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.isValueProvider=void 0;function yf(n){return n.useValue!=null}Zr.isValueProvider=yf});var Ts=ee(Yt=>{"use strict";Object.defineProperty(Yt,"__esModule",{value:!0});var vf=xs();Object.defineProperty(Yt,"isClassProvider",{enumerable:!0,get:function(){return vf.isClassProvider}});var _f=Es();Object.defineProperty(Yt,"isFactoryProvider",{enumerable:!0,get:function(){return _f.isFactoryProvider}});var bf=Qr();Object.defineProperty(Yt,"isNormalToken",{enumerable:!0,get:function(){return bf.isNormalToken}});var wf=Ss();Object.defineProperty(Yt,"isTokenProvider",{enumerable:!0,get:function(){return wf.isTokenProvider}});var xf=As();Object.defineProperty(Yt,"isValueProvider",{enumerable:!0,get:function(){return xf.isValueProvider}})});var Za=ee(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});ei.isProvider=void 0;var Ef=xs(),Sf=As(),Af=Ss(),Tf=Es();function Cf(n){return Ef.isClassProvider(n)||Sf.isValueProvider(n)||Af.isTokenProvider(n)||Tf.isFactoryProvider(n)}ei.isProvider=Cf});var Ps=ee(Fs=>{"use strict";Object.defineProperty(Fs,"__esModule",{value:!0});var Cs=class{constructor(){this._registryMap=new Map}entries(){return this._registryMap.entries()}getAll(e){return this.ensure(e),this._registryMap.get(e)}get(e){this.ensure(e);let t=this._registryMap.get(e);return t[t.length-1]||null}set(e,t){this.ensure(e),this._registryMap.get(e).push(t)}setAll(e,t){this._registryMap.set(e,t)}has(e){return this.ensure(e),this._registryMap.get(e).length>0}clear(){this._registryMap.clear()}ensure(e){this._registryMap.has(e)||this._registryMap.set(e,[])}};Fs.default=Cs});var el=ee(Ms=>{"use strict";Object.defineProperty(Ms,"__esModule",{value:!0});var Ff=Ps(),Is=class extends Ff.default{};Ms.default=Is});var tl=ee(ks=>{"use strict";Object.defineProperty(ks,"__esModule",{value:!0});var Os=class{constructor(){this.scopedResolutions=new Map}};ks.default=Os});var Ds=ee(ti=>{"use strict";Object.defineProperty(ti,"__esModule",{value:!0});ti.formatErrorCtor=void 0;function Pf(n,e){return n===null?`at position #${e}`:`"${n.split(",")[e].trim()}" at position #${e}`}function If(n,e,t="    "){return[n,...e.message.split(`
`).map(r=>t+r)].join(`
`)}function Mf(n,e,t){let[,r=null]=n.toString().match(/constructor\(([\w, ]+)\)/)||[],i=Pf(r,e);return If(`Cannot inject the dependency ${i} of "${n.name}" constructor. Reason:`,t)}ti.formatErrorCtor=Mf});var nl=ee(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.isDisposable=void 0;function Of(n){return!(typeof n.dispose!="function"||n.dispose.length>0)}ni.isDisposable=Of});var il=ee(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.PostResolutionInterceptors=Qt.PreResolutionInterceptors=void 0;var rl=Ps(),ri=class extends rl.default{};Qt.PreResolutionInterceptors=ri;var ii=class extends rl.default{};Qt.PostResolutionInterceptors=ii;var Ls=class{constructor(){this.preResolution=new ri,this.postResolution=new ii}};Qt.default=Ls});var Jt=ee(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.instance=pt.typeInfo=void 0;var kf=(Hr(),$r(Ur)),Ce=Ts(),Df=Za(),si=Qr(),Lf=el(),Oe=bs(),sl=tl(),Rf=Ds(),Nf=Yr(),jf=nl(),Bf=il();pt.typeInfo=new Map;var Xn=class{constructor(e){this.parent=e,this._registry=new Lf.default,this.interceptors=new Bf.default,this.disposed=!1,this.disposables=new Set}register(e,t,r={lifecycle:Oe.default.Transient}){this.ensureNotDisposed();let i;if(Df.isProvider(t)?i=t:i={useClass:t},Ce.isTokenProvider(i)){let s=[e],o=i;for(;o!=null;){let a=o.useToken;if(s.includes(a))throw new Error(`Token registration cycle detected! ${[...s,a].join(" -> ")}`);s.push(a);let l=this._registry.get(a);l&&Ce.isTokenProvider(l.provider)?o=l.provider:o=null}}if((r.lifecycle===Oe.default.Singleton||r.lifecycle==Oe.default.ContainerScoped||r.lifecycle==Oe.default.ResolutionScoped)&&(Ce.isValueProvider(i)||Ce.isFactoryProvider(i)))throw new Error(`Cannot use lifecycle "${Oe.default[r.lifecycle]}" with ValueProviders or FactoryProviders`);return this._registry.set(e,{provider:i,options:r}),this}registerType(e,t){return this.ensureNotDisposed(),Ce.isNormalToken(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})}registerInstance(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})}registerSingleton(e,t){if(this.ensureNotDisposed(),Ce.isNormalToken(e)){if(Ce.isNormalToken(t))return this.register(e,{useToken:t},{lifecycle:Oe.default.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:Oe.default.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}let r=e;return t&&!Ce.isNormalToken(t)&&(r=t),this.register(e,{useClass:r},{lifecycle:Oe.default.Singleton})}resolve(e,t=new sl.default){this.ensureNotDisposed();let r=this.getRegistration(e);if(!r&&Ce.isNormalToken(e))throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`);if(this.executePreResolutionInterceptor(e,"Single"),r){let i=this.resolveRegistration(r,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(si.isConstructorToken(e)){let i=this.construct(e,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")}executePreResolutionInterceptor(e,t){if(this.interceptors.preResolution.has(e)){let r=[];for(let i of this.interceptors.preResolution.getAll(e))i.options.frequency!="Once"&&r.push(i),i.callback(e,t);this.interceptors.preResolution.setAll(e,r)}}executePostResolutionInterceptor(e,t,r){if(this.interceptors.postResolution.has(e)){let i=[];for(let s of this.interceptors.postResolution.getAll(e))s.options.frequency!="Once"&&i.push(s),s.callback(e,t,r);this.interceptors.postResolution.setAll(e,i)}}resolveRegistration(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===Oe.default.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);let r=e.options.lifecycle===Oe.default.Singleton,i=e.options.lifecycle===Oe.default.ContainerScoped,s=r||i,o;return Ce.isValueProvider(e.provider)?o=e.provider.useValue:Ce.isTokenProvider(e.provider)?o=s?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):Ce.isClassProvider(e.provider)?o=s?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):Ce.isFactoryProvider(e.provider)?o=e.provider.useFactory(this):o=this.construct(e.provider,t),e.options.lifecycle===Oe.default.ResolutionScoped&&t.scopedResolutions.set(e,o),o}resolveAll(e,t=new sl.default){this.ensureNotDisposed();let r=this.getAllRegistrations(e);if(!r&&Ce.isNormalToken(e))throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`);if(this.executePreResolutionInterceptor(e,"All"),r){let s=r.map(o=>this.resolveRegistration(o,t));return this.executePostResolutionInterceptor(e,s,"All"),s}let i=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,i,"All"),i}isRegistered(e,t=!1){return this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)}reset(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()}clearInstances(){this.ensureNotDisposed();for(let[e,t]of this._registry.entries())this._registry.setAll(e,t.filter(r=>!Ce.isValueProvider(r.provider)).map(r=>(r.instance=void 0,r)))}createChildContainer(){this.ensureNotDisposed();let e=new Xn(this);for(let[t,r]of this._registry.entries())r.some(({options:i})=>i.lifecycle===Oe.default.ContainerScoped)&&e._registry.setAll(t,r.map(i=>i.options.lifecycle===Oe.default.ContainerScoped?{provider:i.provider,options:i.options}:i));return e}beforeResolution(e,t,r={frequency:"Always"}){this.interceptors.preResolution.set(e,{callback:t,options:r})}afterResolution(e,t,r={frequency:"Always"}){this.interceptors.postResolution.set(e,{callback:t,options:r})}dispose(){return kf.__awaiter(this,void 0,void 0,function*(){this.disposed=!0;let e=[];this.disposables.forEach(t=>{let r=t.dispose();r&&e.push(r)}),yield Promise.all(e)})}getRegistration(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null}getAllRegistrations(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null}construct(e,t){if(e instanceof Nf.DelayedConstructor)return e.createProxy(i=>this.resolve(i,t));let r=(()=>{let i=pt.typeInfo.get(e);if(!i||i.length===0){if(e.length===0)return new e;throw new Error(`TypeInfo not known for "${e.name}"`)}let s=i.map(this.resolveParams(t,e));return new e(...s)})();return jf.isDisposable(r)&&this.disposables.add(r),r}resolveParams(e,t){return(r,i)=>{try{return si.isTokenDescriptor(r)?si.isTransformDescriptor(r)?r.multiple?this.resolve(r.transform).transform(this.resolveAll(r.token),...r.transformArgs):this.resolve(r.transform).transform(this.resolve(r.token,e),...r.transformArgs):r.multiple?this.resolveAll(r.token):this.resolve(r.token,e):si.isTransformDescriptor(r)?this.resolve(r.transform,e).transform(this.resolve(r.token,e),...r.transformArgs):this.resolve(r,e)}catch(s){throw new Error(Rf.formatErrorCtor(t,i,s))}}}ensureNotDisposed(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")}};pt.instance=new Xn;pt.default=pt.instance});var ol=ee(Ns=>{"use strict";Object.defineProperty(Ns,"__esModule",{value:!0});var zf=Xt(),mt=Jt(),Rs=Qr(),Vf=Ds();function Kf(){return function(n){let e=zf.getParamInfo(n);return class extends n{constructor(...t){super(...t.concat(e.slice(t.length).map((r,i)=>{try{return Rs.isTokenDescriptor(r)?Rs.isTransformDescriptor(r)?r.multiple?mt.instance.resolve(r.transform).transform(mt.instance.resolveAll(r.token),...r.transformArgs):mt.instance.resolve(r.transform).transform(mt.instance.resolve(r.token),...r.transformArgs):r.multiple?mt.instance.resolveAll(r.token):mt.instance.resolve(r.token):Rs.isTransformDescriptor(r)?mt.instance.resolve(r.transform).transform(mt.instance.resolve(r.token),...r.transformArgs):mt.instance.resolve(r)}catch(s){let o=i+t.length;throw new Error(Vf.formatErrorCtor(n,o,s))}})))}}}}Ns.default=Kf});var al=ee(js=>{"use strict";Object.defineProperty(js,"__esModule",{value:!0});var $f=Xt();function Wf(n){return $f.defineInjectionTokenMetadata(n)}js.default=Wf});var oi=ee(Bs=>{"use strict";Object.defineProperty(Bs,"__esModule",{value:!0});var Uf=Xt(),Hf=Jt();function qf(){return function(n){Hf.typeInfo.set(n,Uf.getParamInfo(n))}}Bs.default=qf});var ll=ee(zs=>{"use strict";Object.defineProperty(zs,"__esModule",{value:!0});var Gf=(Hr(),$r(Ur)),Xf=Jt();function Yf(n=[]){return function(e){return n.forEach(t=>{var{token:r,options:i}=t,s=Gf.__rest(t,["token","options"]);return Xf.instance.register(r,s,i)}),e}}zs.default=Yf});var ul=ee(Vs=>{"use strict";Object.defineProperty(Vs,"__esModule",{value:!0});var Qf=oi(),Jf=Jt();function Zf(){return function(n){Qf.default()(n),Jf.instance.registerSingleton(n)}}Vs.default=Zf});var cl=ee(Ks=>{"use strict";Object.defineProperty(Ks,"__esModule",{value:!0});var eh=Xt();function th(n){let e={token:n,multiple:!0};return eh.defineInjectionTokenMetadata(e)}Ks.default=th});var fl=ee($s=>{"use strict";Object.defineProperty($s,"__esModule",{value:!0});var nh=Xt();function rh(n,e,...t){let r={token:n,multiple:!0,transform:e,transformArgs:t};return nh.defineInjectionTokenMetadata(r)}$s.default=rh});var hl=ee(Ws=>{"use strict";Object.defineProperty(Ws,"__esModule",{value:!0});var ih=Xt();function sh(n,e,...t){return ih.defineInjectionTokenMetadata(n,{transformToken:e,args:t})}Ws.default=sh});var dl=ee(Us=>{"use strict";Object.defineProperty(Us,"__esModule",{value:!0});var oh=oi(),ah=Jt();function lh(n,e){return function(t){oh.default()(t),ah.instance.register(e||t,t,{lifecycle:n})}}Us.default=lh});var pl=ee(Ze=>{"use strict";Object.defineProperty(Ze,"__esModule",{value:!0});var uh=ol();Object.defineProperty(Ze,"autoInjectable",{enumerable:!0,get:function(){return uh.default}});var ch=al();Object.defineProperty(Ze,"inject",{enumerable:!0,get:function(){return ch.default}});var fh=oi();Object.defineProperty(Ze,"injectable",{enumerable:!0,get:function(){return fh.default}});var hh=ll();Object.defineProperty(Ze,"registry",{enumerable:!0,get:function(){return hh.default}});var dh=ul();Object.defineProperty(Ze,"singleton",{enumerable:!0,get:function(){return dh.default}});var ph=cl();Object.defineProperty(Ze,"injectAll",{enumerable:!0,get:function(){return ph.default}});var mh=fl();Object.defineProperty(Ze,"injectAllWithTransform",{enumerable:!0,get:function(){return mh.default}});var gh=hl();Object.defineProperty(Ze,"injectWithTransform",{enumerable:!0,get:function(){return gh.default}});var yh=dl();Object.defineProperty(Ze,"scoped",{enumerable:!0,get:function(){return yh.default}})});var ml=ee(Hs=>{"use strict";Object.defineProperty(Hs,"__esModule",{value:!0});function vh(n){let e;return t=>(e==null&&(e=n(t)),e)}Hs.default=vh});var gl=ee(qs=>{"use strict";Object.defineProperty(qs,"__esModule",{value:!0});function _h(n){let e=new WeakMap;return t=>{let r=e.get(t);return r==null&&(r=n(t),e.set(t,r)),r}}qs.default=_h});var yl=ee(Gs=>{"use strict";Object.defineProperty(Gs,"__esModule",{value:!0});function bh(n,e,t,r=!0){let i,s;return o=>{let a=n(o);return(!r||s!==a)&&((s=a)?i=o.resolve(e):i=o.resolve(t)),i}}Gs.default=bh});var vl=ee(Yn=>{"use strict";Object.defineProperty(Yn,"__esModule",{value:!0});var wh=ml();Object.defineProperty(Yn,"instanceCachingFactory",{enumerable:!0,get:function(){return wh.default}});var xh=gl();Object.defineProperty(Yn,"instancePerContainerCachingFactory",{enumerable:!0,get:function(){return xh.default}});var Eh=yl();Object.defineProperty(Yn,"predicateAwareClassFactory",{enumerable:!0,get:function(){return Eh.default}})});var fe=ee(Mt=>{"use strict";Object.defineProperty(Mt,"__esModule",{value:!0});var Xs=(Hr(),$r(Ur));if(typeof Reflect=="undefined"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var Sh=Ja();Object.defineProperty(Mt,"Lifecycle",{enumerable:!0,get:function(){return Sh.Lifecycle}});Xs.__exportStar(pl(),Mt);Xs.__exportStar(vl(),Mt);Xs.__exportStar(Ts(),Mt);var Ah=Yr();Object.defineProperty(Mt,"delay",{enumerable:!0,get:function(){return Ah.delay}});var Th=Jt();Object.defineProperty(Mt,"container",{enumerable:!0,get:function(){return Th.instance}})});var wm={};Ga(wm,{RenderMarkdownModal:()=>es,default:()=>Un});module.exports=$r(wm);var pe=require("obsidian");var Ya;(function(n){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),r=i(n);typeof t.Reflect=="undefined"?t.Reflect=n:r=i(t.Reflect,r),e(r);function i(s,o){return function(a,l){typeof s[a]!="function"&&Object.defineProperty(s,a,{configurable:!0,writable:!0,value:l}),o&&o(a,l)}}})(function(e){var t=Object.prototype.hasOwnProperty,r=typeof Symbol=="function",i=r&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",s=r&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",a={__proto__:[]}instanceof Array,l=!o&&!a,u={create:o?function(){return ps(Object.create(null))}:a?function(){return ps({__proto__:null})}:function(){return ps({})},has:l?function(v,E){return t.call(v,E)}:function(v,E){return E in v},get:l?function(v,E){return t.call(v,E)?v[E]:void 0}:function(v,E){return v[E]}},c=Object.getPrototypeOf(Function),h=typeof process=="object"&&process["env"]&&process["env"].REFLECT_METADATA_USE_MAP_POLYFILL==="true",f=!h&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Pt(),d=!h&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:vn(),p=!h&&typeof WeakMap=="function"?WeakMap:Gt(),m=new p;function y(v,E,C,O){if(M(C)){if(!zr(v))throw new TypeError;if(!Vr(E))throw new TypeError;return j(v,E)}else{if(!zr(v))throw new TypeError;if(!q(E))throw new TypeError;if(!q(O)&&!M(O)&&!L(O))throw new TypeError;return L(O)&&(O=void 0),C=Ue(C),I(v,E,C,O)}}e("decorate",y);function g(v,E){function C(O,V){if(!q(O))throw new TypeError;if(!M(V)&&!hs(V))throw new TypeError;Z(v,E,O,V)}return C}e("metadata",g);function _(v,E,C,O){if(!q(C))throw new TypeError;return M(O)||(O=Ue(O)),Z(v,E,C,O)}e("defineMetadata",_);function w(v,E,C){if(!q(E))throw new TypeError;return M(C)||(C=Ue(C)),D(v,E,C)}e("hasMetadata",w);function b(v,E,C){if(!q(E))throw new TypeError;return M(C)||(C=Ue(C)),z(v,E,C)}e("hasOwnMetadata",b);function S(v,E,C){if(!q(E))throw new TypeError;return M(C)||(C=Ue(C)),J(v,E,C)}e("getMetadata",S);function A(v,E,C){if(!q(E))throw new TypeError;return M(C)||(C=Ue(C)),X(v,E,C)}e("getOwnMetadata",A);function T(v,E){if(!q(v))throw new TypeError;return M(E)||(E=Ue(E)),ne(v,E)}e("getMetadataKeys",T);function F(v,E){if(!q(v))throw new TypeError;return M(E)||(E=Ue(E)),de(v,E)}e("getOwnMetadataKeys",F);function k(v,E,C){if(!q(E))throw new TypeError;M(C)||(C=Ue(C));var O=N(E,C,!1);if(M(O)||!O.delete(v))return!1;if(O.size>0)return!0;var V=m.get(E);return V.delete(C),V.size>0||m.delete(E),!0}e("deleteMetadata",k);function j(v,E){for(var C=v.length-1;C>=0;--C){var O=v[C],V=O(E);if(!M(V)&&!L(V)){if(!Vr(V))throw new TypeError;E=V}}return E}function I(v,E,C,O){for(var V=v.length-1;V>=0;--V){var be=v[V],G=be(E,C,O);if(!M(G)&&!L(G)){if(!q(G))throw new TypeError;O=G}}return O}function N(v,E,C){var O=m.get(v);if(M(O)){if(!C)return;O=new f,m.set(v,O)}var V=O.get(E);if(M(V)){if(!C)return;V=new f,O.set(E,V)}return V}function D(v,E,C){var O=z(v,E,C);if(O)return!0;var V=dt(E);return L(V)?!1:D(v,V,C)}function z(v,E,C){var O=N(E,C,!1);return M(O)?!1:at(O.has(v))}function J(v,E,C){var O=z(v,E,C);if(O)return X(v,E,C);var V=dt(E);if(!L(V))return J(v,V,C)}function X(v,E,C){var O=N(E,C,!1);if(!M(O))return O.get(v)}function Z(v,E,C,O){var V=N(C,O,!0);V.set(v,E)}function ne(v,E){var C=de(v,E),O=dt(v);if(O===null)return C;var V=ne(O,E);if(V.length<=0)return C;if(C.length<=0)return V;for(var be=new d,G=[],Q=0,$=C;Q<$.length;Q++){var re=$[Q],ie=be.has(re);ie||(be.add(re),G.push(re))}for(var It=0,Ha=V;It<Ha.length;It++){var re=Ha[It],ie=be.has(re);ie||(be.add(re),G.push(re))}return G}function de(v,E){var C=[],O=N(v,E,!1);if(M(O))return C;for(var V=O.keys(),be=Qe(V),G=0;;){var Q=Kr(be);if(!Q)return C.length=G,C;var $=ds(Q);try{C[G]=$}catch(re){try{Ft(be)}finally{throw re}}G++}}function ot(v){if(v===null)return 1;switch(typeof v){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return v===null?1:6;default:return 6}}function M(v){return v===void 0}function L(v){return v===null}function H(v){return typeof v=="symbol"}function q(v){return typeof v=="object"?v!==null:typeof v=="function"}function Me(v,E){switch(ot(v)){case 0:return v;case 1:return v;case 2:return v;case 3:return v;case 4:return v;case 5:return v}var C=E===3?"string":E===5?"number":"default",O=yn(v,i);if(O!==void 0){var V=O.call(v,C);if(q(V))throw new TypeError;return V}return Ne(v,C==="default"?"number":C)}function Ne(v,E){if(E==="string"){var C=v.toString;if(Ct(C)){var O=C.call(v);if(!q(O))return O}var V=v.valueOf;if(Ct(V)){var O=V.call(v);if(!q(O))return O}}else{var V=v.valueOf;if(Ct(V)){var O=V.call(v);if(!q(O))return O}var be=v.toString;if(Ct(be)){var O=be.call(v);if(!q(O))return O}}throw new TypeError}function at(v){return!!v}function je(v){return""+v}function Ue(v){var E=Me(v,3);return H(E)?E:je(E)}function zr(v){return Array.isArray?Array.isArray(v):v instanceof Object?v instanceof Array:Object.prototype.toString.call(v)==="[object Array]"}function Ct(v){return typeof v=="function"}function Vr(v){return typeof v=="function"}function hs(v){switch(ot(v)){case 3:return!0;case 4:return!0;default:return!1}}function yn(v,E){var C=v[E];if(C!=null){if(!Ct(C))throw new TypeError;return C}}function Qe(v){var E=yn(v,s);if(!Ct(E))throw new TypeError;var C=E.call(v);if(!q(C))throw new TypeError;return C}function ds(v){return v.value}function Kr(v){var E=v.next();return E.done?!1:E}function Ft(v){var E=v.return;E&&E.call(v)}function dt(v){var E=Object.getPrototypeOf(v);if(typeof v!="function"||v===c||E!==c)return E;var C=v.prototype,O=C&&Object.getPrototypeOf(C);if(O==null||O===Object.prototype)return E;var V=O.constructor;return typeof V!="function"||V===v?E:V}function Pt(){var v={},E=[],C=function(){function G(Q,$,re){this._index=0,this._keys=Q,this._values=$,this._selector=re}return G.prototype["@@iterator"]=function(){return this},G.prototype[s]=function(){return this},G.prototype.next=function(){var Q=this._index;if(Q>=0&&Q<this._keys.length){var $=this._selector(this._keys[Q],this._values[Q]);return Q+1>=this._keys.length?(this._index=-1,this._keys=E,this._values=E):this._index++,{value:$,done:!1}}return{value:void 0,done:!0}},G.prototype.throw=function(Q){throw this._index>=0&&(this._index=-1,this._keys=E,this._values=E),Q},G.prototype.return=function(Q){return this._index>=0&&(this._index=-1,this._keys=E,this._values=E),{value:Q,done:!0}},G}();return function(){function G(){this._keys=[],this._values=[],this._cacheKey=v,this._cacheIndex=-2}return Object.defineProperty(G.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),G.prototype.has=function(Q){return this._find(Q,!1)>=0},G.prototype.get=function(Q){var $=this._find(Q,!1);return $>=0?this._values[$]:void 0},G.prototype.set=function(Q,$){var re=this._find(Q,!0);return this._values[re]=$,this},G.prototype.delete=function(Q){var $=this._find(Q,!1);if($>=0){for(var re=this._keys.length,ie=$+1;ie<re;ie++)this._keys[ie-1]=this._keys[ie],this._values[ie-1]=this._values[ie];return this._keys.length--,this._values.length--,Q===this._cacheKey&&(this._cacheKey=v,this._cacheIndex=-2),!0}return!1},G.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=v,this._cacheIndex=-2},G.prototype.keys=function(){return new C(this._keys,this._values,O)},G.prototype.values=function(){return new C(this._keys,this._values,V)},G.prototype.entries=function(){return new C(this._keys,this._values,be)},G.prototype["@@iterator"]=function(){return this.entries()},G.prototype[s]=function(){return this.entries()},G.prototype._find=function(Q,$){return this._cacheKey!==Q&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Q)),this._cacheIndex<0&&$&&(this._cacheIndex=this._keys.length,this._keys.push(Q),this._values.push(void 0)),this._cacheIndex},G}();function O(G,Q){return G}function V(G,Q){return Q}function be(G,Q){return[G,Q]}}function vn(){return function(){function v(){this._map=new f}return Object.defineProperty(v.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),v.prototype.has=function(E){return this._map.has(E)},v.prototype.add=function(E){return this._map.set(E,E),this},v.prototype.delete=function(E){return this._map.delete(E)},v.prototype.clear=function(){this._map.clear()},v.prototype.keys=function(){return this._map.keys()},v.prototype.values=function(){return this._map.values()},v.prototype.entries=function(){return this._map.entries()},v.prototype["@@iterator"]=function(){return this.keys()},v.prototype[s]=function(){return this.keys()},v}()}function Gt(){var v=16,E=u.create(),C=O();return function(){function $(){this._key=O()}return $.prototype.has=function(re){var ie=V(re,!1);return ie!==void 0?u.has(ie,this._key):!1},$.prototype.get=function(re){var ie=V(re,!1);return ie!==void 0?u.get(ie,this._key):void 0},$.prototype.set=function(re,ie){var It=V(re,!0);return It[this._key]=ie,this},$.prototype.delete=function(re){var ie=V(re,!1);return ie!==void 0?delete ie[this._key]:!1},$.prototype.clear=function(){this._key=O()},$}();function O(){var $;do $="@@WeakMap@@"+Q();while(u.has(E,$));return E[$]=!0,$}function V($,re){if(!t.call($,C)){if(!re)return;Object.defineProperty($,C,{value:u.create()})}return $[C]}function be($,re){for(var ie=0;ie<re;++ie)$[ie]=Math.random()*255|0;return $}function G($){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array($)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array($)):be(new Uint8Array($),$):be(new Array($),$)}function Q(){var $=G(v);$[6]=$[6]&79|64,$[8]=$[8]&191|128;for(var re="",ie=0;ie<v;++ie){var It=$[ie];(ie===4||ie===6||ie===8)&&(re+="-"),It<16&&(re+="0"),re+=It.toString(16).toLowerCase()}return re}}function ps(v){return v.__=void 0,delete v.__,v}})})(Ya||(Ya={}));var fs=ue(fe());var et="CleverSearch",Ys='"\u25B6"',Qs='"\u25BC"';var Js="&nbsp;&nbsp;&nbsp;&nbsp;";var Oh={},xe,_l=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});_l.decode();var ai=null;function ci(){return(ai===null||ai.buffer!==xe.memory.buffer)&&(ai=new Uint8Array(xe.memory.buffer)),ai}function Zs(n,e){return _l.decode(ci().subarray(n,n+e))}var gt=new Array(32).fill(void 0);gt.push(void 0,null,!0,!1);var Zn=gt.length;function Qn(n){Zn===gt.length&&gt.push(gt.length+1);let e=Zn;return Zn=gt[e],gt[e]=n,e}function fi(n){return gt[n]}function Ch(n){n<36||(gt[n]=Zn,Zn=n)}function Jn(n){let e=fi(n);return Ch(n),e}function eo(n){let e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){let i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){let i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){let i=n.length,s="[";i>0&&(s+=eo(n[0]));for(let o=1;o<i;o++)s+=", "+eo(n[o]);return s+="]",s}let t=/\[object ([^\]]+)\]/.exec(toString.call(n)),r;if(t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch(i){return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}var di=0,hi=new TextEncoder("utf-8"),Fh=typeof hi.encodeInto=="function"?function(n,e){return hi.encodeInto(n,e)}:function(n,e){let t=hi.encode(n);return e.set(t),{read:n.length,written:t.length}};function bl(n,e,t){if(t===void 0){let a=hi.encode(n),l=e(a.length);return ci().subarray(l,l+a.length).set(a),di=a.length,l}let r=n.length,i=e(r),s=ci(),o=0;for(;o<r;o++){let a=n.charCodeAt(o);if(a>127)break;s[i+o]=a}if(o!==r){o!==0&&(n=n.slice(o)),i=t(i,r,r=o+n.length*3);let a=ci().subarray(i+o,i+r),l=Fh(n,a);o+=l.written}return di=o,i}var li=null;function pi(){return(li===null||li.buffer!==xe.memory.buffer)&&(li=new Int32Array(xe.memory.buffer)),li}var ui=null;function Ph(){return(ui===null||ui.buffer!==xe.memory.buffer)&&(ui=new Uint32Array(xe.memory.buffer)),ui}function Ih(n,e){let r=Ph().subarray(n/4,n/4+e),i=[];for(let s=0;s<r.length;s++)i.push(Jn(r[s]));return i}function to(n,e){try{let a=xe.__wbindgen_add_to_stack_pointer(-16);var t=bl(n,xe.__wbindgen_malloc,xe.__wbindgen_realloc),r=di;xe.cut_for_search(a,t,r,e);var i=pi()[a/4+0],s=pi()[a/4+1],o=Ih(i,s).slice();return xe.__wbindgen_free(i,s*4),o}finally{xe.__wbindgen_add_to_stack_pointer(16)}}async function Mh(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}let t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{let t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}async function wl(n){typeof n=="undefined"&&(n=new URL("jieba_rs_wasm_bg.wasm",Oh.url));let e={};e.wbg={},e.wbg.__wbindgen_string_new=function(i,s){var o=Zs(i,s);return Qn(o)},e.wbg.__wbindgen_object_drop_ref=function(i){Jn(i)},e.wbg.__wbg_new_68adb0d58759a4ed=function(){var i=new Object;return Qn(i)},e.wbg.__wbindgen_number_new=function(i){var s=i;return Qn(s)},e.wbg.__wbg_set_2e79e744454afade=function(i,s,o){fi(i)[Jn(s)]=Jn(o)},e.wbg.__wbindgen_object_clone_ref=function(i){var s=fi(i);return Qn(s)},e.wbg.__wbg_new_7031805939a80203=function(i,s){var o=new Error(Zs(i,s));return Qn(o)},e.wbg.__wbindgen_debug_string=function(i,s){var o=eo(fi(s)),a=bl(o,xe.__wbindgen_malloc,xe.__wbindgen_realloc),l=di;pi()[i/4+1]=l,pi()[i/4+0]=a},e.wbg.__wbindgen_throw=function(i,s){throw new Error(Zs(i,s))},e.wbg.__wbindgen_rethrow=function(i){throw Jn(i)},(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));let{instance:t,module:r}=await Mh(await n,e);return xe=t.exports,wl.__wbindgen_wasm_module=r,xe}var xl=wl;var er=(r=>(r.other="Other Language",r.en="English",r.zh="\u7B80\u4F53\u4E2D\u6587",r))(er||{});var El=ue(fe());var tr={traceLog:!1,loadIndexFromDatabase:!0};var no=class{constructor(){this.logLevel="debug";this.levelWeights={trace:1,debug:2,info:3,warn:4,error:5,none:6}}getLevel(){return this.logLevel}setLevel(e){this.logLevel=e}trace(...e){this.shouldLog("trace")&&(tr.traceLog?(console.groupCollapsed(`%c[trace] ${this.getCallerName()}
`,"color: #5f6368;font-weight: 400;",...e),console.trace(),console.groupEnd()):console.log(`%c[trace] ${this.getCallerName()}
`,"color: #5f6368;",...e))}debug(...e){this.shouldLog("debug")&&(tr.traceLog?(console.groupCollapsed(`%c[debug] ${this.getCallerName()}
`,"color: #379237;font-weight: 400;",...e),console.trace(),console.groupEnd()):console.debug(`%c[debug] ${this.getCallerName()}
`,"color: #379237",...e))}info(...e){this.shouldLog("info")&&console.info(`%c[info] ${this.getCallerName()}
`,"color: blue;",...e)}warn(...e){this.shouldLog("warn")&&console.warn(`%c[warn] ${this.getCallerName()}
`,"color: orange;",...e)}error(...e){this.shouldLog("error")&&console.error(`%c[error] ${this.getCallerName()}
`,"color: red;",...e)}getCallerName(){var i;let e=(i=new Error().stack)==null?void 0:i.split(`
`),t=e==null?void 0:e.slice(3).find(s=>!s.includes("eval")&&!s.includes("Array.map"));if(t!=null&&t.startsWith("    at blob:"))return"child-thread";let r=t==null?void 0:t.match(/at (\S+)/);return r?`<${r[1]}> `:"failed to parse caller"}shouldLog(e){return this.levelWeights[e]>=this.levelWeights[this.logLevel]}},P=new no;var yt=!1,bn="This branch hasn't been implemented",Sl="this branch shouldn't be reached by design",io=/Mac|iPod|iPhone|iPad/.test(navigator.userAgent)?"Mod":"Ctrl",ut=class{static extractDomainFromHttpsUrl(e){if(e.startsWith("http://"))return P.error("Only support https, current url starts with http"),"";let t=/^(https?:\/\/)?([\w.-]+)(?:\/|$)/,r=e.match(t);return r&&r[2]?r[2]:""}static append(e,t){for(let r of t)e.push(r);return e}static mergeDeep(e,...t){if(!t.length)return e;let r=t.shift();if(ro(e)&&ro(r))for(let i in r)ro(r[i])?(e[i]||Object.assign(e,{[i]:{}}),ut.mergeDeep(e[i],r[i])):Object.assign(e,{[i]:r[i]});return ut.mergeDeep(e,...t)}static getCurrLanguage(){let e=window.localStorage.getItem("language")||"en";return e in er?er[e]:"Other Language"}static sleep(e){return new Promise(t=>setTimeout(t,e))}};function Ee(n,e,t){let r=t.value;return t.value=function(...i){let s=Date.now(),o=r.apply(this,i),a=()=>{let l=Date.now();P.trace(`<${n.constructor.name}-${e}> Execution time: ${kh(l-s)}`)};return o instanceof Promise?o.then(l=>(a(),l)):(a(),o)},t}function kh(n){if(n<1e3)return`${n} ms`;if(n<6e4){let e=Math.floor(n/1e3),t=n%1e3;return`${e} s ${t} ms`}else{let e=Math.floor(n/6e4),t=Math.floor(n%6e4/1e3),r=n%1e3;return`${e} min ${t} s ${r} ms`}}function x(n){try{return El.container.resolve(n)}catch(e){let t=`CleverSearch for developer:
There might be wrong usages for tsyringe:
1. Inject an instance for static field
2. Cycle dependencies without delay
3. Unknown error`;return P.warn(t),P.error(e),alert(t),-1}}function ro(n){return n&&typeof n=="object"&&!Array.isArray(n)}var se=class{},Al=window.localStorage.getItem("language")==="zh",Tl={customExtensions:{plaintext:["md"]},followObsidianExcludedFiles:!0,excludedPaths:[],logLevel:yt?"trace":"info",enableStopWordsEn:!0,enableChinesePatch:!!Al,enableStopWordsZh:!!Al,apiProvider1:{domain:"",key:""},apiProvider2:{domain:"",key:""},ui:{openInNewPane:!0,maxItemResults:30,floatingWindowForInFile:!0,showedExtension:"except md",collapseDevSettingByDefault:!yt,inFileFloatingWindowTop:"2.7em",inFileFloatingWindowLeft:"2.5em"}},Cl={search:{fuzzyProportion:.2,minTermLengthForPrefixSearch:2,weightFilename:3,weightFolder:2,weightTagText:1.15,weightHeading:1.27}};var Il=ue(fe());var Dh=ue(require("fs")),Lh=ue(require("path")),Fl=ue(fe());var wn=Dh,ke=Lh,ae=class{static getBasename(e){return ke.basename(e,ke.extname(e))}static getExtension(e){return ke.extname(e).slice(1)}static getFolderPath(e){let t=ke.dirname(e);return t==="."||t===ke.sep||t==="/"?"./":t.replace(new RegExp("\\"+ke.sep,"g"),"/")+"/"}static countFileByExtensions(e){let t=new Map;e.forEach(i=>{let s=i.extension||"no_extension";t.set(s,(t.get(s)||0)+1)});let r=Object.fromEntries(t);return P.trace(r),r}};ae.SPLIT_EOL=`
`,ae.JOIN_EOL=`
`,ae=B([(0,Fl.singleton)()],ae);var Pl=require("electron"),Rh=(Pl.app||Pl.remote.app).getPath("userData"),mi=ke.join(Rh,"clever-search"),Nh="https://bitbucket.org/alexclifton37/obsidian-clever-search/raw/dev/assets/for-program/",jh="https://raw.githubusercontent.com/yan42685/obsidian-clever-search/dev/assets/for-program/",Bh="https://unpkg.com/",wg=Bh+"@dqbd/tiktoken@1.0.7/tiktoken_bg.wasm",xg=ke.join(mi,"tiktoken_bg.wasm"),gi=ke.join(mi,"stop-words-en.txt"),so="jieba_rs_wasm_bg.wasm",oo="stop-words-en.txt",ao="stop-words-zh.txt",Be=class{constructor(){this.setting=x(se);this._assets=zh}get assets(){return this._assets}async initAsync(){P.trace("preparing assets..."),P.trace(`target dir: ${mi}`);try{await this.initHelper(Nh)}catch(e){try{await this.initHelper(jh),P.info("download successfully")}catch(t){throw P.warn("failed to download assets"),t}}}async initHelper(e){this.setting.enableChinesePatch&&(await this.downloadFile(this.targetPath(so),e+so),await this.downloadFile(this.targetPath(ao),e+ao),this._assets.jiebaBinary=wn.promises.readFile(this.targetPath(so)),this._assets.stopWordsZh=await this.readLinesAsSet(this.targetPath(ao))),await this.downloadFile(this.targetPath(oo),e+oo),this._assets.stopWordsEn=await this.readLinesAsSet(this.targetPath(oo))}targetPath(e){return ke.join(mi,e)}async readLinesAsSet(e){return new Set((await wn.promises.readFile(e,{encoding:"utf-8"})).split(ae.SPLIT_EOL))}async downloadFile(e,t){try{await wn.promises.access(e),P.trace("file exists:",e);return}catch(s){if(s.code!=="ENOENT")throw s}let r=ke.dirname(e);await wn.promises.mkdir(r,{recursive:!0}).catch(s=>{if(s.code!=="EEXIST")throw s});let i=await fetch(t);if(!i.ok)throw new Error(`unexpected response ${i.statusText}`);try{await wn.promises.writeFile(e,Buffer.from(await i.arrayBuffer()),"utf-8"),P.info(`successfully download from ${t}`)}catch(s){throw P.error(`failed to download ${t}`),s}}};Be=B([(0,Il.singleton)()],Be);var zh={stopWordsZh:null,stopWordsEn:null,jiebaBinary:new Promise(()=>null)};var Ml=ue(fe());var tt=class{constructor(){this.isReady=!1;this.reportedError=!1}async initAsync(){if(x(se).enableChinesePatch){let e=x(Be).assets.jiebaBinary;await xl(e),to("",!1),this.isReady=!0}}cut(e,t){return!this.isReady&&!this.reportedError?(P.error("jieba segmenter isn't ready"),this.reportedError=!0,[e]):to(e,t)}};tt=B([(0,Ml.singleton)()],tt);var ce=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,ge=Object.keys,Ae=Array.isArray;typeof Promise!="undefined"&&!ce.Promise&&(ce.Promise=Promise);function Pe(n,e){return typeof e!="object"||ge(e).forEach(function(t){n[t]=e[t]}),n}var ar=Object.getPrototypeOf,Vh={}.hasOwnProperty;function Ve(n,e){return Vh.call(n,e)}function Tn(n,e){typeof e=="function"&&(e=e(ar(n))),(typeof Reflect=="undefined"?ge:Reflect.ownKeys)(e).forEach(t=>{Et(n,t,e[t])})}var Wl=Object.defineProperty;function Et(n,e,t,r){Wl(n,e,Pe(t&&Ve(t,"get")&&typeof t.get=="function"?{get:t.get,set:t.set,configurable:!0}:{value:t,configurable:!0,writable:!0},r))}function Cn(n){return{from:function(e){return n.prototype=Object.create(e.prototype),Et(n.prototype,"constructor",n),{extend:Tn.bind(null,n.prototype)}}}}var Kh=Object.getOwnPropertyDescriptor;function $o(n,e){let t=Kh(n,e),r;return t||(r=ar(n))&&$o(r,e)}var $h=[].slice;function ji(n,e,t){return $h.call(n,e,t)}function Ul(n,e){return e(n)}function nr(n){if(!n)throw new Error("Assertion Failed")}function Hl(n){ce.setImmediate?setImmediate(n):setTimeout(n,0)}function ql(n,e){return n.reduce((t,r,i)=>{var s=e(r,i);return s&&(t[s[0]]=s[1]),t},{})}function Wh(n,e,t){try{n.apply(null,t)}catch(r){e&&e(r)}}function xt(n,e){if(Ve(n,e))return n[e];if(!e)return n;if(typeof e!="string"){for(var t=[],r=0,i=e.length;r<i;++r){var s=xt(n,e[r]);t.push(s)}return t}var o=e.indexOf(".");if(o!==-1){var a=n[e.substr(0,o)];return a===void 0?void 0:xt(a,e.substr(o+1))}}function nt(n,e,t){if(!(!n||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(n)))if(typeof e!="string"&&"length"in e){nr(typeof t!="string"&&"length"in t);for(var r=0,i=e.length;r<i;++r)nt(n,e[r],t[r])}else{var s=e.indexOf(".");if(s!==-1){var o=e.substr(0,s),a=e.substr(s+1);if(a==="")t===void 0?Ae(n)&&!isNaN(parseInt(o))?n.splice(o,1):delete n[o]:n[o]=t;else{var l=n[o];(!l||!Ve(n,o))&&(l=n[o]={}),nt(l,a,t)}}else t===void 0?Ae(n)&&!isNaN(parseInt(e))?n.splice(e,1):delete n[e]:n[e]=t}}function Uh(n,e){typeof e=="string"?nt(n,e,void 0):"length"in e&&[].map.call(e,function(t){nt(n,t,void 0)})}function Gl(n){var e={};for(var t in n)Ve(n,t)&&(e[t]=n[t]);return e}var Hh=[].concat;function Xl(n){return Hh.apply([],n)}var Yl="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Xl([8,16,32,64].map(n=>["Int","Uint","Float"].map(e=>e+n+"Array")))).filter(n=>ce[n]),qh=Yl.map(n=>ce[n]);ql(Yl,n=>[n,!0]);var kt=null;function pr(n){kt=typeof WeakMap!="undefined"&&new WeakMap;let e=mo(n);return kt=null,e}function mo(n){if(!n||typeof n!="object")return n;let e=kt&&kt.get(n);if(e)return e;if(Ae(n)){e=[],kt&&kt.set(n,e);for(var t=0,r=n.length;t<r;++t)e.push(mo(n[t]))}else if(qh.indexOf(n.constructor)>=0)e=n;else{let s=ar(n);e=s===Object.prototype?{}:Object.create(s),kt&&kt.set(n,e);for(var i in n)Ve(n,i)&&(e[i]=mo(n[i]))}return e}var{toString:Gh}={};function go(n){return Gh.call(n).slice(8,-1)}var yo=typeof Symbol!="undefined"?Symbol.iterator:"@@iterator",Xh=typeof yo=="symbol"?function(n){var e;return n!=null&&(e=n[yo])&&e.apply(n)}:function(){return null},Sn={};function bt(n){var e,t,r,i;if(arguments.length===1){if(Ae(n))return n.slice();if(this===Sn&&typeof n=="string")return[n];if(i=Xh(n)){for(t=[];r=i.next(),!r.done;)t.push(r.value);return t}if(n==null)return[n];if(e=n.length,typeof e=="number"){for(t=new Array(e);e--;)t[e]=n[e];return t}return[n]}for(e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return t}var Wo=typeof Symbol!="undefined"?n=>n[Symbol.toStringTag]==="AsyncFunction":()=>!1,ft=typeof location!="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ql(n,e){ft=n,Jl=e}var Jl=()=>!0,Yh=!new Error("").stack;function on(){if(Yh)try{throw on.arguments,new Error}catch(n){return n}return new Error}function vo(n,e){var t=n.stack;return t?(e=e||0,t.indexOf(n.name)===0&&(e+=(n.name+n.message).split(`
`).length),t.split(`
`).slice(e).filter(Jl).map(r=>`
`+r).join("")):""}var Qh=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],Zl=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Uo=Qh.concat(Zl),Jh={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Fn(n,e){this._e=on(),this.name=n,this.message=e}Cn(Fn).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+vo(this._e,2))}},toString:function(){return this.name+": "+this.message}});function eu(n,e){return n+". Errors: "+Object.keys(e).map(t=>e[t].toString()).filter((t,r,i)=>i.indexOf(t)===r).join(`
`)}function Fi(n,e,t,r){this._e=on(),this.failures=e,this.failedKeys=r,this.successCount=t,this.message=eu(n,e)}Cn(Fi).from(Fn);function ir(n,e){this._e=on(),this.name="BulkError",this.failures=Object.keys(e).map(t=>e[t]),this.failuresByPos=e,this.message=eu(n,e)}Cn(ir).from(Fn);var Ho=Uo.reduce((n,e)=>(n[e]=e+"Error",n),{}),Zh=Fn,W=Uo.reduce((n,e)=>{var t=e+"Error";function r(i,s){this._e=on(),this.name=t,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=Jh[e]||t,this.inner=null)}return Cn(r).from(Zh),n[e]=r,n},{});W.Syntax=SyntaxError;W.Type=TypeError;W.Range=RangeError;var Ol=Zl.reduce((n,e)=>(n[e+"Error"]=W[e],n),{});function ed(n,e){if(!n||n instanceof Fn||n instanceof TypeError||n instanceof SyntaxError||!n.name||!Ol[n.name])return n;var t=new Ol[n.name](e||n.message,n);return"stack"in n&&Et(t,"stack",{get:function(){return this.inner.stack}}),t}var Bi=Uo.reduce((n,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(n[e+"Error"]=W[e]),n),{});Bi.ModifyError=Fi;Bi.DexieError=Fn;Bi.BulkError=ir;function oe(){}function mr(n){return n}function td(n,e){return n==null||n===mr?e:function(t){return e(n(t))}}function rn(n,e){return function(){n.apply(this,arguments),e.apply(this,arguments)}}function nd(n,e){return n===oe?e:function(){var t=n.apply(this,arguments);t!==void 0&&(arguments[0]=t);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?rn(r,this.onsuccess):r),i&&(this.onerror=this.onerror?rn(i,this.onerror):i),s!==void 0?s:t}}function rd(n,e){return n===oe?e:function(){n.apply(this,arguments);var t=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),t&&(this.onsuccess=this.onsuccess?rn(t,this.onsuccess):t),r&&(this.onerror=this.onerror?rn(r,this.onerror):r)}}function id(n,e){return n===oe?e:function(t){var r=n.apply(this,arguments);Pe(t,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?rn(i,this.onsuccess):i),s&&(this.onerror=this.onerror?rn(s,this.onerror):s),r===void 0?o===void 0?void 0:o:Pe(r,o)}}function sd(n,e){return n===oe?e:function(){return e.apply(this,arguments)===!1?!1:n.apply(this,arguments)}}function qo(n,e){return n===oe?e:function(){var t=n.apply(this,arguments);if(t&&typeof t.then=="function"){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return t.then(function(){return e.apply(r,s)})}return e.apply(this,arguments)}}var lr={},od=100,ad=20,tu=100,[_o,Pi,bo]=typeof Promise=="undefined"?[]:(()=>{let n=Promise.resolve();if(typeof crypto=="undefined"||!crypto.subtle)return[n,ar(n),n];let e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,ar(e),n]})(),nu=Pi&&Pi.then,xi=_o&&_o.constructor,Go=!!bo,wo=!1,ld=bo?()=>{bo.then(yi)}:ce.setImmediate?setImmediate.bind(null,yi):ce.MutationObserver?()=>{var n=document.createElement("div");new MutationObserver(()=>{yi(),n=null}).observe(n,{attributes:!0}),n.setAttribute("i","1")}:()=>{setTimeout(yi,0)},ur=function(n,e){rr.push([n,e]),Ii&&(ld(),Ii=!1)},xo=!0,Ii=!0,tn=[],Ei=[],Eo=null,So=mr,An={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ll,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(n=>{try{Ll(n[0],n[1])}catch(e){}})}},K=An,rr=[],nn=0,Si=[];function R(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=oe,this._lib=!1;var e=this._PSD=K;if(ft&&(this._stackHolder=on(),this._prev=null,this._numPrev=0),typeof n!="function"){if(n!==lr)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&To(this,this._value);return}this._state=null,this._value=null,++e.ref,iu(this,n)}var Ao={get:function(){var n=K,e=Mi;function t(r,i){var s=!n.global&&(n!==K||e!==Mi);let o=s&&!St();var a=new R((l,u)=>{Xo(this,new ru(ki(r,n,s,o),ki(i,n,s,o),l,u,n))});return ft&&au(a,this),a}return t.prototype=lr,t},set:function(n){Et(this,"then",n&&n.prototype===lr?Ao:{get:function(){return n},set:Ao.set})}};Tn(R.prototype,{then:Ao,_then:function(n,e){Xo(this,new ru(null,null,n,e,K))},catch:function(n){if(arguments.length===1)return this.then(null,n);var e=arguments[0],t=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?t(r):Ai(r)):this.then(null,r=>r&&r.name===e?t(r):Ai(r))},finally:function(n){return this.then(e=>(n(),e),e=>(n(),Ai(e)))},stack:{get:function(){if(this._stack)return this._stack;try{wo=!0;var n=ou(this,[],ad),e=n.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{wo=!1}}},timeout:function(n,e){return n<1/0?new R((t,r)=>{var i=setTimeout(()=>r(new W.Timeout(e)),n);this.then(t,r).finally(clearTimeout.bind(null,i))}):this}});typeof Symbol!="undefined"&&Symbol.toStringTag&&Et(R.prototype,Symbol.toStringTag,"Dexie.Promise");An.env=lu();function ru(n,e,t,r,i){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof e=="function"?e:null,this.resolve=t,this.reject=r,this.psd=i}Tn(R,{all:function(){var n=bt.apply(null,arguments).map(Oi);return new R(function(e,t){n.length===0&&e([]);var r=n.length;n.forEach((i,s)=>R.resolve(i).then(o=>{n[s]=o,--r||e(n)},t))})},resolve:n=>{if(n instanceof R)return n;if(n&&typeof n.then=="function")return new R((t,r)=>{n.then(t,r)});var e=new R(lr,!0,n);return au(e,Eo),e},reject:Ai,race:function(){var n=bt.apply(null,arguments).map(Oi);return new R((e,t)=>{n.map(r=>R.resolve(r).then(e,t))})},PSD:{get:()=>K,set:n=>K=n},totalEchoes:{get:()=>Mi},newPSD:Lt,usePSD:In,scheduler:{get:()=>ur,set:n=>{ur=n}},rejectionMapper:{get:()=>So,set:n=>{So=n}},follow:(n,e)=>new R((t,r)=>Lt((i,s)=>{var o=K;o.unhandleds=[],o.onunhandled=s,o.finalize=rn(function(){cd(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},o.finalize),n()},e,t,r))});xi&&(xi.allSettled&&Et(R,"allSettled",function(){let n=bt.apply(null,arguments).map(Oi);return new R(e=>{n.length===0&&e([]);let t=n.length,r=new Array(t);n.forEach((i,s)=>R.resolve(i).then(o=>r[s]={status:"fulfilled",value:o},o=>r[s]={status:"rejected",reason:o}).then(()=>--t||e(r)))})}),xi.any&&typeof AggregateError!="undefined"&&Et(R,"any",function(){let n=bt.apply(null,arguments).map(Oi);return new R((e,t)=>{n.length===0&&t(new AggregateError([]));let r=n.length,i=new Array(r);n.forEach((s,o)=>R.resolve(s).then(a=>e(a),a=>{i[o]=a,--r||t(new AggregateError(i))}))})}));function iu(n,e){try{e(t=>{if(n._state===null){if(t===n)throw new TypeError("A promise cannot be resolved with itself.");var r=n._lib&&gr();t&&typeof t.then=="function"?iu(n,(i,s)=>{t instanceof R?t._then(i,s):t.then(i,s)}):(n._state=!0,n._value=t,su(n)),r&&yr()}},To.bind(null,n))}catch(t){To(n,t)}}function To(n,e){if(Ei.push(e),n._state===null){var t=n._lib&&gr();e=So(e),n._state=!1,n._value=e,ft&&e!==null&&typeof e=="object"&&!e._promise&&Wh(()=>{var r=$o(e,"stack");e._promise=n,Et(e,"stack",{get:()=>wo?r&&(r.get?r.get.apply(e):r.value):n.stack})}),fd(n),su(n),t&&yr()}}function su(n){var e=n._listeners;n._listeners=[];for(var t=0,r=e.length;t<r;++t)Xo(n,e[t]);var i=n._PSD;--i.ref||i.finalize(),nn===0&&(++nn,ur(()=>{--nn===0&&Yo()},[]))}function Xo(n,e){if(n._state===null){n._listeners.push(e);return}var t=n._state?e.onFulfilled:e.onRejected;if(t===null)return(n._state?e.resolve:e.reject)(n._value);++e.psd.ref,++nn,ur(ud,[t,n,e])}function ud(n,e,t){try{Eo=e;var r,i=e._value;e._state?r=n(i):(Ei.length&&(Ei=[]),r=n(i),Ei.indexOf(i)===-1&&hd(e)),t.resolve(r)}catch(s){t.reject(s)}finally{Eo=null,--nn===0&&Yo(),--t.psd.ref||t.psd.finalize()}}function ou(n,e,t){if(e.length===t)return e;var r="";if(n._state===!1){var i=n._value,s,o;i!=null?(s=i.name||"Error",o=i.message||i,r=vo(i,0)):(s=i,o=""),e.push(s+(o?": "+o:"")+r)}return ft&&(r=vo(n._stackHolder,2),r&&e.indexOf(r)===-1&&e.push(r),n._prev&&ou(n._prev,e,t)),e}function au(n,e){var t=e?e._numPrev+1:0;t<od&&(n._prev=e,n._numPrev=t)}function yi(){gr()&&yr()}function gr(){var n=xo;return xo=!1,Ii=!1,n}function yr(){var n,e,t;do for(;rr.length>0;)for(n=rr,rr=[],t=n.length,e=0;e<t;++e){var r=n[e];r[0].apply(null,r[1])}while(rr.length>0);xo=!0,Ii=!0}function Yo(){var n=tn;tn=[],n.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=Si.slice(0),t=e.length;t;)e[--t]()}function cd(n){function e(){n(),Si.splice(Si.indexOf(e),1)}Si.push(e),++nn,ur(()=>{--nn===0&&Yo()},[])}function fd(n){tn.some(e=>e._value===n._value)||tn.push(n)}function hd(n){for(var e=tn.length;e;)if(tn[--e]._value===n._value){tn.splice(e,1);return}}function Ai(n){return new R(lr,!1,n)}function he(n,e){var t=K;return function(){var r=gr(),i=K;try{return Rt(t,!0),n.apply(this,arguments)}catch(s){e&&e(s)}finally{Rt(i,!1),r&&yr()}}}var Se={awaits:0,echoes:0,id:0},dd=0,Ti=[],lo=0,Mi=0,pd=0;function Lt(n,e,t,r){var i=K,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++pd;var o=An.env;s.env=Go?{Promise:R,PromiseProp:{value:R,configurable:!0,writable:!0},all:R.all,race:R.race,allSettled:R.allSettled,any:R.any,resolve:R.resolve,reject:R.reject,nthen:kl(o.nthen,s),gthen:kl(o.gthen,s)}:{},e&&Pe(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=In(s,n,t,r);return s.ref===0&&s.finalize(),a}function Pn(){return Se.id||(Se.id=++dd),++Se.awaits,Se.echoes+=tu,Se.id}function St(){return Se.awaits?(--Se.awaits===0&&(Se.id=0),Se.echoes=Se.awaits*tu,!0):!1}(""+nu).indexOf("[native code]")===-1&&(Pn=St=oe);function Oi(n){return Se.echoes&&n&&n.constructor===xi?(Pn(),n.then(e=>(St(),e),e=>(St(),_e(e)))):n}function md(n){++Mi,(!Se.echoes||--Se.echoes===0)&&(Se.echoes=Se.id=0),Ti.push(K),Rt(n,!0)}function gd(){var n=Ti[Ti.length-1];Ti.pop(),Rt(n,!1)}function Rt(n,e){var t=K;if((e?Se.echoes&&(!lo++||n!==K):lo&&(!--lo||n!==K))&&uu(e?md.bind(null,n):gd),n!==K&&(K=n,t===An&&(An.env=lu()),Go)){var r=An.env.Promise,i=n.env;Pi.then=i.nthen,r.prototype.then=i.gthen,(t.global||n.global)&&(Object.defineProperty(ce,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function lu(){var n=ce.Promise;return Go?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(ce,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject,nthen:Pi.then,gthen:n.prototype.then}:{}}function In(n,e,t,r,i){var s=K;try{return Rt(n,!0),e(t,r,i)}finally{Rt(s,!1)}}function uu(n){nu.call(_o,n)}function ki(n,e,t,r){return typeof n!="function"?n:function(){var i=K;t&&Pn(),Rt(e,!0);try{return n.apply(this,arguments)}finally{Rt(i,!1),r&&uu(St)}}}function kl(n,e){return function(t,r){return n.call(this,ki(t,e),ki(r,e))}}var Dl="unhandledrejection";function Ll(n,e){var t;try{t=e.onuncatched(n)}catch(s){}if(t!==!1)try{var r,i={promise:e,reason:n};if(ce.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(Dl,!0,!0),Pe(r,i)):ce.CustomEvent&&(r=new CustomEvent(Dl,{detail:i}),Pe(r,i)),r&&ce.dispatchEvent&&(dispatchEvent(r),!ce.PromiseRejectionEvent&&ce.onunhandledrejection))try{ce.onunhandledrejection(r)}catch(s){}ft&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${n.stack||n}`)}catch(s){}}var _e=R.reject;function Co(n,e,t,r){if(!n.idbdb||!n._state.openComplete&&!K.letThrough&&!n._vip){if(n._state.openComplete)return _e(new W.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen)return _e(new W.DatabaseClosed);n.open().catch(oe)}return n._state.dbReadyPromise.then(()=>Co(n,e,t,r))}else{var i=n._createTransaction(e,t,n._dbSchema);try{i.create(),n._state.PR1398_maxLoop=3}catch(s){return s.name===Ho.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>Co(n,e,t,r))):_e(s)}return i._promise(e,(s,o)=>Lt(()=>(K.trans=i,r(s,o,i)))).then(s=>i._completion.then(()=>s))}}var Rl="3.2.4",en=String.fromCharCode(65535),Fo=-1/0,vt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",cu="String expected.",sr=[],zi=typeof navigator!="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),yd=zi,vd=zi,fu=n=>!/(dexie\.js|dexie\.min\.js)/.test(n),Vi="__dbnames",uo="readonly",co="readwrite";function sn(n,e){return n?e?function(){return n.apply(this,arguments)&&e.apply(this,arguments)}:n:e}var hu={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function vi(n){return typeof n=="string"&&!/\./.test(n)?e=>(e[n]===void 0&&n in e&&(e=pr(e),delete e[n]),e):e=>e}var Po=class{_trans(e,t,r){let i=this._tx||K.trans,s=this.name;function o(l,u,c){if(!c.schema[s])throw new W.NotFound("Table "+s+" not part of transaction");return t(c.idbtrans,c)}let a=gr();try{return i&&i.db===this.db?i===K.trans?i._promise(e,o,r):Lt(()=>i._promise(e,o,r),{trans:i,transless:K.transless||K}):Co(this.db,e,[this.name],o)}finally{a&&yr()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(i=>this.hook.reading.fire(i))).then(t)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Ae(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);let t=ge(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);let r=this.schema.indexes.concat(this.schema.primKey).filter(u=>u.compound&&t.every(c=>u.keyPath.indexOf(c)>=0)&&u.keyPath.every(c=>t.indexOf(c)>=0))[0];if(r&&this.db._maxKey!==en)return this.where(r.name).equals(r.keyPath.map(u=>e[u]));!r&&ft&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);let{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(u,c){try{return s.cmp(u,c)===0}catch(h){return!1}}let[a,l]=t.reduce(([u,c],h)=>{let f=i[h],d=e[h];return[u||f,u||!f?sn(c,f&&f.multi?p=>{let m=xt(p,h);return Ae(m)&&m.some(y=>o(d,y))}:p=>o(d,xt(p,h))):c]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(l):r?this.filter(l):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Ae(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;let t=r=>{if(!r)return r;let i=Object.create(e.prototype);for(var s in r)if(Ve(r,s))try{i[s]=r[s]}catch(o){}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){function e(t){Pe(this,t)}return this.mapToClass(e)}add(e,t){let{auto:r,keyPath:i}=this.schema.primKey,s=e;return i&&r&&(s=vi(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:t!=null?[t]:null,values:[s]})).then(o=>o.numFailures?R.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{nt(e,i,o)}catch(a){}return o})}update(e,t){if(typeof e=="object"&&!Ae(e)){let r=xt(e,this.schema.primKey.keyPath);if(r===void 0)return _e(new W.InvalidArgument("Given object does not contain its primary key"));try{typeof t!="function"?ge(t).forEach(i=>{nt(e,i,t[i])}):t(e,{value:e,primKey:r})}catch(i){}return this.where(":id").equals(r).modify(t)}else return this.where(":id").equals(e).modify(t)}put(e,t){let{auto:r,keyPath:i}=this.schema.primKey,s=e;return i&&r&&(s=vi(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[s],keys:t!=null?[t]:null})).then(o=>o.numFailures?R.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{nt(e,i,o)}catch(a){}return o})}delete(e){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"delete",keys:[e]})).then(t=>t.numFailures?R.reject(t.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:hu})).then(e=>e.numFailures?R.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",t=>this.core.getMany({keys:e,trans:t}).then(r=>r.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,t,r){let i=Array.isArray(t)?t:void 0;r=r||(i?void 0:t);let s=r?r.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new W.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new W.InvalidArgument("Arguments objects and keys must have the same length");let u=e.length,c=l&&a?e.map(vi(l)):e;return this.core.mutate({trans:o,type:"add",keys:i,values:c,wantResults:s}).then(({numFailures:h,results:f,lastResult:d,failures:p})=>{let m=s?f:d;if(h===0)return m;throw new ir(`${this.name}.bulkAdd(): ${h} of ${u} operations failed`,p)})})}bulkPut(e,t,r){let i=Array.isArray(t)?t:void 0;r=r||(i?void 0:t);let s=r?r.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new W.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new W.InvalidArgument("Arguments objects and keys must have the same length");let u=e.length,c=l&&a?e.map(vi(l)):e;return this.core.mutate({trans:o,type:"put",keys:i,values:c,wantResults:s}).then(({numFailures:h,results:f,lastResult:d,failures:p})=>{let m=s?f:d;if(h===0)return m;throw new ir(`${this.name}.bulkPut(): ${h} of ${u} operations failed`,p)})})}bulkDelete(e){let t=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:i,failures:s})=>{if(r===0)return i;throw new ir(`${this.name}.bulkDelete(): ${r} of ${t} operations failed`,s)})}};function vr(n){var e={},t=function(a,l){if(l){for(var u=arguments.length,c=new Array(u-1);--u;)c[u-1]=arguments[u];return e[a].subscribe.apply(null,c),n}else if(typeof a=="string")return e[a]};t.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return t;function s(a,l,u){if(typeof a=="object")return o(a);l||(l=sd),u||(u=oe);var c={subscribers:[],fire:u,subscribe:function(h){c.subscribers.indexOf(h)===-1&&(c.subscribers.push(h),c.fire=l(c.fire,h))},unsubscribe:function(h){c.subscribers=c.subscribers.filter(function(f){return f!==h}),c.fire=c.subscribers.reduce(l,u)}};return e[a]=t[a]=c,c}function o(a){ge(a).forEach(function(l){var u=a[l];if(Ae(u))s(l,a[l][0],a[l][1]);else if(u==="asap")var c=s(l,mr,function(){for(var f=arguments.length,d=new Array(f);f--;)d[f]=arguments[f];c.subscribers.forEach(function(p){Hl(function(){p.apply(null,d)})})});else throw new W.InvalidArgument("Invalid event config")})}}function _r(n,e){return Cn(e).from({prototype:n}),e}function _d(n){return _r(Po.prototype,function(t,r,i){this.db=n,this._tx=i,this.name=t,this.schema=r,this.hook=n._allTables[t]?n._allTables[t].hook:vr(null,{creating:[nd,oe],reading:[td,mr],updating:[id,oe],deleting:[rd,oe]})})}function xn(n,e){return!(n.filter||n.algorithm||n.or)&&(e?n.justLimit:!n.replayFilter)}function fo(n,e){n.filter=sn(n.filter,e)}function ho(n,e,t){var r=n.replayFilter;n.replayFilter=r?()=>sn(r(),e()):e,n.justLimit=t&&!r}function bd(n,e){n.isMatch=sn(n.isMatch,e)}function Ci(n,e){if(n.isPrimKey)return e.primaryKey;let t=e.getIndexByKeyPath(n.index);if(!t)throw new W.Schema("KeyPath "+n.index+" on object store "+e.name+" is not indexed");return t}function Nl(n,e,t){let r=Ci(n,e.schema);return e.openCursor({trans:t,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:r,range:n.range}})}function _i(n,e,t,r){let i=n.replayFilter?sn(n.filter,n.replayFilter()):n.filter;if(n.or){let s={},o=(a,l,u)=>{if(!i||i(l,u,f=>l.stop(f),f=>l.fail(f))){var c=l.primaryKey,h=""+c;h==="[object ArrayBuffer]"&&(h=""+new Uint8Array(c)),Ve(s,h)||(s[h]=!0,e(a,l,u))}};return Promise.all([n.or._iterate(o,t),jl(Nl(n,r,t),n.algorithm,o,!n.keysOnly&&n.valueMapper)])}else return jl(Nl(n,r,t),sn(n.algorithm,i),e,!n.keysOnly&&n.valueMapper)}function jl(n,e,t,r){var i=r?(o,a,l)=>t(r(o),a,l):t,s=he(i);return n.then(o=>{if(o)return o.start(()=>{var a=()=>o.continue();(!e||e(o,l=>a=l,l=>{o.stop(l),a=oe},l=>{o.fail(l),a=oe}))&&s(o.value,o,l=>a=l),a()})})}function Fe(n,e){try{let t=Bl(n),r=Bl(e);if(t!==r)return t==="Array"?1:r==="Array"?-1:t==="binary"?1:r==="binary"?-1:t==="string"?1:r==="string"?-1:t==="Date"?1:r!=="Date"?NaN:-1;switch(t){case"number":case"Date":case"string":return n>e?1:n<e?-1:0;case"binary":return xd(zl(n),zl(e));case"Array":return wd(n,e)}}catch(t){}return NaN}function wd(n,e){let t=n.length,r=e.length,i=t<r?t:r;for(let s=0;s<i;++s){let o=Fe(n[s],e[s]);if(o!==0)return o}return t===r?0:t<r?-1:1}function xd(n,e){let t=n.length,r=e.length,i=t<r?t:r;for(let s=0;s<i;++s)if(n[s]!==e[s])return n[s]<e[s]?-1:1;return t===r?0:t<r?-1:1}function Bl(n){let e=typeof n;if(e!=="object")return e;if(ArrayBuffer.isView(n))return"binary";let t=go(n);return t==="ArrayBuffer"?"binary":t}function zl(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}var Io=class{_read(e,t){var r=this._ctx;return r.error?r.table._trans(null,_e.bind(null,r.error)):r.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,_e.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=sn(t.algorithm,e)}_iterate(e,t){return _i(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&Pe(r,e),t._ctx=r,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read(r=>_i(t,e,r,t.table.core))}count(e){return this._read(t=>{let r=this._ctx,i=r.table.core;if(xn(r,!0))return i.count({trans:t,query:{index:Ci(r,i.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var s=0;return _i(r,()=>(++s,!1),t,i).then(()=>s)}).then(e)}sortBy(e,t){let r=e.split(".").reverse(),i=r[0],s=r.length-1;function o(u,c){return c?o(u[r[c]],c-1):u[i]}var a=this._ctx.dir==="next"?1:-1;function l(u,c){var h=o(u,s),f=o(c,s);return h<f?-a:h>f?a:0}return this.toArray(function(u){return u.sort(l)}).then(t)}toArray(e){return this._read(t=>{var r=this._ctx;if(r.dir==="next"&&xn(r,!0)&&r.limit>0){let{valueMapper:i}=r,s=Ci(r,r.table.core.schema);return r.table.core.query({trans:t,limit:r.limit,values:!0,query:{index:s,range:r.range}}).then(({result:o})=>i?o.map(i):o)}else{let i=[];return _i(r,s=>i.push(s),t,r.table.core).then(()=>i)}},e)}offset(e){var t=this._ctx;return e<=0?this:(t.offset+=e,xn(t)?ho(t,()=>{var r=e;return(i,s)=>r===0?!0:r===1?(--r,!1):(s(()=>{i.advance(r),r=0}),!1)}):ho(t,()=>{var r=e;return()=>--r<0}),this)}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),ho(this._ctx,()=>{var t=e;return function(r,i,s){return--t<=0&&i(s),t>=0}},!0),this}until(e,t){return fo(this._ctx,function(r,i,s){return e(r.value)?(i(s),t):!0}),this}first(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){return fo(this._ctx,function(t){return e(t.value)}),bd(this._ctx,e),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(r,i){e(i.primaryKey,i)})}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,s){r.push(s.key)}).then(function(){return r}).then(e)}primaryKeys(e){var t=this._ctx;if(t.dir==="next"&&xn(t,!0)&&t.limit>0)return this._read(i=>{var s=Ci(t,t.table.core.schema);return t.table.core.query({trans:i,values:!1,limit:t.limit,query:{index:s,range:t.range}})}).then(({result:i})=>i).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each(function(i,s){r.push(s.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(t){return t[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var r={};return fo(this._ctx,function(i){var s=i.primaryKey.toString(),o=Ve(r,s);return r[s]=!0,!o}),this}modify(e){var t=this._ctx;return this._write(r=>{var i;if(typeof e=="function")i=e;else{var s=ge(e),o=s.length;i=function(m){for(var y=!1,g=0;g<o;++g){var _=s[g],w=e[_];xt(m,_)!==w&&(nt(m,_,w),y=!0)}return y}}let a=t.table.core,{outbound:l,extractKey:u}=a.schema.primaryKey,c=this.db._options.modifyChunkSize||200,h=[],f=0,d=[],p=(m,y)=>{let{failures:g,numFailures:_}=y;f+=m-_;for(let w of ge(g))h.push(g[w])};return this.clone().primaryKeys().then(m=>{let y=g=>{let _=Math.min(c,m.length-g);return a.getMany({trans:r,keys:m.slice(g,g+_),cache:"immutable"}).then(w=>{let b=[],S=[],A=l?[]:null,T=[];for(let k=0;k<_;++k){let j=w[k],I={value:pr(j),primKey:m[g+k]};i.call(I,I.value,I)!==!1&&(I.value==null?T.push(m[g+k]):!l&&Fe(u(j),u(I.value))!==0?(T.push(m[g+k]),b.push(I.value)):(S.push(I.value),l&&A.push(m[g+k])))}let F=xn(t)&&t.limit===1/0&&(typeof e!="function"||e===po)&&{index:t.index,range:t.range};return Promise.resolve(b.length>0&&a.mutate({trans:r,type:"add",values:b}).then(k=>{for(let j in k.failures)T.splice(parseInt(j),1);p(b.length,k)})).then(()=>(S.length>0||F&&typeof e=="object")&&a.mutate({trans:r,type:"put",keys:A,values:S,criteria:F,changeSpec:typeof e!="function"&&e}).then(k=>p(S.length,k))).then(()=>(T.length>0||F&&e===po)&&a.mutate({trans:r,type:"delete",keys:T,criteria:F}).then(k=>p(T.length,k))).then(()=>m.length>g+_&&y(g+c))})};return y(0).then(()=>{if(h.length>0)throw new Fi("Error modifying one or more objects",h,f,d);return m.length})})})}delete(){var e=this._ctx,t=e.range;return xn(e)&&(e.isPrimKey&&!vd||t.type===3)?this._write(r=>{let{primaryKey:i}=e.table.core.schema,s=t;return e.table.core.count({trans:r,query:{index:i,range:s}}).then(o=>e.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(({failures:a,lastResult:l,results:u,numFailures:c})=>{if(c)throw new Fi("Could not delete some values",Object.keys(a).map(h=>a[h]),o-c);return o-c}))}):this.modify(po)}},po=(n,e)=>e.value=null;function Ed(n){return _r(Io.prototype,function(t,r){this.db=n;let i=hu,s=null;if(r)try{i=r()}catch(u){s=u}let o=t._ctx,a=o.table,l=a.hook.reading.fire;this._ctx={table:a,index:o.index,isPrimKey:!o.index||a.schema.primKey.keyPath&&o.index===a.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:s,or:o.or,valueMapper:l!==mr?l:null}})}function Sd(n,e){return n<e?-1:n===e?0:1}function Ad(n,e){return n>e?-1:n===e?0:1}function ze(n,e,t){var r=n instanceof Di?new n.Collection(n):n;return r._ctx.error=t?new t(e):new TypeError(e),r}function En(n){return new n.Collection(n,()=>du("")).limit(0)}function Td(n){return n==="next"?e=>e.toUpperCase():e=>e.toLowerCase()}function Cd(n){return n==="next"?e=>e.toLowerCase():e=>e.toUpperCase()}function Fd(n,e,t,r,i,s){for(var o=Math.min(n.length,r.length),a=-1,l=0;l<o;++l){var u=e[l];if(u!==r[l])return i(n[l],t[l])<0?n.substr(0,l)+t[l]+t.substr(l+1):i(n[l],r[l])<0?n.substr(0,l)+r[l]+t.substr(l+1):a>=0?n.substr(0,a)+e[a]+t.substr(a+1):null;i(n[l],u)<0&&(a=l)}return o<r.length&&s==="next"?n+t.substr(n.length):o<n.length&&s==="prev"?n.substr(0,t.length):a<0?null:n.substr(0,a)+r[a]+t.substr(a+1)}function bi(n,e,t,r){var i,s,o,a,l,u,c,h=t.length;if(!t.every(m=>typeof m=="string"))return ze(n,cu);function f(m){i=Td(m),s=Cd(m),o=m==="next"?Sd:Ad;var y=t.map(function(g){return{lower:s(g),upper:i(g)}}).sort(function(g,_){return o(g.lower,_.lower)});a=y.map(function(g){return g.upper}),l=y.map(function(g){return g.lower}),u=m,c=m==="next"?"":r}f("next");var d=new n.Collection(n,()=>Ot(a[0],l[h-1]+r));d._ondirectionchange=function(m){f(m)};var p=0;return d._addAlgorithm(function(m,y,g){var _=m.key;if(typeof _!="string")return!1;var w=s(_);if(e(w,l,p))return!0;for(var b=null,S=p;S<h;++S){var A=Fd(_,w,a[S],l[S],o,u);A===null&&b===null?p=S+1:(b===null||o(b,A)>0)&&(b=A)}return y(b!==null?function(){m.continue(b+c)}:g),!1}),d}function Ot(n,e,t,r){return{type:2,lower:n,upper:e,lowerOpen:t,upperOpen:r}}function du(n){return{type:1,lower:n,upper:n}}var Di=class{get Collection(){return this._ctx.table.db.Collection}between(e,t,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,t)>0||this._cmp(e,t)===0&&(r||i)&&!(r&&i)?En(this):new this.Collection(this,()=>Ot(e,t,!r,!i))}catch(s){return ze(this,vt)}}equals(e){return e==null?ze(this,vt):new this.Collection(this,()=>du(e))}above(e){return e==null?ze(this,vt):new this.Collection(this,()=>Ot(e,void 0,!0))}aboveOrEqual(e){return e==null?ze(this,vt):new this.Collection(this,()=>Ot(e,void 0,!1))}below(e){return e==null?ze(this,vt):new this.Collection(this,()=>Ot(void 0,e,!1,!0))}belowOrEqual(e){return e==null?ze(this,vt):new this.Collection(this,()=>Ot(void 0,e))}startsWith(e){return typeof e!="string"?ze(this,cu):this.between(e,e+en,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):bi(this,(t,r)=>t.indexOf(r[0])===0,[e],en)}equalsIgnoreCase(e){return bi(this,(t,r)=>t===r[0],[e],"")}anyOfIgnoreCase(){var e=bt.apply(Sn,arguments);return e.length===0?En(this):bi(this,(t,r)=>r.indexOf(t)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=bt.apply(Sn,arguments);return e.length===0?En(this):bi(this,(t,r)=>r.some(i=>t.indexOf(i)===0),e,en)}anyOf(){let e=bt.apply(Sn,arguments),t=this._cmp;try{e.sort(t)}catch(s){return ze(this,vt)}if(e.length===0)return En(this);let r=new this.Collection(this,()=>Ot(e[0],e[e.length-1]));r._ondirectionchange=s=>{t=s==="next"?this._ascending:this._descending,e.sort(t)};let i=0;return r._addAlgorithm((s,o,a)=>{let l=s.key;for(;t(l,e[i])>0;)if(++i,i===e.length)return o(a),!1;return t(l,e[i])===0?!0:(o(()=>{s.continue(e[i])}),!1)}),r}notEqual(e){return this.inAnyRange([[Fo,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){let e=bt.apply(Sn,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch(r){return ze(this,vt)}let t=e.reduce((r,i)=>r?r.concat([[r[r.length-1][1],i]]):[[Fo,i]],null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){let r=this._cmp,i=this._ascending,s=this._descending,o=this._min,a=this._max;if(e.length===0)return En(this);if(!e.every(b=>b[0]!==void 0&&b[1]!==void 0&&i(b[0],b[1])<=0))return ze(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",W.InvalidArgument);let l=!t||t.includeLowers!==!1,u=t&&t.includeUppers===!0;function c(b,S){let A=0,T=b.length;for(;A<T;++A){let F=b[A];if(r(S[0],F[1])<0&&r(S[1],F[0])>0){F[0]=o(F[0],S[0]),F[1]=a(F[1],S[1]);break}}return A===T&&b.push(S),b}let h=i;function f(b,S){return h(b[0],S[0])}let d;try{d=e.reduce(c,[]),d.sort(f)}catch(b){return ze(this,vt)}let p=0,m=u?b=>i(b,d[p][1])>0:b=>i(b,d[p][1])>=0,y=l?b=>s(b,d[p][0])>0:b=>s(b,d[p][0])>=0;function g(b){return!m(b)&&!y(b)}let _=m,w=new this.Collection(this,()=>Ot(d[0][0],d[d.length-1][1],!l,!u));return w._ondirectionchange=b=>{b==="next"?(_=m,h=i):(_=y,h=s),d.sort(f)},w._addAlgorithm((b,S,A)=>{for(var T=b.key;_(T);)if(++p,p===d.length)return S(A),!1;return g(T)?!0:(this._cmp(T,d[p][1])===0||this._cmp(T,d[p][0])===0||S(()=>{h===i?b.continue(d[p][0]):b.continue(d[p][1])}),!1)}),w}startsWithAnyOf(){let e=bt.apply(Sn,arguments);return e.every(t=>typeof t=="string")?e.length===0?En(this):this.inAnyRange(e.map(t=>[t,t+en])):ze(this,"startsWithAnyOf() only works with strings")}};function Pd(n){return _r(Di.prototype,function(t,r,i){this.db=n,this._ctx={table:t,index:r===":id"?null:r,or:i};let s=n._deps.indexedDB;if(!s)throw new W.MissingAPI;this._cmp=this._ascending=s.cmp.bind(s),this._descending=(o,a)=>s.cmp(a,o),this._max=(o,a)=>s.cmp(o,a)>0?o:a,this._min=(o,a)=>s.cmp(o,a)<0?o:a,this._IDBKeyRange=n._deps.IDBKeyRange})}function ct(n){return he(function(e){return cr(e),n(e.target.error),!1})}function cr(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}var fr="storagemutated",Dt="x-storagemutated-1",Nt=vr(null,fr),Mo=class{_lock(){return nr(!K.global),++this._reculock,this._reculock===1&&!K.global&&(K.lockOwnerFor=this),this}_unlock(){if(nr(!K.global),--this._reculock===0)for(K.global||(K.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{In(e[1],e[0])}catch(t){}}return this}_locked(){return this._reculock&&K.lockOwnerFor!==this}create(e){if(!this.mode)return this;let t=this.db.idbdb,r=this.db._state.dbOpenError;if(nr(!this.idbtrans),!e&&!t)switch(r&&r.name){case"DatabaseClosedError":throw new W.DatabaseClosed(r);case"MissingAPIError":throw new W.MissingAPI(r.message,r);default:throw new W.OpenFailed(r)}if(!this.active)throw new W.TransactionInactive;return nr(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=he(i=>{cr(i),this._reject(e.error)}),e.onabort=he(i=>{cr(i),this.active&&this._reject(new W.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=he(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Nt.storagemutated.fire(e.mutatedParts)}),this}_promise(e,t,r){if(e==="readwrite"&&this.mode!=="readwrite")return _e(new W.ReadOnly("Transaction is readonly"));if(!this.active)return _e(new W.TransactionInactive);if(this._locked())return new R((s,o)=>{this._blockedFuncs.push([()=>{this._promise(e,t,r).then(s,o)},K])});if(r)return Lt(()=>{var s=new R((o,a)=>{this._lock();let l=t(o,a,this);l&&l.then&&l.then(o,a)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new R((s,o)=>{var a=t(s,o,this);a&&a.then&&a.then(s,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();let r=R.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then(()=>r);else{t._waitingFor=r,t._waitingQueue=[];var i=t.idbtrans.objectStore(t.storeNames[0]);(function o(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var s=t._waitingFor;return new R((o,a)=>{r.then(l=>t._waitingQueue.push(he(o.bind(null,l))),l=>t._waitingQueue.push(he(a.bind(null,l)))).finally(()=>{t._waitingFor===s&&(t._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new W.Abort))}table(e){let t=this._memoizedTables||(this._memoizedTables={});if(Ve(t,e))return t[e];let r=this.schema[e];if(!r)throw new W.NotFound("Table "+e+" not part of transaction");let i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),t[e]=i,i}};function Id(n){return _r(Mo.prototype,function(t,r,i,s,o){this.db=n,this.mode=t,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=s,this.idbtrans=null,this.on=vr(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new R((a,l)=>{this._resolve=a,this._reject=l}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},a=>{var l=this.active;return this.active=!1,this.on.error.fire(a),this.parent?this.parent._reject(a):l&&this.idbtrans&&this.idbtrans.abort(),_e(a)})})}function Oo(n,e,t,r,i,s,o){return{name:n,keyPath:e,unique:t,multi:r,auto:i,compound:s,src:(t&&!o?"&":"")+(r?"*":"")+(i?"++":"")+pu(e)}}function pu(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function mu(n,e,t){return{name:n,primKey:e,indexes:t,mappedClass:null,idxByName:ql(t,r=>[r.name,r])}}function Md(n){return n.length===1?n[0]:n}var hr=n=>{try{return n.only([[]]),hr=()=>[[]],[[]]}catch(e){return hr=()=>en,en}};function ko(n){return n==null?()=>{}:typeof n=="string"?Od(n):e=>xt(e,n)}function Od(n){return n.split(".").length===1?t=>t[n]:t=>xt(t,n)}function Vl(n){return[].slice.call(n)}var kd=0;function or(n){return n==null?":id":typeof n=="string"?n:`[${n.join("+")}]`}function Dd(n,e,t){function r(c,h){let f=Vl(c.objectStoreNames);return{schema:{name:c.name,tables:f.map(d=>h.objectStore(d)).map(d=>{let{keyPath:p,autoIncrement:m}=d,y=Ae(p),g=p==null,_={},w={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:g,compound:y,keyPath:p,autoIncrement:m,unique:!0,extractKey:ko(p)},indexes:Vl(d.indexNames).map(b=>d.index(b)).map(b=>{let{name:S,unique:A,multiEntry:T,keyPath:F}=b,k=Ae(F),j={name:S,compound:k,keyPath:F,unique:A,multiEntry:T,extractKey:ko(F)};return _[or(F)]=j,j}),getIndexByKeyPath:b=>_[or(b)]};return _[":id"]=w.primaryKey,p!=null&&(_[or(p)]=w.primaryKey),w})},hasGetAll:f.length>0&&"getAll"in h.objectStore(f[0])&&!(typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(c){if(c.type===3)return null;if(c.type===4)throw new Error("Cannot convert never type to IDBKeyRange");let{lower:h,upper:f,lowerOpen:d,upperOpen:p}=c;return h===void 0?f===void 0?null:e.upperBound(f,!!p):f===void 0?e.lowerBound(h,!!d):e.bound(h,f,!!d,!!p)}function s(c){let h=c.name;function f({trans:m,type:y,keys:g,values:_,range:w}){return new Promise((b,S)=>{b=he(b);let A=m.objectStore(h),T=A.keyPath==null,F=y==="put"||y==="add";if(!F&&y!=="delete"&&y!=="deleteRange")throw new Error("Invalid operation type: "+y);let{length:k}=g||_||{length:1};if(g&&_&&g.length!==_.length)throw new Error("Given keys array must have same length as given values array.");if(k===0)return b({numFailures:0,failures:{},results:[],lastResult:void 0});let j,I=[],N=[],D=0,z=X=>{++D,cr(X)};if(y==="deleteRange"){if(w.type===4)return b({numFailures:D,failures:N,results:[],lastResult:void 0});w.type===3?I.push(j=A.clear()):I.push(j=A.delete(i(w)))}else{let[X,Z]=F?T?[_,g]:[_,null]:[g,null];if(F)for(let ne=0;ne<k;++ne)I.push(j=Z&&Z[ne]!==void 0?A[y](X[ne],Z[ne]):A[y](X[ne])),j.onerror=z;else for(let ne=0;ne<k;++ne)I.push(j=A[y](X[ne])),j.onerror=z}let J=X=>{let Z=X.target.result;I.forEach((ne,de)=>ne.error!=null&&(N[de]=ne.error)),b({numFailures:D,failures:N,results:y==="delete"?g:I.map(ne=>ne.result),lastResult:Z})};j.onerror=X=>{z(X),J(X)},j.onsuccess=J})}function d({trans:m,values:y,query:g,reverse:_,unique:w}){return new Promise((b,S)=>{b=he(b);let{index:A,range:T}=g,F=m.objectStore(h),k=A.isPrimaryKey?F:F.index(A.name),j=_?w?"prevunique":"prev":w?"nextunique":"next",I=y||!("openKeyCursor"in k)?k.openCursor(i(T),j):k.openKeyCursor(i(T),j);I.onerror=ct(S),I.onsuccess=he(N=>{let D=I.result;if(!D){b(null);return}D.___id=++kd,D.done=!1;let z=D.continue.bind(D),J=D.continuePrimaryKey;J&&(J=J.bind(D));let X=D.advance.bind(D),Z=()=>{throw new Error("Cursor not started")},ne=()=>{throw new Error("Cursor not stopped")};D.trans=m,D.stop=D.continue=D.continuePrimaryKey=D.advance=Z,D.fail=he(S),D.next=function(){let de=1;return this.start(()=>de--?this.continue():this.stop()).then(()=>this)},D.start=de=>{let ot=new Promise((L,H)=>{L=he(L),I.onerror=ct(H),D.fail=H,D.stop=q=>{D.stop=D.continue=D.continuePrimaryKey=D.advance=ne,L(q)}}),M=()=>{if(I.result)try{de()}catch(L){D.fail(L)}else D.done=!0,D.start=()=>{throw new Error("Cursor behind last entry")},D.stop()};return I.onsuccess=he(L=>{I.onsuccess=M,M()}),D.continue=z,D.continuePrimaryKey=J,D.advance=X,M(),ot},b(D)},S)})}function p(m){return y=>new Promise((g,_)=>{g=he(g);let{trans:w,values:b,limit:S,query:A}=y,T=S===1/0?void 0:S,{index:F,range:k}=A,j=w.objectStore(h),I=F.isPrimaryKey?j:j.index(F.name),N=i(k);if(S===0)return g({result:[]});if(m){let D=b?I.getAll(N,T):I.getAllKeys(N,T);D.onsuccess=z=>g({result:z.target.result}),D.onerror=ct(_)}else{let D=0,z=b||!("openKeyCursor"in I)?I.openCursor(N):I.openKeyCursor(N),J=[];z.onsuccess=X=>{let Z=z.result;if(!Z)return g({result:J});if(J.push(b?Z.value:Z.primaryKey),++D===S)return g({result:J});Z.continue()},z.onerror=ct(_)}})}return{name:h,schema:c,mutate:f,getMany({trans:m,keys:y}){return new Promise((g,_)=>{g=he(g);let w=m.objectStore(h),b=y.length,S=new Array(b),A=0,T=0,F,k=I=>{let N=I.target;(S[N._pos]=N.result)!=null,++T===A&&g(S)},j=ct(_);for(let I=0;I<b;++I)y[I]!=null&&(F=w.get(y[I]),F._pos=I,F.onsuccess=k,F.onerror=j,++A);A===0&&g(S)})},get({trans:m,key:y}){return new Promise((g,_)=>{g=he(g);let b=m.objectStore(h).get(y);b.onsuccess=S=>g(S.target.result),b.onerror=ct(_)})},query:p(a),openCursor:d,count({query:m,trans:y}){let{index:g,range:_}=m;return new Promise((w,b)=>{let S=y.objectStore(h),A=g.isPrimaryKey?S:S.index(g.name),T=i(_),F=T?A.count(T):A.count();F.onsuccess=he(k=>w(k.target.result)),F.onerror=ct(b)})}}}let{schema:o,hasGetAll:a}=r(n,t),l=o.tables.map(c=>s(c)),u={};return l.forEach(c=>u[c.name]=c),{stack:"dbcore",transaction:n.transaction.bind(n),table(c){if(!u[c])throw new Error(`Table '${c}' not found`);return u[c]},MIN_KEY:-1/0,MAX_KEY:hr(e),schema:o}}function Ld(n,e){return e.reduce((t,{create:r})=>({...t,...r(t)}),n)}function Rd(n,e,{IDBKeyRange:t,indexedDB:r},i){return{dbcore:Ld(Dd(e,t,i),n.dbcore)}}function Qo({_novip:n},e){let t=e.db,r=Rd(n._middlewares,t,n._deps,e);n.core=r.dbcore,n.tables.forEach(i=>{let s=i.name;n.core.schema.tables.some(o=>o.name===s)&&(i.core=n.core.table(s),n[s]instanceof n.Table&&(n[s].core=i.core))})}function Li({_novip:n},e,t,r){t.forEach(i=>{let s=r[i];e.forEach(o=>{let a=$o(o,i);(!a||"value"in a&&a.value===void 0)&&(o===n.Transaction.prototype||o instanceof n.Transaction?Et(o,i,{get(){return this.table(i)},set(l){Wl(this,i,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new n.Table(i,s))})})}function Do({_novip:n},e){e.forEach(t=>{for(let r in t)t[r]instanceof n.Table&&delete t[r]})}function Nd(n,e){return n._cfg.version-e._cfg.version}function jd(n,e,t,r){let i=n._dbSchema,s=n._createTransaction("readwrite",n._storeNames,i);s.create(t),s._completion.catch(r);let o=s._reject.bind(s),a=K.transless||K;Lt(()=>{K.trans=s,K.transless=a,e===0?(ge(i).forEach(l=>{Jo(t,l,i[l].primKey,i[l].indexes)}),Qo(n,t),R.follow(()=>n.on.populate.fire(s)).catch(o)):Bd(n,e,s,t).catch(o)})}function Bd({_novip:n},e,t,r){let i=[],s=n._versions,o=n._dbSchema=Zo(n,n.idbdb,r),a=!1;s.filter(c=>c._cfg.version>=e).forEach(c=>{i.push(()=>{let h=o,f=c._cfg.dbschema;Ro(n,h,r),Ro(n,f,r),o=n._dbSchema=f;let d=gu(h,f);d.add.forEach(m=>{Jo(r,m[0],m[1].primKey,m[1].indexes)}),d.change.forEach(m=>{if(m.recreate)throw new W.Upgrade("Not yet support for changing primary key");{let y=r.objectStore(m.name);m.add.forEach(g=>Lo(y,g)),m.change.forEach(g=>{y.deleteIndex(g.name),Lo(y,g)}),m.del.forEach(g=>y.deleteIndex(g))}});let p=c._cfg.contentUpgrade;if(p&&c._cfg.version>e){Qo(n,r),t._memoizedTables={},a=!0;let m=Gl(f);d.del.forEach(w=>{m[w]=h[w]}),Do(n,[n.Transaction.prototype]),Li(n,[n.Transaction.prototype],ge(m),m),t.schema=m;let y=Wo(p);y&&Pn();let g,_=R.follow(()=>{if(g=p(t),g&&y){var w=St.bind(null,null);g.then(w,w)}});return g&&typeof g.then=="function"?R.resolve(g):_.then(()=>g)}}),i.push(h=>{if(!a||!yd){let f=c._cfg.dbschema;Vd(f,h)}Do(n,[n.Transaction.prototype]),Li(n,[n.Transaction.prototype],n._storeNames,n._dbSchema),t.schema=n._dbSchema})});function u(){return i.length?R.resolve(i.shift()(t.idbtrans)).then(u):R.resolve()}return u().then(()=>{zd(o,r)})}function gu(n,e){let t={del:[],add:[],change:[]},r;for(r in n)e[r]||t.del.push(r);for(r in e){let i=n[r],s=e[r];if(!i)t.add.push([r,s]);else{let o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!zi)o.recreate=!0,t.change.push(o);else{let a=i.idxByName,l=s.idxByName,u;for(u in a)l[u]||o.del.push(u);for(u in l){let c=a[u],h=l[u];c?c.src!==h.src&&o.change.push(h):o.add.push(h)}(o.del.length>0||o.add.length>0||o.change.length>0)&&t.change.push(o)}}}return t}function Jo(n,e,t,r){let i=n.db.createObjectStore(e,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});return r.forEach(s=>Lo(i,s)),i}function zd(n,e){ge(n).forEach(t=>{e.db.objectStoreNames.contains(t)||Jo(e,t,n[t].primKey,n[t].indexes)})}function Vd(n,e){[].slice.call(e.db.objectStoreNames).forEach(t=>n[t]==null&&e.db.deleteObjectStore(t))}function Lo(n,e){n.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Zo(n,e,t){let r={};return ji(e.objectStoreNames,0).forEach(s=>{let o=t.objectStore(s),a=o.keyPath,l=Oo(pu(a),a||"",!1,!1,!!o.autoIncrement,a&&typeof a!="string",!0),u=[];for(let h=0;h<o.indexNames.length;++h){let f=o.index(o.indexNames[h]);a=f.keyPath;var c=Oo(f.name,a,!!f.unique,!!f.multiEntry,!1,a&&typeof a!="string",!1);u.push(c)}r[s]=mu(s,l,u)}),r}function Kd({_novip:n},e,t){n.verno=e.version/10;let r=n._dbSchema=Zo(n,e,t);n._storeNames=ji(e.objectStoreNames,0),Li(n,[n._allTables],ge(r),r)}function $d(n,e){let t=Zo(n,n.idbdb,e),r=gu(t,n._dbSchema);return!(r.add.length||r.change.some(i=>i.add.length||i.change.length))}function Ro({_novip:n},e,t){let r=t.db.objectStoreNames;for(let i=0;i<r.length;++i){let s=r[i],o=t.objectStore(s);n._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){let l=o.indexNames[a],u=o.index(l).keyPath,c=typeof u=="string"?u:"["+ji(u).join("+")+"]";if(e[s]){let h=e[s].idxByName[c];h&&(h.name=l,delete e[s].idxByName[c],e[s].idxByName[l]=h)}}}typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&ce.WorkerGlobalScope&&ce instanceof ce.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}function Wd(n){return n.split(",").map((e,t)=>{e=e.trim();let r=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return Oo(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),Ae(i),t===0)})}var No=class{_parseStoresSpec(e,t){ge(e).forEach(r=>{if(e[r]!==null){var i=Wd(e[r]),s=i.shift();if(s.multi)throw new W.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new W.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new W.Schema("Index must have a name and cannot be an empty string")}),t[r]=mu(r,s,i)}})}stores(e){let t=this.db;this._cfg.storesSource=this._cfg.storesSource?Pe(this._cfg.storesSource,e):e;let r=t._versions,i={},s={};return r.forEach(o=>{Pe(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),t._dbSchema=s,Do(t,[t._allTables,t,t.Transaction.prototype]),Li(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],ge(s),s),t._storeNames=ge(s),this}upgrade(e){return this._cfg.contentUpgrade=qo(this._cfg.contentUpgrade||oe,e),this}};function Ud(n){return _r(No.prototype,function(t){this.db=n,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function ea(n,e){let t=n._dbNamesDB;return t||(t=n._dbNamesDB=new He(Vi,{addons:[],indexedDB:n,IDBKeyRange:e}),t.version(1).stores({dbnames:"name"})),t.table("dbnames")}function ta(n){return n&&typeof n.databases=="function"}function Hd({indexedDB:n,IDBKeyRange:e}){return ta(n)?Promise.resolve(n.databases()).then(t=>t.map(r=>r.name).filter(r=>r!==Vi)):ea(n,e).toCollection().primaryKeys()}function qd({indexedDB:n,IDBKeyRange:e},t){!ta(n)&&t!==Vi&&ea(n,e).put({name:t}).catch(oe)}function Gd({indexedDB:n,IDBKeyRange:e},t){!ta(n)&&t!==Vi&&ea(n,e).delete(t).catch(oe)}function jo(n){return Lt(function(){return K.letThrough=!0,n()})}function Xd(){var n=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!n||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(t){var r=function(){return indexedDB.databases().finally(t)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)})}function Yd(n){let e=n._state,{indexedDB:t}=n._deps;if(e.isBeingOpened||n.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?_e(e.dbOpenError):n);ft&&(e.openCanceller._stackHolder=on()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;let r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new W.DatabaseClosed("db.open() was cancelled")}let s=e.dbReadyResolve,o=null,a=!1;return R.race([r,(typeof navigator=="undefined"?R.resolve():Xd()).then(()=>new R((l,u)=>{if(i(),!t)throw new W.MissingAPI;let c=n.name,h=e.autoSchema?t.open(c):t.open(c,Math.round(n.verno*10));if(!h)throw new W.MissingAPI;h.onerror=ct(u),h.onblocked=he(n._fireOnBlocked),h.onupgradeneeded=he(f=>{if(o=h.transaction,e.autoSchema&&!n._options.allowEmptyDB){h.onerror=cr,o.abort(),h.result.close();let p=t.deleteDatabase(c);p.onsuccess=p.onerror=he(()=>{u(new W.NoSuchDatabase(`Database ${c} doesnt exist`))})}else{o.onerror=ct(u);var d=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;a=d<1,n._novip.idbdb=h.result,jd(n,d/10,o,u)}},u),h.onsuccess=he(()=>{o=null;let f=n._novip.idbdb=h.result,d=ji(f.objectStoreNames);if(d.length>0)try{let p=f.transaction(Md(d),"readonly");e.autoSchema?Kd(n,f,p):(Ro(n,n._dbSchema,p),$d(n,p)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Qo(n,p)}catch(p){}sr.push(n),f.onversionchange=he(p=>{e.vcFired=!0,n.on("versionchange").fire(p)}),f.onclose=he(p=>{n.on("close").fire(p)}),a&&qd(n._deps,c),l()},u)}))]).then(()=>(i(),e.onReadyBeingFired=[],R.resolve(jo(()=>n.on.ready.fire(n.vip))).then(function l(){if(e.onReadyBeingFired.length>0){let u=e.onReadyBeingFired.reduce(qo,oe);return e.onReadyBeingFired=[],R.resolve(jo(()=>u(n.vip))).then(l)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>n).catch(l=>{e.dbOpenError=l;try{o&&o.abort()}catch(u){}return r===e.openCanceller&&n._close(),_e(l)}).finally(()=>{e.openComplete=!0,s()})}function Bo(n){var e=o=>n.next(o),t=o=>n.throw(o),r=s(e),i=s(t);function s(o){return a=>{var l=o(a),u=l.value;return l.done?u:!u||typeof u.then!="function"?Ae(u)?Promise.all(u).then(r,i):r(u):u.then(r,i)}}return s(e)()}function Qd(n,e,t){var r=arguments.length;if(r<2)throw new W.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];t=i.pop();var s=Xl(i);return[n,s,t]}function yu(n,e,t,r,i){return R.resolve().then(()=>{let s=K.transless||K,o=n._createTransaction(e,t,n._dbSchema,r),a={trans:o,transless:s};if(r)o.idbtrans=r.idbtrans;else try{o.create(),n._state.PR1398_maxLoop=3}catch(h){return h.name===Ho.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>yu(n,e,t,null,i))):_e(h)}let l=Wo(i);l&&Pn();let u,c=R.follow(()=>{if(u=i.call(o,o),u)if(l){var h=St.bind(null,null);u.then(h,h)}else typeof u.next=="function"&&typeof u.throw=="function"&&(u=Bo(u))},a);return(u&&typeof u.then=="function"?R.resolve(u).then(h=>o.active?h:_e(new W.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):c.then(()=>u)).then(h=>(r&&o._resolve(),o._completion.then(()=>h))).catch(h=>(o._reject(h),_e(h)))})}function wi(n,e,t){let r=Ae(n)?n.slice():[n];for(let i=0;i<t;++i)r.push(e);return r}function Jd(n){return{...n,table(e){let t=n.table(e),{schema:r}=t,i={},s=[];function o(f,d,p){let m=or(f),y=i[m]=i[m]||[],g=f==null?0:typeof f=="string"?1:f.length,_=d>0,w={...p,isVirtual:_,keyTail:d,keyLength:g,extractKey:ko(f),unique:!_&&p.unique};if(y.push(w),w.isPrimaryKey||s.push(w),g>1){let b=g===2?f[0]:f.slice(0,g-1);o(b,d+1,p)}return y.sort((b,S)=>b.keyTail-S.keyTail),w}let a=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(let f of r.indexes)o(f.keyPath,0,f);function l(f){let d=i[or(f)];return d&&d[0]}function u(f,d){return{type:f.type===1?2:f.type,lower:wi(f.lower,f.lowerOpen?n.MAX_KEY:n.MIN_KEY,d),lowerOpen:!0,upper:wi(f.upper,f.upperOpen?n.MIN_KEY:n.MAX_KEY,d),upperOpen:!0}}function c(f){let d=f.query.index;return d.isVirtual?{...f,query:{index:d,range:u(f.query.range,d.keyTail)}}:f}return{...t,schema:{...r,primaryKey:a,indexes:s,getIndexByKeyPath:l},count(f){return t.count(c(f))},query(f){return t.query(c(f))},openCursor(f){let{keyTail:d,isVirtual:p,keyLength:m}=f.query.index;if(!p)return t.openCursor(f);function y(g){function _(b){b!=null?g.continue(wi(b,f.reverse?n.MAX_KEY:n.MIN_KEY,d)):f.unique?g.continue(g.key.slice(0,m).concat(f.reverse?n.MIN_KEY:n.MAX_KEY,d)):g.continue()}return Object.create(g,{continue:{value:_},continuePrimaryKey:{value(b,S){g.continuePrimaryKey(wi(b,n.MAX_KEY,d),S)}},primaryKey:{get(){return g.primaryKey}},key:{get(){let b=g.key;return m===1?b[0]:b.slice(0,m)}},value:{get(){return g.value}}})}return t.openCursor(c(f)).then(g=>g&&y(g))}}}}}var Zd={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Jd};function na(n,e,t,r){return t=t||{},r=r||"",ge(n).forEach(i=>{if(!Ve(e,i))t[r+i]=void 0;else{var s=n[i],o=e[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){let a=go(s),l=go(o);a!==l?t[r+i]=e[i]:a==="Object"?na(s,o,t,r+i+"."):s!==o&&(t[r+i]=e[i])}else s!==o&&(t[r+i]=e[i])}}),ge(e).forEach(i=>{Ve(n,i)||(t[r+i]=e[i])}),t}function ep(n,e){return e.type==="delete"?e.keys:e.keys||e.values.map(n.extractKey)}var tp={stack:"dbcore",name:"HooksMiddleware",level:2,create:n=>({...n,table(e){let t=n.table(e),{primaryKey:r}=t.schema;return{...t,mutate(s){let o=K.trans,{deleting:a,creating:l,updating:u}=o.table(e).hook;switch(s.type){case"add":if(l.fire===oe)break;return o._promise("readwrite",()=>c(s),!0);case"put":if(l.fire===oe&&u.fire===oe)break;return o._promise("readwrite",()=>c(s),!0);case"delete":if(a.fire===oe)break;return o._promise("readwrite",()=>c(s),!0);case"deleteRange":if(a.fire===oe)break;return o._promise("readwrite",()=>h(s),!0)}return t.mutate(s);function c(d){let p=K.trans,m=d.keys||ep(r,d);if(!m)throw new Error("Keys missing");return d=d.type==="add"||d.type==="put"?{...d,keys:m}:{...d},d.type!=="delete"&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),np(t,d,m).then(y=>{let g=m.map((_,w)=>{let b=y[w],S={onerror:null,onsuccess:null};if(d.type==="delete")a.fire.call(S,_,b,p);else if(d.type==="add"||b===void 0){let A=l.fire.call(S,_,d.values[w],p);_==null&&A!=null&&(_=A,d.keys[w]=_,r.outbound||nt(d.values[w],r.keyPath,_))}else{let A=na(b,d.values[w]),T=u.fire.call(S,A,_,b,p);if(T){let F=d.values[w];Object.keys(T).forEach(k=>{Ve(F,k)?F[k]=T[k]:nt(F,k,T[k])})}}return S});return t.mutate(d).then(({failures:_,results:w,numFailures:b,lastResult:S})=>{for(let A=0;A<m.length;++A){let T=w?w[A]:m[A],F=g[A];T==null?F.onerror&&F.onerror(_[A]):F.onsuccess&&F.onsuccess(d.type==="put"&&y[A]?d.values[A]:T)}return{failures:_,results:w,numFailures:b,lastResult:S}}).catch(_=>(g.forEach(w=>w.onerror&&w.onerror(_)),Promise.reject(_)))})}function h(d){return f(d.trans,d.range,1e4)}function f(d,p,m){return t.query({trans:d,values:!1,query:{index:r,range:p},limit:m}).then(({result:y})=>c({type:"delete",keys:y,trans:d}).then(g=>g.numFailures>0?Promise.reject(g.failures[0]):y.length<m?{failures:[],numFailures:0,lastResult:void 0}:f(d,{...p,lower:y[y.length-1],lowerOpen:!0},m)))}}}}})};function np(n,e,t){return e.type==="add"?Promise.resolve([]):n.getMany({trans:e.trans,keys:t,cache:"immutable"})}function vu(n,e,t){try{if(!e||e.keys.length<n.length)return null;let r=[];for(let i=0,s=0;i<e.keys.length&&s<n.length;++i)Fe(e.keys[i],n[s])===0&&(r.push(t?pr(e.values[i]):e.values[i]),++s);return r.length===n.length?r:null}catch(r){return null}}var rp={stack:"dbcore",level:-1,create:n=>({table:e=>{let t=n.table(e);return{...t,getMany:r=>{if(!r.cache)return t.getMany(r);let i=vu(r.keys,r.trans._cache,r.cache==="clone");return i?R.resolve(i):t.getMany(r).then(s=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?pr(s):s},s))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),t.mutate(r))}}})};function ra(n){return!("from"in n)}var _t=function(n,e){if(this)Pe(this,arguments.length?{d:1,from:n,to:arguments.length>1?e:n}:{d:0});else{let t=new _t;return n&&"d"in n&&Pe(t,n),t}};Tn(_t.prototype,{add(n){return Ri(this,n),this},addKey(n){return dr(this,n,n),this},addKeys(n){return n.forEach(e=>dr(this,e,e)),this},[yo](){return zo(this)}});function dr(n,e,t){let r=Fe(e,t);if(isNaN(r))return;if(r>0)throw RangeError();if(ra(n))return Pe(n,{from:e,to:t,d:1});let i=n.l,s=n.r;if(Fe(t,n.from)<0)return i?dr(i,e,t):n.l={from:e,to:t,d:1,l:null,r:null},Kl(n);if(Fe(e,n.to)>0)return s?dr(s,e,t):n.r={from:e,to:t,d:1,l:null,r:null},Kl(n);Fe(e,n.from)<0&&(n.from=e,n.l=null,n.d=s?s.d+1:1),Fe(t,n.to)>0&&(n.to=t,n.r=null,n.d=n.l?n.l.d+1:1);let o=!n.r;i&&!n.l&&Ri(n,i),s&&o&&Ri(n,s)}function Ri(n,e){function t(r,{from:i,to:s,l:o,r:a}){dr(r,i,s),o&&t(r,o),a&&t(r,a)}ra(e)||t(n,e)}function ip(n,e){let t=zo(e),r=t.next();if(r.done)return!1;let i=r.value,s=zo(n),o=s.next(i.from),a=o.value;for(;!r.done&&!o.done;){if(Fe(a.from,i.to)<=0&&Fe(a.to,i.from)>=0)return!0;Fe(i.from,a.from)<0?i=(r=t.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}function zo(n){let e=ra(n)?null:{s:0,n};return{next(t){let r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&Fe(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||Fe(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Kl(n){var e,t;let r=(((e=n.r)===null||e===void 0?void 0:e.d)||0)-(((t=n.l)===null||t===void 0?void 0:t.d)||0),i=r>1?"r":r<-1?"l":"";if(i){let s=i==="r"?"l":"r",o={...n},a=n[i];n.from=a.from,n.to=a.to,n[i]=a[i],o[i]=a[s],n[s]=o,o.d=$l(o)}n.d=$l(n)}function $l({r:n,l:e}){return(n?e?Math.max(n.d,e.d):n.d:e?e.d:0)+1}var sp={stack:"dbcore",level:0,create:n=>{let e=n.schema.name,t=new _t(n.MIN_KEY,n.MAX_KEY);return{...n,table:r=>{let i=n.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:l}=o,u={...i,mutate:f=>{let d=f.trans,p=d.mutatedParts||(d.mutatedParts={}),m=A=>{let T=`idb://${e}/${r}/${A}`;return p[T]||(p[T]=new _t)},y=m(""),g=m(":dels"),{type:_}=f,[w,b]=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[[],f.values]:[],S=f.trans._cache;return i.mutate(f).then(A=>{if(Ae(w)){_!=="delete"&&(w=A.results),y.addKeys(w);let T=vu(w,S);!T&&_!=="add"&&g.addKeys(w),(T||b)&&op(m,s,T,b)}else if(w){let T={from:w.lower,to:w.upper};g.add(T),y.add(T)}else y.add(t),g.add(t),s.indexes.forEach(T=>m(T.name).add(t));return A})}},c=({query:{index:f,range:d}})=>{var p,m;return[f,new _t((p=d.lower)!==null&&p!==void 0?p:n.MIN_KEY,(m=d.upper)!==null&&m!==void 0?m:n.MAX_KEY)]},h={get:f=>[o,new _t(f.key)],getMany:f=>[o,new _t().addKeys(f.keys)],count:c,query:c,openCursor:c};return ge(h).forEach(f=>{u[f]=function(d){let{subscr:p}=K;if(p){let m=b=>{let S=`idb://${e}/${r}/${b}`;return p[S]||(p[S]=new _t)},y=m(""),g=m(":dels"),[_,w]=h[f](d);if(m(_.name||"").add(w),!_.isPrimaryKey)if(f==="count")g.add(t);else{let b=f==="query"&&l&&d.values&&i.query({...d,values:!1});return i[f].apply(this,arguments).then(S=>{if(f==="query"){if(l&&d.values)return b.then(({result:T})=>(y.addKeys(T),S));let A=d.values?S.result.map(a):S.result;d.values?y.addKeys(A):g.addKeys(A)}else if(f==="openCursor"){let A=S,T=d.values;return A&&Object.create(A,{key:{get(){return g.addKey(A.primaryKey),A.key}},primaryKey:{get(){let F=A.primaryKey;return g.addKey(F),F}},value:{get(){return T&&y.addKey(A.primaryKey),A.value}}})}return S})}}return i[f].apply(this,arguments)}}),u}}}};function op(n,e,t,r){function i(s){let o=n(s.name||"");function a(u){return u!=null?s.extractKey(u):null}let l=u=>s.multiEntry&&Ae(u)?u.forEach(c=>o.addKey(c)):o.addKey(u);(t||r).forEach((u,c)=>{let h=t&&a(t[c]),f=r&&a(r[c]);Fe(h,f)!==0&&(h!=null&&l(h),f!=null&&l(f))})}e.indexes.forEach(i)}var He=class{constructor(e,t){this._middlewares={},this.verno=0;let r=He.dependencies;this._options=t={addons:He.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};let{addons:i}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;let s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:oe,dbReadyPromise:null,cancelOpen:oe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};s.dbReadyPromise=new R(o=>{s.dbReadyResolve=o}),s.openCanceller=new R((o,a)=>{s.cancelOpen=a}),this._state=s,this.name=e,this.on=vr(this,"populate","blocked","versionchange","close",{ready:[qo,oe]}),this.on.ready.subscribe=Ul(this.on.ready.subscribe,o=>(a,l)=>{He.vip(()=>{let u=this._state;if(u.openComplete)u.dbOpenError||R.resolve().then(a),l&&o(a);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(a),l&&o(a);else{o(a);let c=this;l||o(function h(){c.on.ready.unsubscribe(a),c.on.ready.unsubscribe(h)})}})}),this.Collection=Ed(this),this.Table=_d(this),this.Transaction=Id(this),this.Version=Ud(this),this.WhereClause=Pd(this),this.on("versionchange",o=>{o.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",o=>{!o.newVersion||o.newVersion<o.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${o.oldVersion/10}`)}),this._maxKey=hr(t.IDBKeyRange),this._createTransaction=(o,a,l,u)=>new this.Transaction(o,a,l,this._options.chromeTransactionDurability,u),this._fireOnBlocked=o=>{this.on("blocked").fire(o),sr.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(o))},this.use(Zd),this.use(tp),this.use(sp),this.use(rp),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(o=>o(this))}version(e){if(isNaN(e)||e<.1)throw new W.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new W.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);let t=this._versions;var r=t.filter(i=>i._cfg.version===e)[0];return r||(r=new this.Version(e),t.push(r),t.sort(Nd),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||K.letThrough||this._vip)?e():new R((t,r)=>{if(this._state.openComplete)return r(new W.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen){r(new W.DatabaseClosed);return}this.open().catch(oe)}this._state.dbReadyPromise.then(t,r)}).then(e)}use({stack:e,create:t,level:r,name:i}){i&&this.unuse({stack:e,name:i});let s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:t,level:r==null?10:r,name:i}),s.sort((o,a)=>o.level-a.level),this}unuse({stack:e,name:t,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>r?i.create!==r:t?i.name!==t:!1)),this}open(){return Yd(this)}_close(){let e=this._state,t=sr.indexOf(this);if(t>=0&&sr.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(r){}this._novip.idbdb=null}e.dbReadyPromise=new R(r=>{e.dbReadyResolve=r}),e.openCanceller=new R((r,i)=>{e.cancelOpen=i})}close(){this._close();let e=this._state;this._options.autoOpen=!1,e.dbOpenError=new W.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){let e=arguments.length>0,t=this._state;return new R((r,i)=>{let s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=he(()=>{Gd(this._deps,this.name),r()}),o.onerror=ct(i),o.onblocked=this._fireOnBlocked};if(e)throw new W.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){let e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return ge(this._allTables).map(e=>this._allTables[e])}transaction(){let e=Qd.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,r){let i=K.trans;(!i||i.db!==this||e.indexOf("!")!==-1)&&(i=null);let s=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");let o,a;try{if(a=t.map(u=>{var c=u instanceof this.Table?u.name:u;if(typeof c!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return c}),e=="r"||e===uo)o=uo;else if(e=="rw"||e==co)o=co;else throw new W.InvalidArgument("Invalid transaction mode: "+e);if(i){if(i.mode===uo&&o===co)if(s)i=null;else throw new W.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i&&a.forEach(u=>{if(i&&i.storeNames.indexOf(u)===-1)if(s)i=null;else throw new W.SubTransaction("Table "+u+" not included in parent transaction.")}),s&&i&&!i.active&&(i=null)}}catch(u){return i?i._promise(null,(c,h)=>{h(u)}):_e(u)}let l=yu.bind(null,this,o,a,i,r);return i?i._promise(o,l,"lock"):K.trans?In(K.transless,()=>this._whenReady(l)):this._whenReady(l)}table(e){if(!Ve(this._allTables,e))throw new W.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}},ap=typeof Symbol!="undefined"&&"observable"in Symbol?Symbol.observable:"@@observable",Vo=class{constructor(e){this._subscribe=e}subscribe(e,t,r){return this._subscribe(!e||typeof e=="function"?{next:e,error:t,complete:r}:e)}[ap](){return this}};function _u(n,e){return ge(e).forEach(t=>{let r=n[t]||(n[t]=new _t);Ri(r,e[t])}),n}function lp(n){let e=!1,t,r=new Vo(i=>{let s=Wo(n);function o(y){s&&Pn();let g=()=>Lt(n,{subscr:y,trans:null}),_=K.trans?In(K.transless,g):g();return s&&_.then(St,St),_}let a=!1,l={},u={},c={get closed(){return a},unsubscribe:()=>{a=!0,Nt.storagemutated.unsubscribe(p)}};i.start&&i.start(c);let h=!1,f=!1;function d(){return ge(u).some(y=>l[y]&&ip(l[y],u[y]))}let p=y=>{_u(l,y),d()&&m()},m=()=>{if(h||a)return;l={};let y={},g=o(y);f||(Nt(fr,p),f=!0),h=!0,Promise.resolve(g).then(_=>{e=!0,t=_,h=!1,!a&&(d()?m():(l={},u=y,i.next&&i.next(_)))},_=>{h=!1,e=!1,i.error&&i.error(_),c.unsubscribe()})};return m(),c});return r.hasValue=()=>e,r.getValue=()=>t,r}var Ko;try{Ko={indexedDB:ce.indexedDB||ce.mozIndexedDB||ce.webkitIndexedDB||ce.msIndexedDB,IDBKeyRange:ce.IDBKeyRange||ce.webkitIDBKeyRange}}catch(n){Ko={indexedDB:null,IDBKeyRange:null}}var Zt=He;Tn(Zt,{...Bi,delete(n){return new Zt(n,{addons:[]}).delete()},exists(n){return new Zt(n,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1)},getDatabaseNames(n){try{return Hd(Zt.dependencies).then(n)}catch(e){return _e(new W.MissingAPI)}},defineClass(){function n(e){Pe(this,e)}return n},ignoreTransaction(n){return K.trans?In(K.transless,n):n()},vip:jo,async:function(n){return function(){try{var e=Bo(n.apply(this,arguments));return!e||typeof e.then!="function"?R.resolve(e):e}catch(t){return _e(t)}}},spawn:function(n,e,t){try{var r=Bo(n.apply(t,e||[]));return!r||typeof r.then!="function"?R.resolve(r):r}catch(i){return _e(i)}},currentTransaction:{get:()=>K.trans||null},waitFor:function(n,e){let t=R.resolve(typeof n=="function"?Zt.ignoreTransaction(n):n).timeout(e||6e4);return K.trans?K.trans.waitFor(t):t},Promise:R,debug:{get:()=>ft,set:n=>{Ql(n,n==="dexie"?()=>!0:fu)}},derive:Cn,extend:Pe,props:Tn,override:Ul,Events:vr,on:Nt,liveQuery:lp,extendObservabilitySet:_u,getByKeyPath:xt,setByKeyPath:nt,delByKeyPath:Uh,shallowClone:Gl,deepClone:pr,getObjectDiff:na,cmp:Fe,asap:Hl,minKey:Fo,addons:[],connections:sr,errnames:Ho,dependencies:Ko,semVer:Rl,version:Rl.split(".").map(n=>parseInt(n)).reduce((n,e,t)=>n+e/Math.pow(10,t*2))});Zt.maxKey=hr(Zt.dependencies.IDBKeyRange);typeof dispatchEvent!="undefined"&&typeof addEventListener!="undefined"&&(Nt(fr,n=>{if(!wt){let e;zi?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Dt,!0,!0,n)):e=new CustomEvent(Dt,{detail:n}),wt=!0,dispatchEvent(e),wt=!1}}),addEventListener(Dt,({detail:n})=>{wt||Ni(n)}));function Ni(n){let e=wt;try{wt=!0,Nt.storagemutated.fire(n)}finally{wt=e}}var wt=!1;if(typeof BroadcastChannel!="undefined"){let n=new BroadcastChannel(Dt);typeof n.unref=="function"&&n.unref(),Nt(fr,e=>{wt||n.postMessage(e)}),n.onmessage=e=>{e.data&&Ni(e.data)}}else if(typeof self!="undefined"&&typeof navigator!="undefined"){Nt(fr,e=>{try{wt||(typeof localStorage!="undefined"&&localStorage.setItem(Dt,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(t=>t.postMessage({type:Dt,changedParts:e})))}catch(t){}}),typeof addEventListener!="undefined"&&addEventListener("storage",e=>{if(e.key===Dt){let t=JSON.parse(e.newValue);t&&Ni(t.changedParts)}});let n=self.document&&navigator.serviceWorker;n&&n.addEventListener("message",up)}function up({data:n}){n&&n.type===Dt&&Ni(n.changedParts)}R.rejectionMapper=ed;Ql(ft,fu);var Au=require("obsidian");var bu=require("obsidian");var wu=ue(fe());var qe=class{constructor(){this.app=x(bu.App);this.plugin=x(et);this.obsidianFs=this.app.vault.adapter}getVaultAbsolutePath(){return this.obsidianFs.getBasePath().replace(/\\/g,"/")+"/"}getAbsolutePath(e){return ke.join(this.getVaultAbsolutePath(),e)}getFileBacklinks(e){this.app.metadataCache.getBacklinksForFile(e)}getAppId(){return this.app.appId}executeCommandById(e){this.app.commands.executeCommandById(e)}isNotObsidianExcludedPath(e){return!(this.app.metadataCache.isUserIgnored&&this.app.metadataCache.isUserIgnored(e))}};qe=B([(0,wu.singleton)()],qe);var Mn=require("obsidian");var Ge=class extends Mn.Notice{constructor(e,t=0){super(e+`
(clever-search)`,t)}},Ki=class extends Mn.AbstractInputSuggest{constructor(t,r,i){super(x(Mn.App),t);this.inputEl=t;this.onSelectCb=i;this.content=r}getSuggestions(t){return[...this.content].filter(r=>r.toLowerCase().contains(t.toLowerCase()))}renderSuggestion(t,r){r.setText(t)}selectSuggestion(t,r){this.onSelectCb(t),this.inputEl.value="",this.close()}},ia=class{},zg=new ia;var Su=require("obsidian");var sa={"Reindexing...":"Reindexing...","Indexing finished":"Indexing finished","files need to be indexed. Obsidian may freeze for a while":"files need to be indexed. Obsidian may freeze for a while","Omnisearch isn't installed":"Omnisearch isn't installed","Omnisearch is installed but not enabled":"Omnisearch is installed but not enabled","Database has been updated, a reindex is required":"Database has been updated, a reindex is required","Max items count":"Max items count","Max items count desc":"Due to renderer's limited capabilities, this plugin can find thousands of results, but cannot display them all at once","Floating window for in-file search":"Floating window for in-file search","Floating window for in-file search desc":"Execute 'in-file search' command again will close the existing floating window. Disable this option to use classic modal UI","English word blacklist":"English word blacklist","English word blacklist desc":`Exclude some meaningless English words like "do", "and", "them" from indexing, enhancing search and indexing speed. Modify the file at ${gi} to tailor the list to your needs.`,"Chinese patch":"Chinese patch","Chinese patch desc":"Better search result for Chinese","Chinese word blacklist":"Chinese word blacklist","Chinese word blacklist desc":`Activates only if the Chinese Patch is enabled. This excludes some meaningless Chinese words like "\u7684", "\u6240\u4EE5", "\u5C3D\u7BA1" listed in 'stop-words-zh.txt', improving search efficiency and speed. More details are listed in "English word blacklist" option`,Advanced:"Advanced","Advanced.desc":"The previous settings cover most needs. For further customization, adjust the following options","Excluded files":"Excluded files",Manage:"Manage","Follow Obsidian Excluded Files":"Follow Obsidian Excluded Files","Enter path...":"Enter path...",Add:"Add","Customize extensions":"Customize extensions","extensionModal.desc":"Customize the file extensions you would like to index. By default, file types not natively supported by Obsidian, such as 'txt', will be opened with an external program. To open these files within Obsidian, you may need to install plugins like 'obsidian-custom-file-extension-plugin' or 'obsidian-vscode-editor'.","extensionModal.plaintextName":"Plaintext","extensionModal.plaintextDesc":"Extensions should be separated by a space or a newline character. Please do not include binary filetypes like 'pdf', 'jpg', 'mp4', etc, that can't be opened with notepad. Including them might cause indexing issues. Additionally, the indexing and searching of HTML files may be slower because they require conversion to clean Markdown format first. Furthermore, due to the extremely limited API, it seems impossible to automatically scroll to specific locations within HTML files.","For Development":"For Development","Collapse development setting by default":"Collapse development setting by default","Reindex the vault":"Reindex the vault",Reindex:"Reindex","Log level":"Log level","Reset floating window position":"Reset floating window position","Reset floating window position desc":"In case the window is moved outside the visible area","Reset position":"Reset position","Support the Project":"Support the Project","Support the Project desc":"Enjoying this plugin? Show your support with a star on GitHub!","Visit GitHub":"Visit GitHub"};var xu={"Reindexing...":"\u91CD\u5EFA\u7D22\u5F15\u4E2D...","Indexing finished":"\u7D22\u5F15\u5B8C\u6210","files need to be indexed. Obsidian may freeze for a while":"\u6587\u4EF6\u9700\u8981\u88AB\u7D22\u5F15, Obsidian \u53EF\u80FD\u4F1A\u5361\u987F\u4E00\u4F1A\u513F","Omnisearch isn't installed":"\u672A\u5B89\u88C5 Omnisearch","Omnisearch is installed but not enabled":"\u5B89\u88C5\u4E86 Omnisearch \u4F46\u662F\u6CA1\u6709\u542F\u7528","Database has been updated, a reindex is required":"\u6570\u636E\u5E93\u5DF2\u66F4\u65B0\uFF0C\u9700\u8981\u91CD\u5EFA\u7D22\u5F15","Max items count":"\u6700\u5927\u5019\u9009\u9879\u6570","Max items count desc":"\u867D\u7136\u672C\u63D2\u4EF6\u53EF\u4EE5\u641C\u7D22\u5230\u6210\u5343\u4E0A\u4E07\u4E2A\u7ED3\u679C\uFF0C\u4F46\u7531\u4E8E\u5E95\u5C42\u6E32\u67D3\u5668\u6027\u80FD\u9650\u5236\uFF0C\u4E0D\u80FD\u5373\u65F6\u6E32\u67D3\u6240\u6709\u7ED3\u679C","Floating window for in-file search":"\u6587\u4EF6\u5185\u641C\u7D22\u4F7F\u7528\u60AC\u6D6E\u7A97\u53E3 UI","Floating window for in-file search desc":"\u518D\u6B21\u6267\u884C '\u6587\u4EF6\u5185\u641C\u7D22' \u547D\u4EE4\u4F1A\u5173\u95ED\u5DF2\u6709\u7684\u60AC\u6D6E\u7A97\u53E3\u3002\u5173\u95ED\u8FD9\u4E2A\u9009\u9879\u5C06\u4F7F\u7528\u6A21\u6001\u6846 UI","English word blacklist":"\u82F1\u6587\u5355\u8BCD\u9ED1\u540D\u5355","English word blacklist desc":`\u5EFA\u7ACB\u7D22\u5F15\u65F6\uFF0C\u5FFD\u7565\u4E00\u4E9B\u542B\u4E49\u6A21\u7CCA\u7684\u5355\u8BCD\uFF0C\u6BD4\u5982 "do", "and", "them", \u53EF\u4EE5\u52A0\u5FEB\u7D22\u5F15\u548C\u641C\u7D22\u901F\u5EA6\uFF0C\u4F46\u662F\u8FD9\u4E9B\u5355\u8BCD\u4E0D\u4F1A\u88AB\u641C\u7D22\u5230. \u53EF\u4EE5\u5728 ${gi} \u6309\u9700\u4FEE\u6539\u5355\u8BCD\u9ED1\u540D\u5355`,"Chinese patch":"\u4E2D\u6587\u641C\u7D22\u4F18\u5316","Chinese patch desc":"\u66F4\u597D\u7684\u4E2D\u6587\u641C\u7D22\u7ED3\u679C","Chinese word blacklist":"\u4E2D\u6587\u8BCD\u8BED\u9ED1\u540D\u5355","Chinese word blacklist desc":'\u53EA\u5728\u5F00\u542F\u4E2D\u6587\u641C\u7D22\u4F18\u5316\u65F6\u751F\u6548\u3002\u5FFD\u7565 "\u7684", "\u6240\u4EE5", "\u5C3D\u7BA1" \u7B49\u8BCD\u8BED\uFF0C\u8BE6\u7EC6\u5217\u8868\u5728 "stop-words-zh.txt"\u3002\u8BE6\u89C1 "\u82F1\u6587\u5355\u8BCD\u9ED1\u540D\u5355" \u9009\u9879',Advanced:"\u8FDB\u9636\u8BBE\u7F6E","Advanced.desc":"\u4E4B\u524D\u7684\u8BBE\u7F6E\u901A\u5E38\u80FD\u6EE1\u8DB3\u5927\u591A\u6570\u4F7F\u7528\u573A\u666F\uFF0C\u5982\u679C\u4F60\u60F3\u6709\u66F4\u4E2A\u6027\u5316\u7684\u8BBE\u7F6E\uFF0C\u53EF\u4EE5\u8C03\u6574\u4E0B\u9762\u7684\u9009\u9879","Excluded files":"\u5FFD\u7565\u6587\u4EF6",Manage:"\u7BA1\u7406","Follow Obsidian Excluded Files":"\u8DDF\u968F Obsidian \u5FFD\u7565\u6587\u4EF6\u8BBE\u7F6E","Enter path...":"\u8BF7\u8F93\u5165\u8DEF\u5F84...",Add:"\u6DFB\u52A0","Customize extensions":"\u81EA\u5B9A\u4E49\u540E\u7F00\u540D","extensionModal.desc":"\u81EA\u5B9A\u4E49\u5E0C\u671B\u7D22\u5F15\u7684\u6587\u4EF6\u540E\u7F00\u540D\u3002\u9ED8\u8BA4\u60C5\u51B5\u4E0B Obsidian \u4E0D\u539F\u751F\u652F\u6301\u7684\u6587\u4EF6\u7C7B\u578B\uFF0C\u5982 'txt'\uFF0C\u5C06\u901A\u8FC7\u5916\u90E8\u7A0B\u5E8F\u6253\u5F00\u3002\u8981\u5728 Obsidian \u5185\u6253\u5F00\u8FD9\u4E9B\u6587\u4EF6\uFF0C\u53EF\u80FD\u9700\u8981\u5B89\u88C5\u63D2\u4EF6\uFF0C\u5982 'obsidian-custom-file-extension-plugin' \u6216 'obsidian-vscode-editor'\u3002","extensionModal.plaintextName":"\u7EAF\u6587\u672C","extensionModal.plaintextDesc":"\u540E\u7F00\u540D\u4F7F\u7528\u7A7A\u683C\u6216\u6362\u884C\u7B26\u5206\u9694\u3002\u8BF7\u4E0D\u8981\u5728\u6B64\u5904\u5305\u542B 'pdf'\u3001'jpg'\u3001'mp4' \u7B49\u65E0\u6CD5\u7528\u8BB0\u4E8B\u672C\u6253\u5F00\u7684\u4E8C\u8FDB\u5236\u6587\u4EF6\uFF0C\u5426\u5219\u53EF\u80FD\u4F1A\u5BFC\u81F4\u7D22\u5F15\u95EE\u9898\u3002\u53E6\u5916\uFF0C\u7D22\u5F15\u548C\u641C\u7D22 HTML \u6587\u4EF6\u53EF\u80FD\u4F1A\u66F4\u6162\uFF0C\u56E0\u4E3A\u5B83\u4EEC\u9996\u5148\u9700\u8981\u8F6C\u6362\u4E3A\u5E72\u51C0\u7684 Markdown \u683C\u5F0F\u3002\u6B64\u5916\uFF0C\u53D7 API \u9650\u5236, \u81EA\u52A8\u6EDA\u52A8\u5230 HTML \u6587\u4EF6\u4E2D\u7684\u7279\u5B9A\u4F4D\u7F6E\u4F3C\u4E4E\u4E0D\u53EF\u884C\u3002","For Development":"\u5F00\u53D1\u8BBE\u7F6E","Collapse development setting by default":"\u9ED8\u8BA4\u6298\u53E0\u5F00\u53D1\u8BBE\u7F6E","Reindex the vault":"\u91CD\u65B0\u7D22\u5F15\u5168\u5E93",Reindex:"\u91CD\u65B0\u7D22\u5F15","Log level":"\u65E5\u5FD7\u7B49\u7EA7","Reset floating window position":"\u91CD\u7F6E\u60AC\u6D6E\u7A97\u53E3\u4F4D\u7F6E","Reset floating window position desc":"\u5982\u679C\u7A97\u53E3\u88AB\u62D6\u5230\u770B\u4E0D\u89C1\u7684\u4F4D\u7F6E, \u53EF\u4EE5\u70B9\u6B64\u6309\u94AE\u91CD\u7F6E","Reset position":"\u91CD\u7F6E\u4F4D\u7F6E","Support the Project":"\u652F\u6301\u8FD9\u4E2A\u9879\u76EE","Support the Project desc":"\u5982\u679C\u89C9\u5F97\u672C\u63D2\u4EF6\u5BF9\u4F60\u6709\u5E2E\u52A9\uFF0C\u5E0C\u671B\u80FD\u5230 GitHub \u70B9\u4E2A star","Visit GitHub":"\u8BBF\u95EE GitHub"};var cp={en:sa,"zh-cn":xu},Eu=cp[Su.moment.locale()];function U(n){return Eu&&Eu[n]||sa[n]}var Tu=ue(fe());var rt=class{constructor(){this.app=x(Au.App);this.privateApi=x(qe)}async initAsync(){if(this.app.plugins.plugins.omnisearch){let e="omnisearch/cache/"+this.privateApi.getAppId(),t=new He(e);t.version(rt.DB_VERSION).stores({searchHistory:"++id",minisearch:"date"}),this.db=t}}async getLastQuery(){let e="";if(this.checkOmnisearchStatus()){let t=await this.db.searchHistory.toArray();e=t.length!==0?t[t.length-1].query:""}return e}checkOmnisearchStatus(){let e=this.app.plugins.plugins.omnisearch,t=!0;return e?e._loaded||(new Ge(U("Omnisearch is installed but not enabled")),t=!1):(new Ge(U("Omnisearch isn't installed")),t=!1),t}};rt.DB_VERSION=8,rt=B([(0,Tu.singleton)()],rt);var ht=require("obsidian");var oa=ue(fe());var Cu=ue(fe());var De=class{constructor(){this.setting=x(se);this.extensionViewMap=new Map;this.plugin=x(et)}init(){this.fillMap(this.setting.customExtensions.plaintext,an.MARKDOWN);try{}catch(e){}}viewTypeByPath(e){let t=this.extensionViewMap.get(ae.getExtension(e));return t===void 0?an.UNSUPPORTED:t}refreshAll(){this.extensionViewMap.clear(),this.init()}fillMap(e,t){for(let r of e)this.extensionViewMap.set(r,t)}};De=B([(0,Cu.singleton)()],De);var an=(a=>(a.UNSUPPORTED="unsupported",a.MARKDOWN="markdown",a.PDF="pdf",a.CANVAS="canvas",a.IMAGE="image",a.AUDIO="audio",a.VIDEO="video",a))(an||{});var Ie=class{constructor(){this.vault=x(ht.Vault);this.app=x(ht.App);this.setting=x(se);this.privateApi=x(qe);this.viewRegistry=x(De);this.htmlParser=x(br);this.obsidianFs=this.vault.adapter;this.init()}init(){this.excludedPaths=new Set(this.setting.excludedPaths),this.supportedExtensions=new Set(this.setting.customExtensions.plaintext)}async generateAllIndexedDocuments(e){return Promise.all(e.map(async t=>{if(this.isContentIndexable(t)){let r=this.app.metadataCache.getFileCache(t);if(this.viewRegistry.viewTypeByPath(t.path)==="markdown")return{path:t.path,basename:t.basename,folder:ae.getFolderPath(t.path),aliases:this.parseAliases(r),tags:this.parseTags(r),headings:this.parseHeadings(r),content:await this.readPlainText(t)};throw new Error(bn)}else return{path:t.path,basename:t.basename,folder:ae.getFolderPath(t.path)}}))}allFilesToBeIndexed(){let e=this.vault.getFiles();P.debug(`all files: ${e.length}`),ae.countFileByExtensions(e);let t=e.filter(r=>this.isIndexable(r));return P.debug(`indexable files: ${t.length}`),ae.countFileByExtensions(t),t}isIndexable(e){if(e instanceof ht.TFolder)return!1;let t;return typeof e=="string"?t=e:t=e.path,this.supportedExtensions.has(ae.getExtension(t))&&t.lastIndexOf("excalidraw.md")===-1&&(this.setting.followObsidianExcludedFiles?this.privateApi.isNotObsidianExcludedPath(t):!0)&&(this.excludedPaths.size===0?!0:this.isNotCustomExcludedPath(t))}async readPlainText(e){let t=typeof e=="string"?this.vault.getAbstractFileByPath(e):e;if(this.viewRegistry.viewTypeByPath(t.path)==="markdown"){let r=await this.vault.cachedRead(t);return t.extension==="html"?this.htmlParser.toMarkdown(r):r}else throw Error(`unsupported file extension as plain text to read, path: ${t.path}`)}async readPlainTextLines(e){return(await this.readPlainText(e)).split(ae.SPLIT_EOL)}parseAliases(e){return((0,ht.parseFrontMatterAliases)(e==null?void 0:e.frontmatter)||[]).join(" ")}parseTags(e){var t;return((t=e==null?void 0:e.tags)==null?void 0:t.map(r=>r.tag.slice(1)).join(" "))||""}parseHeadings(e){var t;return((t=e==null?void 0:e.headings)==null?void 0:t.map(r=>r.heading).join(" "))||""}isContentIndexable(e){return Ie.contentIndexableViewTypes.has(this.viewRegistry.viewTypeByPath(e.path))}isNotCustomExcludedPath(e){let t=e.split("/"),r="";for(let i of t)if(r+=(r?"/":"")+i,this.excludedPaths.has(r))return!1;return!0}};Ie.contentIndexableViewTypes=new Set(["markdown"]),Ie=B([(0,oa.singleton)()],Ie);var br=class{constructor(){this.MARKDOWN_LINK_REGEX=/\[([^[\]]+)\]\([^()]*\)/g;this.MARKDOWN_ASTERISK_REGEX=/\*\*(.*?)\*\*/g;this.MARKDOWN_BACKTICK_REGEX=/`(.*?)`/g}toMarkdown(e){let t=(0,ht.htmlToMarkdown)(e);return t=t.replace(this.MARKDOWN_LINK_REGEX,"$1"),t=t.replace(this.MARKDOWN_ASTERISK_REGEX,"$1"),t=t.replace(this.MARKDOWN_BACKTICK_REGEX,"$1"),t}};br=B([(0,oa.singleton)()],br);var Fu=ue(fe());var jt=class{async createChildThreads(){if(yt)P.warn("web worker only enabled on dev environment now");else return;P.debug("init child threads...");let e=x(Ie).obsidianFs,t=".obsidian/plugins/clever-search/dist/backend-worker.js";try{let r=await e.readBinary(t);P.debug(`worker script size (6x bigger than in production build): ${(r.byteLength/1e3).toFixed(2)} KB`);let i=new Blob([r],{type:"text/javascript"}),s=URL.createObjectURL(i);this.worker=new Worker(s),this.worker.addEventListener("message",o=>{console.log(`Received from worker:
`,o.data)})}catch(r){console.error("Error initializing worker:",r)}}async testImageSearch(){var e;(e=this.worker)==null||e.postMessage({type:"image-search"})}};jt=B([(0,Fu.singleton)()],jt);var kc=ue(fe());var Ka=require("obsidian");var Ca=require("obsidian");var ic=require("obsidian");var sc=ue(fe());var On=class{constructor(e,t){this.text=e,this.row=t}},Bt=class{constructor(e,t){this.sourcePath=e,this.items=t}};var $i=class{},zt=class extends $i{constructor(t,r){super();this.line=t,this.context=r}},kn=class extends $i{constructor(t,r,i,s,o,a){super();this.engineType=t,this.path=r,this.queryTerms=i,this.matchedTerms=s,this.subItems=o,this.previewContent=a}get viewType(){return x(De).viewTypeByPath(this.path)}get basename(){return ae.getBasename(this.path)}get extension(){return ae.getExtension(this.path)}get folderPath(){return ae.getFolderPath(this.path)}};function wr(n,e,t){var r=t||{},i=r.noTrailing,s=i===void 0?!1:i,o=r.noLeading,a=o===void 0?!1:o,l=r.debounceMode,u=l===void 0?void 0:l,c,h=!1,f=0;function d(){c&&clearTimeout(c)}function p(y){var g=y||{},_=g.upcomingOnly,w=_===void 0?!1:_;d(),h=!w}function m(){for(var y=arguments.length,g=new Array(y),_=0;_<y;_++)g[_]=arguments[_];var w=this,b=Date.now()-f;if(h)return;function S(){f=Date.now(),e.apply(w,g)}function A(){c=void 0}!a&&u&&!c&&S(),d(),u===void 0&&b>n?a?(f=Date.now(),s||(c=setTimeout(u?A:S,n))):S():s!==!0&&(c=setTimeout(u?A:S,u===void 0?n-b:n))}return m.cancel=p,m}function Pu(n,e,t){var r=t||{},i=r.atBegin,s=i===void 0?!1:i;return wr(n,e,{debounceMode:s!==!1})}var xr=class{static minInSet(e){let t=Number.MAX_VALUE;for(let r of e)r<t&&(t=r);return t}},Wi=class{constructor(e,t,r){this.flushThrottled=wr(1e4,()=>this.forceFlush());this.elementsMap=new Map,this.handler=e,this.identifier=t,this.autoFlushThreshold=r}add(e){let t=this.identifier(e);this.elementsMap.set(t,e),this.elementsMap.size>=this.autoFlushThreshold&&this.flushThrottled()}async forceFlush(){if(this.elementsMap.size===0)return;let e=Array.from(this.elementsMap.values());this.elementsMap.clear(),await this.handler(e),P.debug("flushed")}},Ui=class{constructor(e,t=Number.MAX_VALUE){this.heap=[],this.compare=e,this.capacity=t}values(){return this.heap}push(e){this.size()<this.capacity?(this.heap.push(e),this.heapifyUp()):this.compare(e,this.heap[0])>0&&(this.heap[0]=e,this.heapifyDown())}clear(){this.heap=[]}pop(){if(this.isEmpty())return;let e=this.heap[0];return this.heap[0]=this.heap[this.heap.length-1],this.heap.pop(),this.heapifyDown(),e}peek(){return this.heap[0]}isEmpty(){return this.heap.length===0}size(){return this.heap.length}getLeftChildIndex(e){return 2*e+1}getRightChildIndex(e){return 2*e+2}getParentIndex(e){return Math.floor((e-1)/2)}swap(e,t){[this.heap[e],this.heap[t]]=[this.heap[t],this.heap[e]]}heapifyUp(){let e=this.heap.length-1;for(;this.getParentIndex(e)>=0&&this.compare(this.heap[this.getParentIndex(e)],this.heap[e])>0;)this.swap(this.getParentIndex(e),e),e=this.getParentIndex(e)}heapifyDown(){let e=0;for(;this.getLeftChildIndex(e)<this.heap.length;){let t=this.getLeftChildIndex(e);if(this.getRightChildIndex(e)<this.heap.length&&this.compare(this.heap[this.getRightChildIndex(e)],this.heap[t])<0&&(t=this.getRightChildIndex(e)),this.compare(this.heap[e],this.heap[t])<0)break;this.swap(e,t),e=t}}};var rc=ue(fe());var fa={216:"O",223:"s",248:"o",273:"d",295:"h",305:"i",320:"l",322:"l",359:"t",383:"s",384:"b",385:"B",387:"b",390:"O",392:"c",393:"D",394:"D",396:"d",398:"E",400:"E",402:"f",403:"G",407:"I",409:"k",410:"l",412:"M",413:"N",414:"n",415:"O",421:"p",427:"t",429:"t",430:"T",434:"V",436:"y",438:"z",477:"e",485:"g",544:"N",545:"d",549:"z",564:"l",565:"n",566:"t",567:"j",570:"A",571:"C",572:"c",573:"L",574:"T",575:"s",576:"z",579:"B",580:"U",581:"V",582:"E",583:"e",584:"J",585:"j",586:"Q",587:"q",588:"R",589:"r",590:"Y",591:"y",592:"a",593:"a",595:"b",596:"o",597:"c",598:"d",599:"d",600:"e",603:"e",604:"e",605:"e",606:"e",607:"j",608:"g",609:"g",610:"G",613:"h",614:"h",616:"i",618:"I",619:"l",620:"l",621:"l",623:"m",624:"m",625:"m",626:"n",627:"n",628:"N",629:"o",633:"r",634:"r",635:"r",636:"r",637:"r",638:"r",639:"r",640:"R",641:"R",642:"s",647:"t",648:"t",649:"u",651:"v",652:"v",653:"w",654:"y",655:"Y",656:"z",657:"z",663:"c",665:"B",666:"e",667:"G",668:"H",669:"j",670:"k",671:"L",672:"q",686:"h",867:"a",868:"e",869:"i",870:"o",871:"u",872:"c",873:"d",874:"h",875:"m",876:"r",877:"t",878:"v",879:"x",7424:"A",7427:"B",7428:"C",7429:"D",7431:"E",7432:"e",7433:"i",7434:"J",7435:"K",7436:"L",7437:"M",7438:"N",7439:"O",7440:"O",7441:"o",7442:"o",7443:"o",7446:"o",7447:"o",7448:"P",7449:"R",7450:"R",7451:"T",7452:"U",7453:"u",7454:"u",7455:"m",7456:"V",7457:"W",7458:"Z",7522:"i",7523:"r",7524:"u",7525:"v",7834:"a",7835:"s",8305:"i",8341:"h",8342:"k",8343:"l",8344:"m",8345:"n",8346:"p",8347:"s",8348:"t",8580:"c"};for(let n="\u0300".codePointAt(0);n<="\u036F".codePointAt(0);++n){let e=String.fromCodePoint(n);for(let t of"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"){let i=(t+e).normalize().codePointAt(0);i>126&&(fa[i]=t)}}var aa={a:[7844,7863],e:[7870,7879],o:[7888,7907],u:[7912,7921]};for(let n of Object.keys(aa)){let e=n.toUpperCase();for(let t=aa[n][0];t<=aa[n][1];++t)fa[t]=t%2===0?e:n}function Fr(n){if(n<192||n>8580)return n;let e=fa[n];return e!==void 0?e.codePointAt(0):n}function Vt(n,e){return n>e?n:e}var Ou=n=>n.split("").map(e=>e.codePointAt(0));var fp=new Set(` \f
\r	\v\xA0\u1680\u2028\u2029\u202F\u205F\u3000\uFEFF`.split("").map(n=>n.codePointAt(0)));for(let n="\u2000".codePointAt(0);n<="\u200A".codePointAt(0);n++)fp.add(n);var Ln="\x7F".codePointAt(0),Sr="A".codePointAt(0),Ar="Z".codePointAt(0),ku="a".codePointAt(0),Du="z".codePointAt(0),hp="0".codePointAt(0),dp="9".codePointAt(0);function Dn(n,e,t){return t?n:e-n-1}var Tr=16,Hi=-3,Cr=-1,ln=Tr/2,pp=Tr/2,mp=ln+Cr,Lu=-(Hi+Cr),Ru=2;function la(n){return n?new Set:null}function Er(n,e,t){if(e!==null&&e.i16.length>n+t){let r=e.i16.subarray(n,n+t);return[n+t,r]}return[n,new Int16Array(t)]}function Iu(n,e,t){if(e!==null&&e.i32.length>n+t){let r=e.i32.subarray(n,n+t);return[n+t,r]}return[n,new Int32Array(t)]}function Nu(n){return n>=ku&&n<=Du?1:n>=Sr&&n<=Ar?2:n>=hp&&n<=dp?4:0}function ju(n){let e=String.fromCodePoint(n);return e!==e.toUpperCase()?1:e!==e.toLowerCase()?2:e.match(/\p{Number}/gu)!==null?4:e.match(/\p{Letter}/gu)!==null?3:0}function qi(n){return n<=Ln?Nu(n):ju(n)}function ha(n,e){return n===0&&e!==0?ln:n===1&&e===2||n!==4&&e===4?mp:e===0?pp:0}function gp(n,e){return e===0?ln:ha(qi(n[e-1]),qi(n[e]))}function yp(n,e,t,r){let i=n.slice(r),s=i.indexOf(t);if(s===0)return r;if(!e&&t>=ku&&t<=Du){s>0&&(i=i.slice(0,s));let o=i.indexOf(t-32);o>=0&&(s=o)}return s<0?-1:r+s}function Mu(n){for(let e of n)if(e>=128)return!1;return!0}function da(n,e,t){if(!Mu(n))return 0;if(!Mu(e))return-1;let r=0,i=0;for(let s=0;s<e.length;s++){if(i=yp(n,t,e[s],i),i<0)return-1;s===0&&i>0&&(r=i-1),i++}return r}var vp=(n,e,t,r,i,s,o)=>{let a=i.length;if(a===0)return[{start:0,end:0,score:0},la(s)];let l=r.length;if(o!==null&&l*a>o.i16.length)return zu(n,e,t,r,i,s);let u=da(r,i,n);if(u<0)return[{start:-1,end:-1,score:0},null];let c=0,h=0,f=null,d=null,p=null,m=null;[c,f]=Er(c,o,l),[c,d]=Er(c,o,l),[c,p]=Er(c,o,l),[h,m]=Iu(h,o,a);let[,y]=Iu(h,o,l);for(let L=0;L<y.length;L++)y[L]=r[L];let g=0,_=0,w=0,b=0,S=i[0],A=i[0],T=0,F=0,k=!1,j=y.subarray(u),I=f.subarray(u).subarray(0,j.length),N=d.subarray(u).subarray(0,j.length),D=p.subarray(u).subarray(0,j.length);for(let[L,H]of j.entries()){let q=null;H<=Ln?(q=Nu(H),!n&&q===2&&(H+=32)):(q=ju(H),!n&&q===2&&(H=String.fromCodePoint(H).toLowerCase().codePointAt(0)),e&&(H=Fr(H))),j[L]=H;let Me=ha(F,q);if(D[L]=Me,F=q,H===A&&(w<a&&(m[w]=u+L,w++,A=i[Math.min(w,a-1)]),b=u+L),H===S){let Ne=Tr+Me*Ru;if(I[L]=Ne,N[L]=1,a===1&&(t&&Ne>g||!t&&Ne>=g)&&(g=Ne,_=u+L,t&&Me===ln))break;k=!1}else k?I[L]=Vt(T+Cr,0):I[L]=Vt(T+Hi,0),N[L]=0,k=!0;T=I[L]}if(w!==a)return[{start:-1,end:-1,score:0},null];if(a===1){let L={start:_,end:_+1,score:g};if(!s)return[L,null];let H=new Set;return H.add(_),[L,H]}let z=m[0],J=b-z+1,X=null;[c,X]=Er(c,o,J*a);{let L=f.subarray(z,b+1);for(let[H,q]of L.entries())X[H]=q}let[,Z]=Er(c,o,J*a);{let L=d.subarray(z,b+1);for(let[H,q]of L.entries())Z[H]=q}let ne=m.subarray(1),de=i.slice(1).slice(0,ne.length);for(let[L,H]of ne.entries()){let q=!1,Me=de[L],Ne=L+1,at=Ne*J,je=y.subarray(H,b+1),Ue=p.subarray(H).subarray(0,je.length),zr=Z.subarray(at+H-z).subarray(0,je.length),Ct=Z.subarray(at+H-z-1-J).subarray(0,je.length),Vr=X.subarray(at+H-z).subarray(0,je.length),hs=X.subarray(at+H-z-1-J).subarray(0,je.length),yn=X.subarray(at+H-z-1).subarray(0,je.length);yn[0]=0;for(let[Qe,ds]of je.entries()){let Kr=Qe+H,Ft=0,dt=0,Pt=0;if(q?dt=yn[Qe]+Cr:dt=yn[Qe]+Hi,Me===ds){Ft=hs[Qe]+Tr;let Gt=Ue[Qe];Pt=Ct[Qe]+1,Gt===ln?Pt=1:Pt>1&&(Gt=Vt(Gt,Vt(Lu,p[Kr-Pt+1]))),Ft+Gt<dt?(Ft+=Ue[Qe],Pt=0):Ft+=Gt}zr[Qe]=Pt,q=Ft<dt;let vn=Vt(Vt(Ft,dt),0);Ne===a-1&&(t&&vn>g||!t&&vn>=g)&&(g=vn,_=Kr),Vr[Qe]=vn}}let ot=la(s),M=z;if(s&&ot!==null){let L=a-1;M=_;let H=!0;for(;;){let q=L*J,Me=M-z,Ne=X[q+Me],at=0,je=0;if(L>0&&M>=m[L]&&(at=X[q-J+Me-1]),M>m[L]&&(je=X[q+Me-1]),Ne>at&&(Ne>je||Ne===je&&H)){if(ot.add(M),L===0)break;L--}H=Z[q+Me]>1||q+J+Me+1<Z.length&&Z[q+J+Me+1]>0,M--}}return[{start:M,end:_+1,score:g},ot]};function Bu(n,e,t,r,i,s,o){let a=0,l=0,u=!1,c=0,h=0,f=la(o),d=0;i>0&&(d=qi(t[i-1]));for(let p=i;p<s;p++){let m=t[p],y=qi(m);if(n||(m>=Sr&&m<=Ar?m+=32:m>Ln&&(m=String.fromCodePoint(m).toLowerCase().codePointAt(0))),e&&(m=Fr(m)),m===r[a]){o&&f!==null&&f.add(p),l+=Tr;let g=ha(d,y);c===0?h=g:(g===ln&&(h=g),g=Vt(Vt(g,h),Lu)),a===0?l+=g*Ru:l+=g,u=!1,c++,a++}else u?l+=Cr:l+=Hi,u=!0,c=0,h=0;d=y}return[l,f]}var zu=(n,e,t,r,i,s,o)=>{if(i.length===0)return[{start:0,end:0,score:0},null];if(da(r,i,n)<0)return[{start:-1,end:-1,score:0},null];let a=0,l=-1,u=-1,c=r.length,h=i.length;for(let f=0;f<c;f++){let d=r[Dn(f,c,t)];n||(d>=Sr&&d<=Ar?d+=32:d>Ln&&(d=String.fromCodePoint(d).toLowerCase().codePointAt(0))),e&&(d=Fr(d));let p=i[Dn(a,h,t)];if(d===p&&(l<0&&(l=f),a++,a===h)){u=f+1;break}}if(l>=0&&u>=0){a--;for(let p=u-1;p>=l;p--){let m=Dn(p,c,t),y=r[m];n||(y>=Sr&&y<=Ar?y+=32:y>Ln&&(y=String.fromCodePoint(y).toLowerCase().codePointAt(0)));let g=Dn(a,h,t),_=i[g];if(y===_&&(a--,a<0)){l=p;break}}if(!t){let p=l;l=c-u,u=c-p}let[f,d]=Bu(n,e,r,i,l,u,s);return[{start:l,end:u,score:f},d]}return[{start:-1,end:-1,score:0},null]},_p=(n,e,t,r,i,s,o)=>{if(i.length===0)return[{start:0,end:0,score:0},null];let a=r.length,l=i.length;if(a<l)return[{start:-1,end:-1,score:0},null];if(da(r,i,n)<0)return[{start:-1,end:-1,score:0},null];let u=0,c=-1,h=0,f=-1;for(let d=0;d<a;d++){let p=Dn(d,a,t),m=r[p];n||(m>=Sr&&m<=Ar?m+=32:m>Ln&&(m=String.fromCodePoint(m).toLowerCase().codePointAt(0))),e&&(m=Fr(m));let y=Dn(u,l,t);if(i[y]===m){if(y===0&&(h=gp(r,p)),u++,u===l){if(h>f&&(c=d,f=h),h===ln)break;d-=u-1,u=0,h=0}}else d-=u,u=0,h=0}if(c>=0){let d=0,p=0;t?(d=c-l+1,p=c+1):(d=a-(c+1),p=a-(c-l+1));let[m]=Bu(n,e,r,i,d,p,!1);return[{start:d,end:p,score:m},null]}return[{start:-1,end:-1,score:0},null]};var bp=100*1024,wp=2048;function xp(n,e){return{i16:new Int16Array(n),i32:new Int32Array(e)}}var Ep=xp(bp,wp);var Vu=(n,e,t)=>{let r=!1;switch(e){case"smart-case":n.toLowerCase()!==n&&(r=!0);break;case"case-sensitive":r=!0;break;case"case-insensitive":n=n.toLowerCase(),r=!1;break}let i=Ou(n);return t&&(i=i.map(Fr)),{queryRunes:i,caseSensitive:r}};function Ku(n,e){let t=Object.keys(n).map(i=>parseInt(i,10)).sort((i,s)=>s-i),r=[];for(let i of t)if(r=r.concat(n[i]),r.length>=e)break;return r}function $u(n,e,t){return r=>{let i=this.runesList[r];if(e.length>i.length)return;let[s,o]=this.algoFn(t,this.opts.normalize,this.opts.forward,i,e,!0,Ep);if(s.start===-1)return;if(this.opts.fuzzy===!1){o=new Set;for(let l=s.start;l<s.end;++l)o.add(l)}let a=this.opts.sort?s.score:0;n[a]===void 0&&(n[a]=[]),n[a].push({item:this.items[r],...s,positions:o!=null?o:new Set})}}function Sp(n){let{queryRunes:e,caseSensitive:t}=Vu(n,this.opts.casing,this.opts.normalize),r={},i=$u.bind(this)(r,e,t);for(let s=0,o=this.runesList.length;s<o;++s)i(s);return Ku(r,this.opts.limit)}var Ap=typeof require!="undefined"&&typeof window=="undefined";function Tp(n,e,t,r){return new Promise((i,s)=>{let a=0,l=Math.min(1e3,e),u=()=>{if(n.cancelled)return s("search cancelled");for(;a<l;++a)t(a);l<e?(l=Math.min(l+1e3,e),Ap?setImmediate(u):setTimeout(u)):i(r())};u()})}function Cp(n,e){let{queryRunes:t,caseSensitive:r}=Vu(n,this.opts.casing,this.opts.normalize),i={};return Tp(e,this.runesList.length,$u.bind(this)(i,t,r),()=>Ku(i,this.opts.limit))}var pa={limit:1/0,selector:n=>n,casing:"smart-case",normalize:!0,fuzzy:"v2",tiebreakers:[],sort:!0,forward:!0},ua=class{constructor(e,...t){switch(this.opts={...pa,...t[0]},this.items=e,this.runesList=e.map(r=>Ou(this.opts.selector(r).normalize())),this.algoFn=_p,this.opts.fuzzy){case"v2":this.algoFn=vp;break;case"v1":this.algoFn=zu;break}}},Oy={...pa,match:Sp};var Fp={...pa,match:Cp},ca=class extends ua{constructor(e,...t){super(e,...t),this.opts={...Fp,...t[0]},this.token={cancelled:!1}}async find(e){if(this.token.cancelled=!0,this.token={cancelled:!1},e.length===0||this.items.length===0)return this.items.slice(0,this.opts.limit).map(Pp);e=e.normalize();let t=await this.opts.match.bind(this)(e,this.token);return Ip(t,this.opts)}},Pp=n=>({item:n,start:-1,end:-1,score:0,positions:new Set});function Ip(n,e){if(e.sort){let{selector:t}=e;n.sort((r,i)=>{if(r.score===i.score)for(let s of e.tiebreakers){let o=s(r,i,t);if(o!==0)return o}return 0})}return Number.isFinite(e.limit)&&n.splice(e.limit),n}var Gi=class{constructor(e,...t){this.finder=new ca(e,...t),this.find=this.finder.find.bind(this.finder)}};var le=function(){return le=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},le.apply(this,arguments)};function Mp(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?s(c.value):i(c.value).then(a,l)}u((r=r.apply(n,e||[])).next())})}function Op(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(t=0)),t;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(c){u=[6,c],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Y(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function me(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}var kp="ENTRIES",Gu="KEYS",Xu="VALUES",we="",ma=function(){function n(e,t){var r=e._tree,i=Array.from(r.keys());this.set=e,this._type=t,this._path=i.length>0?[{node:r,keys:i}]:[]}return n.prototype.next=function(){var e=this.dive();return this.backtrack(),e},n.prototype.dive=function(){if(this._path.length===0)return{done:!0,value:void 0};var e=Rn(this._path),t=e.node,r=e.keys;if(Rn(r)===we)return{done:!1,value:this.result()};var i=t.get(Rn(r));return this._path.push({node:i,keys:Array.from(i.keys())}),this.dive()},n.prototype.backtrack=function(){if(this._path.length!==0){var e=Rn(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}},n.prototype.key=function(){return this.set._prefix+this._path.map(function(e){var t=e.keys;return Rn(t)}).filter(function(e){return e!==we}).join("")},n.prototype.value=function(){return Rn(this._path).node.get(we)},n.prototype.result=function(){switch(this._type){case Xu:return this.value();case Gu:return this.key();default:return[this.key(),this.value()]}},n.prototype[Symbol.iterator]=function(){return this},n}(),Rn=function(n){return n[n.length-1]},Dp=function(n,e,t){var r=new Map;if(e===void 0)return r;for(var i=e.length+1,s=i+t,o=new Uint8Array(s*i).fill(t+1),a=0;a<i;++a)o[a]=a;for(var l=1;l<s;++l)o[l*i]=l;return Yu(n,e,t,r,o,1,i,""),r},Yu=function(n,e,t,r,i,s,o,a){var l,u,c=s*o;try{e:for(var h=Y(n.keys()),f=h.next();!f.done;f=h.next()){var d=f.value;if(d===we){var p=i[c-1];p<=t&&r.set(a,[n.get(d),p])}else{for(var m=s,y=0;y<d.length;++y,++m){for(var g=d[y],_=o*m,w=_-o,b=i[_],S=Math.max(0,m-t-1),A=Math.min(o-1,m+t),T=S;T<A;++T){var F=g!==e[T],k=i[w+T]+ +F,j=i[w+T+1]+1,I=i[_+T]+1,N=i[_+T+1]=Math.min(k,j,I);N<b&&(b=N)}if(b>t)continue e}Yu(n.get(d),e,t,r,i,m,o,a+d)}}}catch(D){l={error:D}}finally{try{f&&!f.done&&(u=h.return)&&u.call(h)}finally{if(l)throw l.error}}},ga=function(){function n(e,t){e===void 0&&(e=new Map),t===void 0&&(t=""),this._size=void 0,this._tree=e,this._prefix=t}return n.prototype.atPrefix=function(e){var t,r;if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");var i=me(Yi(this._tree,e.slice(this._prefix.length)),2),s=i[0],o=i[1];if(s===void 0){var a=me(Sa(o),2),l=a[0],u=a[1];try{for(var c=Y(l.keys()),h=c.next();!h.done;h=c.next()){var f=h.value;if(f!==we&&f.startsWith(u)){var d=new Map;return d.set(f.slice(u.length),l.get(f)),new n(d,e)}}}catch(p){t={error:p}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}}return new n(s,e)},n.prototype.clear=function(){this._size=void 0,this._tree.clear()},n.prototype.delete=function(e){return this._size=void 0,Lp(this._tree,e)},n.prototype.entries=function(){return new ma(this,kp)},n.prototype.forEach=function(e){var t,r;try{for(var i=Y(this),s=i.next();!s.done;s=i.next()){var o=me(s.value,2),a=o[0],l=o[1];e(a,l,this)}}catch(u){t={error:u}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.fuzzyGet=function(e,t){return Dp(this._tree,e,t)},n.prototype.get=function(e){var t=wa(this._tree,e);return t!==void 0?t.get(we):void 0},n.prototype.has=function(e){var t=wa(this._tree,e);return t!==void 0&&t.has(we)},n.prototype.keys=function(){return new ma(this,Gu)},n.prototype.set=function(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=ya(this._tree,e);return r.set(we,t),this},Object.defineProperty(n.prototype,"size",{get:function(){if(this._size)return this._size;this._size=0;for(var e=this.entries();!e.next().done;)this._size+=1;return this._size},enumerable:!1,configurable:!0}),n.prototype.update=function(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=ya(this._tree,e);return r.set(we,t(r.get(we))),this},n.prototype.fetch=function(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=ya(this._tree,e),i=r.get(we);return i===void 0&&r.set(we,i=t()),i},n.prototype.values=function(){return new ma(this,Xu)},n.prototype[Symbol.iterator]=function(){return this.entries()},n.from=function(e){var t,r,i=new n;try{for(var s=Y(e),o=s.next();!o.done;o=s.next()){var a=me(o.value,2),l=a[0],u=a[1];i.set(l,u)}}catch(c){t={error:c}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return i},n.fromObject=function(e){return n.from(Object.entries(e))},n}(),Yi=function(n,e,t){var r,i;if(t===void 0&&(t=[]),e.length===0||n==null)return[n,t];try{for(var s=Y(n.keys()),o=s.next();!o.done;o=s.next()){var a=o.value;if(a!==we&&e.startsWith(a))return t.push([n,a]),Yi(n.get(a),e.slice(a.length),t)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return t.push([n,e]),Yi(void 0,"",t)},wa=function(n,e){var t,r;if(e.length===0||n==null)return n;try{for(var i=Y(n.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;if(o!==we&&e.startsWith(o))return wa(n.get(o),e.slice(o.length))}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},ya=function(n,e){var t,r,i=e.length;e:for(var s=0;n&&s<i;){try{for(var o=(t=void 0,Y(n.keys())),a=o.next();!a.done;a=o.next()){var l=a.value;if(l!==we&&e[s]===l[0]){for(var u=Math.min(i-s,l.length),c=1;c<u&&e[s+c]===l[c];)++c;var h=n.get(l);if(c===l.length)n=h;else{var f=new Map;f.set(l.slice(c),h),n.set(e.slice(s,s+c),f),n.delete(l),n=f}s+=c;continue e}}}catch(p){t={error:p}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}var d=new Map;return n.set(e.slice(s),d),d}return n},Lp=function(n,e){var t=me(Yi(n,e),2),r=t[0],i=t[1];if(r!==void 0){if(r.delete(we),r.size===0)Qu(i);else if(r.size===1){var s=me(r.entries().next().value,2),o=s[0],a=s[1];Ju(i,o,a)}}},Qu=function(n){if(n.length!==0){var e=me(Sa(n),2),t=e[0],r=e[1];if(t.delete(r),t.size===0)Qu(n.slice(0,-1));else if(t.size===1){var i=me(t.entries().next().value,2),s=i[0],o=i[1];s!==we&&Ju(n.slice(0,-1),s,o)}}},Ju=function(n,e,t){if(n.length!==0){var r=me(Sa(n),2),i=r[0],s=r[1];i.set(s+e,t),i.delete(s)}},Sa=function(n){return n[n.length-1]},Pr,Aa="or",Zu="and",Rp="and_not",Qi=function(){function n(e){if((e==null?void 0:e.fields)==null)throw new Error('MiniSearch: option "fields" must be provided');var t=e.autoVacuum==null||e.autoVacuum===!0?ba:e.autoVacuum;this._options=le(le(le({},_a),e),{autoVacuum:t,searchOptions:le(le({},Wu),e.searchOptions||{}),autoSuggestOptions:le(le({},Vp),e.autoSuggestOptions||{})}),this._index=new ga,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=Ea,this.addFields(this._options.fields)}return n.prototype.add=function(e){var t,r,i,s,o,a,l=this._options,u=l.extractField,c=l.tokenize,h=l.processTerm,f=l.fields,d=l.idField,p=u(e,d);if(p==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));if(this._idToShortId.has(p))throw new Error("MiniSearch: duplicate ID ".concat(p));var m=this.addDocumentId(p);this.saveStoredFields(m,e);try{for(var y=Y(f),g=y.next();!g.done;g=y.next()){var _=g.value,w=u(e,_);if(w!=null){var b=c(w.toString(),_),S=this._fieldIds[_],A=new Set(b).size;this.addFieldLength(m,S,this._documentCount-1,A);try{for(var T=(i=void 0,Y(b)),F=T.next();!F.done;F=T.next()){var k=F.value,j=h(k,_);if(Array.isArray(j))try{for(var I=(o=void 0,Y(j)),N=I.next();!N.done;N=I.next()){var D=N.value;this.addTerm(S,m,D)}}catch(z){o={error:z}}finally{try{N&&!N.done&&(a=I.return)&&a.call(I)}finally{if(o)throw o.error}}else j&&this.addTerm(S,m,j)}}catch(z){i={error:z}}finally{try{F&&!F.done&&(s=T.return)&&s.call(T)}finally{if(i)throw i.error}}}}}catch(z){t={error:z}}finally{try{g&&!g.done&&(r=y.return)&&r.call(y)}finally{if(t)throw t.error}}},n.prototype.addAll=function(e){var t,r;try{for(var i=Y(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.add(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.addAllAsync=function(e,t){var r=this;t===void 0&&(t={});var i=t.chunkSize,s=i===void 0?10:i,o={chunk:[],promise:Promise.resolve()},a=e.reduce(function(c,h,f){var d=c.chunk,p=c.promise;return d.push(h),(f+1)%s===0?{chunk:[],promise:p.then(function(){return new Promise(function(m){return setTimeout(m,0)})}).then(function(){return r.addAll(d)})}:{chunk:d,promise:p}},o),l=a.chunk,u=a.promise;return u.then(function(){return r.addAll(l)})},n.prototype.remove=function(e){var t,r,i,s,o,a,l=this._options,u=l.tokenize,c=l.processTerm,h=l.extractField,f=l.fields,d=l.idField,p=h(e,d);if(p==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));var m=this._idToShortId.get(p);if(m==null)throw new Error("MiniSearch: cannot remove document with ID ".concat(p,": it is not in the index"));try{for(var y=Y(f),g=y.next();!g.done;g=y.next()){var _=g.value,w=h(e,_);if(w!=null){var b=u(w.toString(),_),S=this._fieldIds[_],A=new Set(b).size;this.removeFieldLength(m,S,this._documentCount,A);try{for(var T=(i=void 0,Y(b)),F=T.next();!F.done;F=T.next()){var k=F.value,j=c(k,_);if(Array.isArray(j))try{for(var I=(o=void 0,Y(j)),N=I.next();!N.done;N=I.next()){var D=N.value;this.removeTerm(S,m,D)}}catch(z){o={error:z}}finally{try{N&&!N.done&&(a=I.return)&&a.call(I)}finally{if(o)throw o.error}}else j&&this.removeTerm(S,m,j)}}catch(z){i={error:z}}finally{try{F&&!F.done&&(s=T.return)&&s.call(T)}finally{if(i)throw i.error}}}}}catch(z){t={error:z}}finally{try{g&&!g.done&&(r=y.return)&&r.call(y)}finally{if(t)throw t.error}}this._storedFields.delete(m),this._documentIds.delete(m),this._idToShortId.delete(p),this._fieldLength.delete(m),this._documentCount-=1},n.prototype.removeAll=function(e){var t,r;if(e)try{for(var i=Y(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.remove(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new ga,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}},n.prototype.discard=function(e){var t=this,r=this._idToShortId.get(e);if(r==null)throw new Error("MiniSearch: cannot discard document with ID ".concat(e,": it is not in the index"));this._idToShortId.delete(e),this._documentIds.delete(r),this._storedFields.delete(r),(this._fieldLength.get(r)||[]).forEach(function(i,s){t.removeFieldLength(r,s,t._documentCount,i)}),this._fieldLength.delete(r),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()},n.prototype.maybeAutoVacuum=function(){if(this._options.autoVacuum!==!1){var e=this._options.autoVacuum,t=e.minDirtFactor,r=e.minDirtCount,i=e.batchSize,s=e.batchWait;this.conditionalVacuum({batchSize:i,batchWait:s},{minDirtCount:r,minDirtFactor:t})}},n.prototype.discardAll=function(e){var t,r,i=this._options.autoVacuum;try{this._options.autoVacuum=!1;try{for(var s=Y(e),o=s.next();!o.done;o=s.next()){var a=o.value;this.discard(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}}finally{this._options.autoVacuum=i}this.maybeAutoVacuum()},n.prototype.replace=function(e){var t=this._options,r=t.idField,i=t.extractField,s=i(e,r);this.discard(s),this.add(e)},n.prototype.vacuum=function(e){return e===void 0&&(e={}),this.conditionalVacuum(e)},n.prototype.conditionalVacuum=function(e,t){var r=this;return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&t,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(function(){var i=r._enqueuedVacuumConditions;return r._enqueuedVacuumConditions=Ea,r.performVacuuming(e,i)}),this._enqueuedVacuum)):this.vacuumConditionsMet(t)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)},n.prototype.performVacuuming=function(e,t){return Mp(this,void 0,void 0,function(){var r,i,s,o,a,l,u,c,h,f,d,p,m,y,g,_,w,b,S,A,T,F,k,j,I;return Op(this,function(N){switch(N.label){case 0:if(r=this._dirtCount,!this.vacuumConditionsMet(t))return[3,10];i=e.batchSize||xa.batchSize,s=e.batchWait||xa.batchWait,o=1,N.label=1;case 1:N.trys.push([1,7,8,9]),a=Y(this._index),l=a.next(),N.label=2;case 2:if(l.done)return[3,6];u=me(l.value,2),c=u[0],h=u[1];try{for(f=(F=void 0,Y(h)),d=f.next();!d.done;d=f.next()){p=me(d.value,2),m=p[0],y=p[1];try{for(g=(j=void 0,Y(y)),_=g.next();!_.done;_=g.next())w=me(_.value,1),b=w[0],!this._documentIds.has(b)&&(y.size<=1?h.delete(m):y.delete(b))}catch(D){j={error:D}}finally{try{_&&!_.done&&(I=g.return)&&I.call(g)}finally{if(j)throw j.error}}}}catch(D){F={error:D}}finally{try{d&&!d.done&&(k=f.return)&&k.call(f)}finally{if(F)throw F.error}}return this._index.get(c).size===0&&this._index.delete(c),o%i!==0?[3,4]:[4,new Promise(function(D){return setTimeout(D,s)})];case 3:N.sent(),N.label=4;case 4:o+=1,N.label=5;case 5:return l=a.next(),[3,2];case 6:return[3,9];case 7:return S=N.sent(),A={error:S},[3,9];case 8:try{l&&!l.done&&(T=a.return)&&T.call(a)}finally{if(A)throw A.error}return[7];case 9:this._dirtCount-=r,N.label=10;case 10:return[4,null];case 11:return N.sent(),this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null,[2]}})})},n.prototype.vacuumConditionsMet=function(e){if(e==null)return!0;var t=e.minDirtCount,r=e.minDirtFactor;return t=t||ba.minDirtCount,r=r||ba.minDirtFactor,this.dirtCount>=t&&this.dirtFactor>=r},Object.defineProperty(n.prototype,"isVacuuming",{get:function(){return this._currentVacuum!=null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dirtCount",{get:function(){return this._dirtCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dirtFactor",{get:function(){return this._dirtCount/(1+this._documentCount+this._dirtCount)},enumerable:!1,configurable:!0}),n.prototype.has=function(e){return this._idToShortId.has(e)},n.prototype.getStoredFields=function(e){var t=this._idToShortId.get(e);if(t!=null)return this._storedFields.get(t)},n.prototype.search=function(e,t){var r,i;t===void 0&&(t={});var s=this.executeQuery(e,t),o=[];try{for(var a=Y(s),l=a.next();!l.done;l=a.next()){var u=me(l.value,2),c=u[0],h=u[1],f=h.score,d=h.terms,p=h.match,m=d.length||1,y={id:this._documentIds.get(c),score:f*m,terms:Object.keys(p),queryTerms:d,match:p};Object.assign(y,this._storedFields.get(c)),(t.filter==null||t.filter(y))&&o.push(y)}}catch(g){r={error:g}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return e===n.wildcard&&t.boostDocument==null&&this._options.searchOptions.boostDocument==null||o.sort(Hu),o},n.prototype.autoSuggest=function(e,t){var r,i,s,o;t===void 0&&(t={}),t=le(le({},this._options.autoSuggestOptions),t);var a=new Map;try{for(var l=Y(this.search(e,t)),u=l.next();!u.done;u=l.next()){var c=u.value,h=c.score,f=c.terms,d=f.join(" "),p=a.get(d);p!=null?(p.score+=h,p.count+=1):a.set(d,{score:h,terms:f,count:1})}}catch(S){r={error:S}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}var m=[];try{for(var y=Y(a),g=y.next();!g.done;g=y.next()){var _=me(g.value,2),p=_[0],w=_[1],h=w.score,f=w.terms,b=w.count;m.push({suggestion:p,terms:f,score:h/b})}}catch(S){s={error:S}}finally{try{g&&!g.done&&(o=y.return)&&o.call(y)}finally{if(s)throw s.error}}return m.sort(Hu),m},Object.defineProperty(n.prototype,"documentCount",{get:function(){return this._documentCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"termCount",{get:function(){return this._index.size},enumerable:!1,configurable:!0}),n.loadJSON=function(e,t){if(t==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),t)},n.getDefault=function(e){if(_a.hasOwnProperty(e))return va(_a,e);throw new Error('MiniSearch: unknown option "'.concat(e,'"'))},n.loadJS=function(e,t){var r,i,s,o,a,l,u=e.index,c=e.documentCount,h=e.nextId,f=e.documentIds,d=e.fieldIds,p=e.fieldLength,m=e.averageFieldLength,y=e.storedFields,g=e.dirtCount,_=e.serializationVersion;if(_!==1&&_!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");var w=new n(t);w._documentCount=c,w._nextId=h,w._documentIds=Xi(f),w._idToShortId=new Map,w._fieldIds=d,w._fieldLength=Xi(p),w._avgFieldLength=m,w._storedFields=Xi(y),w._dirtCount=g||0,w._index=new ga;try{for(var b=Y(w._documentIds),S=b.next();!S.done;S=b.next()){var A=me(S.value,2),T=A[0],F=A[1];w._idToShortId.set(F,T)}}catch(de){r={error:de}}finally{try{S&&!S.done&&(i=b.return)&&i.call(b)}finally{if(r)throw r.error}}try{for(var k=Y(u),j=k.next();!j.done;j=k.next()){var I=me(j.value,2),N=I[0],D=I[1],z=new Map;try{for(var J=(a=void 0,Y(Object.keys(D))),X=J.next();!X.done;X=J.next()){var Z=X.value,ne=D[Z];_===1&&(ne=ne.ds),z.set(parseInt(Z,10),Xi(ne))}}catch(de){a={error:de}}finally{try{X&&!X.done&&(l=J.return)&&l.call(J)}finally{if(a)throw a.error}}w._index.set(N,z)}}catch(de){s={error:de}}finally{try{j&&!j.done&&(o=k.return)&&o.call(k)}finally{if(s)throw s.error}}return w},n.prototype.executeQuery=function(e,t){var r=this;if(t===void 0&&(t={}),e===n.wildcard)return this.executeWildcardQuery(t);if(typeof e!="string"){var i=le(le(le({},t),e),{queries:void 0}),s=e.queries.map(function(y){return r.executeQuery(y,i)});return this.combineResults(s,i.combineWith)}var o=this._options,a=o.tokenize,l=o.processTerm,u=o.searchOptions,c=le(le({tokenize:a,processTerm:l},u),t),h=c.tokenize,f=c.processTerm,d=h(e).flatMap(function(y){return f(y)}).filter(function(y){return!!y}),p=d.map(zp(c)),m=p.map(function(y){return r.executeQuerySpec(y,c)});return this.combineResults(m,c.combineWith)},n.prototype.executeQuerySpec=function(e,t){var r,i,s,o,a=le(le({},this._options.searchOptions),t),l=(a.fields||this._options.fields).reduce(function(Z,ne){var de;return le(le({},Z),(de={},de[ne]=va(a.boost,ne)||1,de))},{}),u=a.boostDocument,c=a.weights,h=a.maxFuzzy,f=a.bm25,d=le(le({},Wu.weights),c),p=d.fuzzy,m=d.prefix,y=this._index.get(e.term),g=this.termResults(e.term,e.term,1,y,l,u,f),_,w;if(e.prefix&&(_=this._index.atPrefix(e.term)),e.fuzzy){var b=e.fuzzy===!0?.2:e.fuzzy,S=b<1?Math.min(h,Math.round(e.term.length*b)):b;S&&(w=this._index.fuzzyGet(e.term,S))}if(_)try{for(var A=Y(_),T=A.next();!T.done;T=A.next()){var F=me(T.value,2),k=F[0],j=F[1],I=k.length-e.term.length;if(I){w==null||w.delete(k);var N=m*k.length/(k.length+.3*I);this.termResults(e.term,k,N,j,l,u,f,g)}}}catch(Z){r={error:Z}}finally{try{T&&!T.done&&(i=A.return)&&i.call(A)}finally{if(r)throw r.error}}if(w)try{for(var D=Y(w.keys()),z=D.next();!z.done;z=D.next()){var k=z.value,J=me(w.get(k),2),X=J[0],I=J[1];if(I){var N=p*k.length/(k.length+I);this.termResults(e.term,k,N,X,l,u,f,g)}}}catch(Z){s={error:Z}}finally{try{z&&!z.done&&(o=D.return)&&o.call(D)}finally{if(s)throw s.error}}return g},n.prototype.executeWildcardQuery=function(e){var t,r,i=new Map,s=le(le({},this._options.searchOptions),e);try{for(var o=Y(this._documentIds),a=o.next();!a.done;a=o.next()){var l=me(a.value,2),u=l[0],c=l[1],h=s.boostDocument?s.boostDocument(c,"",this._storedFields.get(u)):1;i.set(u,{score:h,terms:[],match:{}})}}catch(f){t={error:f}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i},n.prototype.combineResults=function(e,t){if(t===void 0&&(t=Aa),e.length===0)return new Map;var r=t.toLowerCase();return e.reduce(Np[r])||new Map},n.prototype.toJSON=function(){var e,t,r,i,s=[];try{for(var o=Y(this._index),a=o.next();!a.done;a=o.next()){var l=me(a.value,2),u=l[0],c=l[1],h={};try{for(var f=(r=void 0,Y(c)),d=f.next();!d.done;d=f.next()){var p=me(d.value,2),m=p[0],y=p[1];h[m]=Object.fromEntries(y)}}catch(g){r={error:g}}finally{try{d&&!d.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}s.push([u,h])}}catch(g){e={error:g}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:s,serializationVersion:2}},n.prototype.termResults=function(e,t,r,i,s,o,a,l){var u,c,h,f,d;if(l===void 0&&(l=new Map),i==null)return l;try{for(var p=Y(Object.keys(s)),m=p.next();!m.done;m=p.next()){var y=m.value,g=s[y],_=this._fieldIds[y],w=i.get(_);if(w!=null){var b=w.size,S=this._avgFieldLength[_];try{for(var A=(h=void 0,Y(w.keys())),T=A.next();!T.done;T=A.next()){var F=T.value;if(!this._documentIds.has(F)){this.removeTerm(_,F,t),b-=1;continue}var k=o?o(this._documentIds.get(F),t,this._storedFields.get(F)):1;if(k){var j=w.get(F),I=this._fieldLength.get(F)[_],N=Bp(j,b,this._documentCount,I,S,a),D=r*g*k*N,z=l.get(F);if(z){z.score+=D,Kp(z.terms,e);var J=va(z.match,t);J?J.push(y):z.match[t]=[y]}else l.set(F,{score:D,terms:[e],match:(d={},d[t]=[y],d)})}}}catch(X){h={error:X}}finally{try{T&&!T.done&&(f=A.return)&&f.call(A)}finally{if(h)throw h.error}}}}}catch(X){u={error:X}}finally{try{m&&!m.done&&(c=p.return)&&c.call(p)}finally{if(u)throw u.error}}return l},n.prototype.addTerm=function(e,t,r){var i=this._index.fetch(r,qu),s=i.get(e);if(s==null)s=new Map,s.set(t,1),i.set(e,s);else{var o=s.get(t);s.set(t,(o||0)+1)}},n.prototype.removeTerm=function(e,t,r){if(!this._index.has(r)){this.warnDocumentChanged(t,e,r);return}var i=this._index.fetch(r,qu),s=i.get(e);s==null||s.get(t)==null?this.warnDocumentChanged(t,e,r):s.get(t)<=1?s.size<=1?i.delete(e):s.delete(t):s.set(t,s.get(t)-1),this._index.get(r).size===0&&this._index.delete(r)},n.prototype.warnDocumentChanged=function(e,t,r){var i,s;try{for(var o=Y(Object.keys(this._fieldIds)),a=o.next();!a.done;a=o.next()){var l=a.value;if(this._fieldIds[l]===t){this._options.logger("warn","MiniSearch: document with ID ".concat(this._documentIds.get(e),' has changed before removal: term "').concat(r,'" was not present in field "').concat(l,'". Removing a document after it has changed can corrupt the index!'),"version_conflict");return}}}catch(u){i={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},n.prototype.addDocumentId=function(e){var t=this._nextId;return this._idToShortId.set(e,t),this._documentIds.set(t,e),this._documentCount+=1,this._nextId+=1,t},n.prototype.addFields=function(e){for(var t=0;t<e.length;t++)this._fieldIds[e[t]]=t},n.prototype.addFieldLength=function(e,t,r,i){var s=this._fieldLength.get(e);s==null&&this._fieldLength.set(e,s=[]),s[t]=i;var o=this._avgFieldLength[t]||0,a=o*r+i;this._avgFieldLength[t]=a/(r+1)},n.prototype.removeFieldLength=function(e,t,r,i){if(r===1){this._avgFieldLength[t]=0;return}var s=this._avgFieldLength[t]*r-i;this._avgFieldLength[t]=s/(r-1)},n.prototype.saveStoredFields=function(e,t){var r,i,s=this._options,o=s.storeFields,a=s.extractField;if(!(o==null||o.length===0)){var l=this._storedFields.get(e);l==null&&this._storedFields.set(e,l={});try{for(var u=Y(o),c=u.next();!c.done;c=u.next()){var h=c.value,f=a(t,h);f!==void 0&&(l[h]=f)}}catch(d){r={error:d}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}},n.wildcard=Symbol("*"),n}(),va=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)?n[e]:void 0},Np=(Pr={},Pr[Aa]=function(n,e){var t,r;try{for(var i=Y(e.keys()),s=i.next();!s.done;s=i.next()){var o=s.value,a=n.get(o);if(a==null)n.set(o,e.get(o));else{var l=e.get(o),u=l.score,c=l.terms,h=l.match;a.score=a.score+u,a.match=Object.assign(a.match,h),Uu(a.terms,c)}}}catch(f){t={error:f}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},Pr[Zu]=function(n,e){var t,r,i=new Map;try{for(var s=Y(e.keys()),o=s.next();!o.done;o=s.next()){var a=o.value,l=n.get(a);if(l!=null){var u=e.get(a),c=u.score,h=u.terms,f=u.match;Uu(l.terms,h),i.set(a,{score:l.score+c,terms:l.terms,match:Object.assign(l.match,f)})}}}catch(d){t={error:d}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return i},Pr[Rp]=function(n,e){var t,r;try{for(var i=Y(e.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;n.delete(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},Pr),jp={k:1.2,b:.7,d:.5},Bp=function(n,e,t,r,i,s){var o=s.k,a=s.b,l=s.d,u=Math.log(1+(t-e+.5)/(e+.5));return u*(l+n*(o+1)/(n+o*(1-a+a*r/i)))},zp=function(n){return function(e,t,r){var i=typeof n.fuzzy=="function"?n.fuzzy(e,t,r):n.fuzzy||!1,s=typeof n.prefix=="function"?n.prefix(e,t,r):n.prefix===!0;return{term:e,fuzzy:i,prefix:s}}},_a={idField:"id",extractField:function(n,e){return n[e]},tokenize:function(n){return n.split($p)},processTerm:function(n){return n.toLowerCase()},fields:void 0,searchOptions:void 0,storeFields:[],logger:function(n,e){typeof(console==null?void 0:console[n])=="function"&&console[n](e)},autoVacuum:!0},Wu={combineWith:Aa,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:jp},Vp={combineWith:Zu,prefix:function(n,e,t){return e===t.length-1}},xa={batchSize:1e3,batchWait:10},Ea={minDirtFactor:.1,minDirtCount:20},ba=le(le({},xa),Ea),Kp=function(n,e){n.includes(e)||n.push(e)},Uu=function(n,e){var t,r;try{for(var i=Y(e),s=i.next();!s.done;s=i.next()){var o=s.value;n.includes(o)||n.push(o)}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},Hu=function(n,e){var t=n.score,r=e.score;return r-t},qu=function(){return new Map},Xi=function(n){var e,t,r=new Map;try{for(var i=Y(Object.keys(n)),s=i.next();!s.done;s=i.next()){var o=s.value;r.set(parseInt(o,10),n[o])}}catch(a){e={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r},$p=/[\n\r -#%-*,-/:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u;var Ta=ue(fe());var Ji=class{constructor(e){this.text=e}};var Wp=/[\u4e00-\u9fa5]/,ec=/[\u4e00-\u9fa5]/g,tc=/[\u4e00-\u9fa5]/,Zi=class{static isLargeCharset(e){return(e.match(ec)||[]).length>=Math.ceil(e.length*.35)}static testWideChar(e){return Wp.test(e)}static wideCharProportion(e){return(e.match(ec)||[]).length/e.length}};var nc=ue(fe());var Up=/[\[\]{}()<>\s]+/u,Hp=/[\^=#%\/\*,\.`:;\?@\s\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u,qp=/[-_]|([a-z](?=[A-Z]))/g,Kt=class{constructor(){this.setting=x(se);this.chsSegmenter=x(tt);this.logThrottled=wr(300,e=>P.info(e));this.assetsProvider=x(Be);this.stopWordsZh=this.assetsProvider.assets.stopWordsZh;this.stopWordsEn=this.assetsProvider.assets.stopWordsEn}tokenize(e,t){var s,o;let r=new Set,i=e.split(Up);for(let a of i)if(a)if(this.setting.enableChinesePatch&&tc.test(a)){let l=this.chsSegmenter.cut(a,!0);for(let u of l){if(this.setting.enableStopWordsZh&&((s=this.stopWordsZh)!=null&&s.has(u))){t==="search"&&u.length>1&&P.debug(`excluded: ${u}`);continue}r.add(u)}}else{let l=a.split(Hp);for(let u of l)if(!(u.length<2||this.setting.enableStopWordsEn&&((o=this.stopWordsEn)!=null&&o.has(u)))&&(r.add(u),u.length>3)){let c=u.replace(qp,"$1 ").split(" ");for(let h of c)h.length>1&&r.add(h)}}return Array.from(r)}};Kt=B([(0,nc.singleton)()],Kt);var un=class{static forType(e,t){return t&&Zi.testWideChar(t)?this.limitsByLanguage["\u7B80\u4F53\u4E2D\u6587"][e]:this.limitsByLanguage["English"][e]}},Xe=un;Xe.default={line:{maxPreLines:0,maxPostLines:0,maxPreChars:30,maxPostChars:230,boundaryLineMinChars:4},paragraph:{maxPreLines:4,maxPostLines:7,maxPreChars:220,maxPostChars:600,boundaryLineMinChars:4},subItem:{maxPreLines:3,maxPostLines:3,maxPreChars:180,maxPostChars:200,boundaryLineMinChars:4}},Xe.limitsByLanguage={["Other Language"]:un.default,["English"]:un.default,["\u7B80\u4F53\u4E2D\u6587"]:{line:{...un.default.line,maxPreChars:30,maxPostChars:230},paragraph:{...un.default.paragraph,maxPreChars:220,maxPostChars:600},subItem:{...un.default.subItem,maxPreChars:60,maxPostChars:80}}};var Ke=class{constructor(){this.option=x(Ir);this.pluginSetting=x(se);this.filesIndex=new Qi(this.option.fileIndexOption);this.linesIndex=new Qi(this.option.lineIndexOption);this.tokenizer=x(Kt);this._isReady=!1}async reIndexAll(e){if(this._isReady=!1,this.filesIndex.removeAll(),Array.isArray(e))P.trace("Indexing all documents..."),await this.addDocuments(e);else{P.trace("Loading indexed data...");try{this.filesIndex=Qi.loadJS(e,this.option.fileIndexOption)}catch(t){return P.error(t),!1}}return this._isReady=!0,P.trace(this.filesIndex),!0}get isReady(){return this._isReady}async addDocuments(e){let t=e.filter(r=>!this.filesIndex.has(r.path));await this.filesIndex.addAllAsync(t,{chunkSize:this.option.documentChunkSize}),P.debug(`added ${t.length}`)}deleteDocuments(e){let t=e.filter(r=>this.filesIndex.has(r));this.filesIndex.discardAll(t),P.debug(`deleted ${t.length}`)}async fzfMatch(e,t){return(await new Gi(t,{selector:i=>i.text}).find(e)).slice(0,this.pluginSetting.ui.maxItemResults).map(i=>({text:i.item.text,row:i.item.row,positions:i.positions}))}async searchFiles(e){let t="and",r=new Ji(e),i=this.filesIndex.search(r.text,this.option.getFileSearchOption(t));return P.debug(`maxFileItems: ${this.pluginSetting.ui.maxItemResults}`),i.slice(0,this.pluginSetting.ui.maxItemResults).map(s=>({path:s.id,queryTerms:s.queryTerms,matchedTerms:s.terms}))}async searchLinesByFileItem(e,t,r,i,s){P.debug(i.queryTerms),P.debug(i.matchedTerms);let o=50;return P.debug(`max subItems: ${o}`),new Mr(e,t,r,i.queryTerms,i.matchedTerms,s).parse()}async searchLinesForSmallCharset(e,t,r){this.linesIndex.removeAll(),this.linesIndex.addAll(e);let i=this.linesIndex.search(t,this.option.getLineSearchOption());return P.debug(`matched lines count: ${i.length}`),P.debug(`only parse top ${r} matched lines per file`),i.slice(0,r).map(s=>{let o=e[s.id].text;return{text:o,row:s.id,positions:this.findAllTermPositions(o,s.terms)}})}findAllTermPositions(e,t){let r=new RegExp(t.join("|"),"gi"),i=new Set,s,o=-1;for(;(s=r.exec(e))!==null;){if(s.index===o||s[0].length===0){r.lastIndex++;continue}for(let a=0;a<s[0].length;a++)i.add(s.index+a);o=s.index}return i}};B([Ee],Ke.prototype,"reIndexAll",1),B([Ee],Ke.prototype,"searchFiles",1),B([Ee],Ke.prototype,"searchLinesForSmallCharset",1),Ke=B([(0,Ta.singleton)()],Ke);var Ir=class{constructor(){this.inSetting=Cl.search;this.tokenizer=x(Kt);this.tokenizeIndex=e=>this.tokenizer.tokenize(e,"index");this.tokenizeSearch=e=>this.tokenizer.tokenize(e,"search");this.fileIndexOption={tokenize:this.tokenizeIndex,idField:"path",fields:["basename","aliases","folder","headings","content"],storeFields:["tags"]};this.lineIndexOption={tokenize:this.tokenizeIndex,idField:"row",fields:["text"]}}getFileSearchOption(e){return{tokenize:this.tokenizeSearch,prefix:t=>t.length>=this.inSetting.minTermLengthForPrefixSearch,fuzzy:t=>t.length<=3?0:this.inSetting.fuzzyProportion,boost:{basename:this.inSetting.weightFilename,aliases:this.inSetting.weightFilename,folder:this.inSetting.weightFolder,tags:this.inSetting.weightTagText,headings:this.inSetting.weightHeading},combineWith:e}}getLineSearchOption(){return{prefix:e=>e.length>=this.inSetting.minTermLengthForPrefixSearch,fuzzy:e=>e.length<=3?0:this.inSetting.fuzzyProportion,combineWith:"or"}}};Ir=B([(0,Ta.singleton)()],Ir);var Mr=class{constructor(e,t,r,i,s,o){this.lines=e,this.matchedTerms=this.filterMatchedTerms(i,s),this.maxParsedLines=o;let a=Xe.forType(t,r);this.preChars=a.maxPreChars,this.postChars=a.maxPostChars,P.debug(`doc matchedTerms: ${this.matchedTerms.join(" ")}`)}parse(){return this.highlightLines(this.getTopRelevantLines(this.lines,this.maxParsedLines))}filterMatchedTerms(e,t){let r=e.filter(s=>!e.some(o=>o.length>s.length&&o.includes(s))&&t.includes(s)),i;if(r.length===0)i=t.filter(s=>!t.some(o=>o.length>s.length&&o.includes(s)));else{i=r;for(let s of t)!r.includes(s)&&!this.isSubstringOrSuperString(s,t)&&i.push(s)}return i}isSubstringOrSuperString(e,t){return t.some(r=>r.length>e.length&&r.includes(e)||e.length>r.length&&e.includes(r))}getTopRelevantLines(e,t){let r=new RegExp(this.matchedTerms.join("|"),"i"),i=this.matchedTerms.map(l=>new RegExp(l,"gi")),s=new Ui((l,u)=>l-u,t);s.push(0);let o=new Map,a=new Map;for(let l of e){if(!r.test(l.text))continue;a.clear();let u=0;for(let c of i){c.lastIndex=0;let h;for(;(h=c.exec(l.text))!==null;){let f=h[0],d=(a.get(f)||0)+1;a.set(f,d),u+=d===1?f.length:.01}}u>s.peek()&&(s.push(u),o.set(l,u))}return Array.from(o.entries()).sort((l,u)=>u[1]-l[1]).slice(0,t).map(l=>l[0])}highlightLines(e){let t=new Map;for(let r of this.matchedTerms)t.set(r,new RegExp(r,"gi"));return e.map(r=>{let i=new Set,s=-1,o=-1;for(let a=this.matchedTerms.length-1;a>=0;a--){let l=this.matchedTerms[a],u=r.text.search(t.get(l));if(u!==-1){s=Math.max(0,u-this.preChars),o=Math.min(r.text.length,u+l.length+this.postChars);break}}if(s!==-1&&o!==-1){let a=r.text.slice(s,o);for(let l of this.matchedTerms){let u=t.get(l),c;for(;(c=u.exec(a))!==null;){let h=c.index+s,f=h+c[0].length;for(let d=h;d<f;d++)i.add(d)}}}return{text:r.text,row:r.row,positions:i}})}};B([Ee],Mr.prototype,"getTopRelevantLines",1),B([Ee],Mr.prototype,"highlightLines",1);var Nn=class{constructor(){this.lexicalEngine=x(Ke)}parseAll(e,t,r,i){return t.map(s=>{let o=xr.minInSet(s.positions),a=s.row,l=this.getTruncatedContext(e,a,o,r),u=l.matchedLineText,c=s.positions;s.row===l.lines[0].row&&(c=this.adjustPositionsByStartCol(c,l.firstLineStartCol));let h=this.highlightMatchedLine(u,c,i),f=l.lines.map(d=>d.row===a?h:d.text).join(ae.JOIN_EOL);return{row:s.row,col:o,text:f}})}parse(e,t,r,i){return this.parseAll(e,[t],r,i)[0]}async parseLineItems(e,t){let r=t.replace(/\s/g,""),i=[],s=await this.lexicalEngine.fzfMatch(r,e);for(let o of s){let a=o.row,l=xr.minInSet(o.positions),u=e[a].text,c=Math.max(l-30,0),h=Math.min(c+200,u.length),f=u.substring(c,h),d=this.adjustPositionsByStartCol(o.positions,c),p=this.highlightLineByCharPositions(f,d),m=await this.getLineHighlightedContext(e,a,l,t);i.push(new zt({text:p,row:a,col:l},m))}return i}highlightMatchedLine(e,t,r){return r?`<span class="matched-line highlight-bg">${this.highlightLineByCharPositions(e,t)}</span>`:`<span class="matched-line">${this.highlightLineByCharPositions(e,t)}</span>`}highlightContextLine(e,t){let r=new RegExp(t,"gi");return e.replace(r,i=>`<mark>${i}</mark>`)}highlightLineByCharPositions(e,t){return e.split("").map((r,i)=>t.has(i)?`<mark>${r}</mark>`:r).join("")}adjustPositionsByStartCol(e,t){let r=new Set;return e.forEach(i=>{i>=t&&r.add(i-t)}),r}getTruncatedContext(e,t,r,i){if(e.length===0)return{lines:[],firstLineStartCol:0,matchedLineText:""};let s=i,o,a=0,l=0,u=e[t].text;if(r<s.maxPreChars){let c=this.extendContextAbove(e,t-1,s.maxPreChars-r,s.maxPreLines,s.boundaryLineMinChars);o=c.lines,a=c.firstLineStartCol;let h=Math.min(u.length-1,r+s.maxPostChars);h<u.length-1?(u=u.substring(0,h+1),o.push({text:u,row:t})):o.push(e[t]),l+=h-r}else{let c=r-s.maxPreChars;a=c;let h=Math.min(u.length-1,r+s.maxPostChars);h<u.length-1?u=u.substring(c,h+1):u=u.substring(c),o=[{text:u,row:t}],l+=h-r}return ut.append(o,this.extendContextBelow(e,t+1,s.maxPostChars-l,s.maxPostLines,s.boundaryLineMinChars)),{lines:o,firstLineStartCol:a,matchedLineText:u}}extendContextAbove(e,t,r,i,s){let o=0,a=t,l=0,u=[];for(;a>=0&&t-a<i;){let c=e[a].text;if(l+c.length<r)u.unshift(e[a]),l+=c.length,--a;else if(l+c.length==r){u.unshift(e[a]);break}else{let h=l+c.length-r;o=h;let f=e[a].text.substring(h);u.unshift({text:f,row:a});break}}return u.length>0&&u[0].text.length<s&&(o=0,u.shift()),{lines:u,firstLineStartCol:o}}extendContextBelow(e,t,r,i,s){let o=t,a=0,l=[];for(;o<=e.length-1&&o-t<i;){let u=e[o].text;if(a+u.length<r)l.push(e[o]),a+=u.length,++o;else if(a+u.length==r){l.push(e[o]);break}else{let c=u.length-(a+u.length-r)-1,h=e[o].text.substring(0,c+1);l.push({text:h,row:o});break}}return l.length>0&&l[0].text.length<s&&l.pop(),l}async getLineHighlightedContext(e,t,r,i){let s=ut.getCurrLanguage(),o=this.getTruncatedContext(e,t,r,Xe.forType("paragraph")),a=o.lines;return(await Promise.all(a.map(async(u,c)=>{if(u.row===t){let h=await this.lexicalEngine.fzfMatch(i,[u]);try{let d=h[0].positions;return c===0&&(d=this.adjustPositionsByStartCol(d,o.firstLineStartCol)),this.highlightMatchedLine(u.text,d,!0)}catch(f){P.warn("There might be inconsistency with previous search step, which lead to a missed match to target line"),P.error(f)}}else return this.highlightContextLine(u.text,i)}))).join(ae.JOIN_EOL)}};Nn=B([(0,rc.singleton)()],Nn);var it=class{constructor(){this.app=x(ic.App);this.dataProvider=x(Ie);this.lexicalEngine=x(Ke);this.lineHighlighter=x(Nn);this.viewRegistry=x(De)}async searchInVault(e){var o;let t=new Bt("no result",[]);if(e.length===0)return t;let r=((o=this.app.workspace.getActiveFile())==null?void 0:o.path)||"no source path",i=await this.lexicalEngine.searchFiles(e),s=[];return i.length!==0?{sourcePath:r,items:i.map(a=>new kn(0,a.path,a.queryTerms,a.matchedTerms,[],"nothing"))}:(P.trace("lexical matched files count is 0"),t)}async getFileSubItems(e,t){let r=t.path;if(this.viewRegistry.viewTypeByPath(r)!=="markdown")return P.warn(`view type for path "${r}" is not supported for sub-items.`),[];let s=(await this.dataProvider.readPlainText(r)).split(ae.SPLIT_EOL).map((l,u)=>new On(l,u));P.debug("target file lines count: ",s.length);let o=await this.lexicalEngine.searchLinesByFileItem(s,"subItem",e,t,30);return this.lineHighlighter.parseAll(s,o,Xe.forType("subItem",e),!1).map(l=>({text:l.text,row:l.row,col:l.col}))}async searchInFile(e){let t=new Bt("",[]),r=this.app.workspace.getActiveFile();if(!e||!r)return t;if(this.viewRegistry.viewTypeByPath(r.path)!=="markdown")return P.trace("Current file isn't PLAINT_TEXT"),t;let i=(await this.dataProvider.readPlainTextLines(r.path)).map((l,u)=>new On(l,u)),s=e.replace(/\s/g,""),a=(await this.lexicalEngine.fzfMatch(s,i)).map(l=>{let u=this.lineHighlighter.parse(i,l,Xe.forType("line"),!1),c=this.lineHighlighter.parse(i,l,Xe.forType("paragraph"),!0);return new zt(u,c.text)});return{sourcePath:r.path,items:a}}async deprecatedSearchInFile(e){let t=new Bt("",[]),r=this.app.workspace.getActiveFile();if(!e||!r||this.viewRegistry.viewTypeByPath(r.path)!=="markdown")return t;let i=r.path,s=(await this.dataProvider.readPlainTextLines(i)).map((a,l)=>new On(a,l)),o=await this.lineHighlighter.parseLineItems(s,e);return{sourcePath:i,items:o}}};B([Ee],it.prototype,"searchInVault",1),B([Ee],it.prototype,"getFileSubItems",1),B([Ee],it.prototype,"searchInFile",1),B([Ee],it.prototype,"deprecatedSearchInFile",1),it=B([(0,sc.singleton)()],it);async function oc(){let n=x(se);x(jt).testImageSearch()}var te=require("obsidian");var dn=ue(fe());var Or=ue(fe());var $t=class{constructor(){this.db=x(Ye)}async deleteMinisearchData(){this.db.minisearch.clear()}async setMiniSearchData(e){this.db.transaction("rw",this.db.minisearch,async()=>{await this.db.minisearch.clear(),await this.db.minisearch.add({data:e}),P.trace("minisearch data saved")})}async getMiniSearchData(){var e;return((e=(await this.db.minisearch.toArray())[0])==null?void 0:e.data)||null}async setDocumentRefs(e){this.db.transaction("rw",this.db.documentRefs,async()=>{await this.db.documentRefs.clear(),await this.db.documentRefs.bulkAdd(e)})}async getDocumentRefs(){return await this.db.documentRefs.toArray()||null}async setPluginSetting(e){try{return await this.db.transaction("rw",this.db.pluginSetting,()=>{this.db.pluginSetting.clear(),this.db.pluginSetting.add({data:e})}),P.trace("settings have been saved to database"),!0}catch(t){return P.trace(`settings failed to be saved: ${t}`),!1}}async deleteOldDatabases(){let e=(await indexedDB.databases()).filter(t=>t.name===this.db.dbName&&t.version!==this.db.dbVersion*10);if(e.length){P.trace("Those IndexedDb databases will be deleted:");for(let t of e)t.name&&indexedDB.deleteDatabase(t.name)}}};B([Ee],$t.prototype,"getMiniSearchData",1),B([Ee],$t.prototype,"getDocumentRefs",1),$t=B([(0,Or.singleton)()],$t);var Ye=class extends He{constructor(t){super(Ye.dbNamePrefix+t.getAppId());this.privateApi=t,this.version(Ye._dbVersion).stores({pluginSetting:"++id",minisearch:"++id",documentRefs:"++id"})}get dbVersion(){return Ye._dbVersion}get dbName(){return Ye.dbNamePrefix+this.privateApi.getAppId()}};Ye._dbVersion=1,Ye.dbNamePrefix="clever-search/",Ye=B([(0,Or.singleton)(),Wr(0,(0,Or.inject)(qe))],Ye);var Fa=class{constructor(){this.listeners=new Map}on(e,t){var r;this.listeners.has(e)||this.listeners.set(e,[]),(r=this.listeners.get(e))==null||r.push(t)}off(e,t){let r=this.listeners.get(e);if(r){let i=r.indexOf(t);i>-1&&r.splice(i,1)}}emit(e,...t){var r;(r=this.listeners.get(e))==null||r.forEach(i=>{i(...t)})}},Wt=new Fa;var cc=ue(fe());var ac=require("obsidian");var lc=ue(fe());var cn=class{constructor(){this.dataManager=x($e);this.app=x(ac.App);this.onCreate=e=>{P.debug(`created: ${e.path}`),this.dataManager.receiveDocOperation(new fn(e))};this.onDelete=e=>{P.debug(`deleted: ${e.path}`),this.dataManager.receiveDocOperation(new hn(e.path))};this.onRename=(e,t)=>{P.debug(`renamed: ${t} => ${e.path}`),this.dataManager.receiveDocOperation(new hn(t)),this.dataManager.receiveDocOperation(new fn(e))};this.onModify=e=>{P.debug(`modified: ${e.path}`),this.dataManager.receiveDocOperation(new hn(e.path)),this.dataManager.receiveDocOperation(new fn(e))}}start(){this.stop(),this.app.vault.on("create",this.onCreate),this.app.vault.on("delete",this.onDelete),this.app.vault.on("rename",this.onRename),this.app.vault.on("modify",this.onModify),P.trace("FileWatcher started")}stop(){this.app.vault.off("create",this.onCreate),this.app.vault.off("delete",this.onDelete),this.app.vault.off("rename",this.onRename),this.app.vault.off("modify",this.onModify)}};cn=B([(0,lc.singleton)()],cn);var $e=class{constructor(){this.database=x($t);this.dataProvider=x(Ie);this.lexicalEngine=x(Ke);this.shouldForceRefresh=!1;this.isLexicalEngineUpToDate=!1;this.docOperationsHandler=async e=>{e.sort((t,r)=>t.time-r.time);for(let t of e)if(t instanceof fn)await this.addDocuments([t.file]);else if(t instanceof hn)await this.deleteDocuments([t.path]);else throw Error(Sl)};this.docOperationsBuffer=new Wi(this.docOperationsHandler,e=>e.path+e.type,3)}async initAsync(){await this.initLexicalEngines(),await this.updateDocRefsByMtime(),this.shouldForceRefresh||(Wt.on(9,()=>this.docOperationsBuffer.forceFlush()),x(cn).start()),await this.database.setMiniSearchData(this.lexicalEngine.filesIndex.toJSON())}onunload(){x(cn).stop()}receiveDocOperation(e){this.docOperationsBuffer.add(e)}async refreshAllAsync(){let e=new Ge(U("Reindexing..."));this.shouldForceRefresh=!0,await this.initAsync(),e.hide(),new Ge(U("Indexing finished"),5e3),this.shouldForceRefresh=!1}async addDocuments(e){let t=await this.dataProvider.generateAllIndexedDocuments(e.filter(r=>this.dataProvider.isIndexable(r)));await this.lexicalEngine.addDocuments(t)}async deleteDocuments(e){this.lexicalEngine.deleteDocuments(e.filter(t=>this.dataProvider.isIndexable(t)))}async initLexicalEngines(){P.trace("Init lexical engine...");let e;!tr.loadIndexFromDatabase||this.shouldForceRefresh?e=null:e=await this.database.getMiniSearchData(),e?(this.database.deleteMinisearchData(),P.trace("Previous minisearch data is found."),await this.lexicalEngine.reIndexAll(e)||(new Ge(U("Database has been updated, a reindex is required"),7e3),await this.reindexLexicalEngineWithCurrFiles())):await this.reindexLexicalEngineWithCurrFiles(),P.trace("Lexical engine is ready")}async reindexLexicalEngineWithCurrFiles(){P.trace("Indexing the whole vault...");let e=this.dataProvider.allFilesToBeIndexed(),t=0;for(let i of e)t+=i.stat.size;if(t/=1024,t>2e3){let i=(t/1024).toFixed(2)+" MB";new Ge(`${i} ${U("files need to be indexed. Obsidian may freeze for a while")}`,7e3)}let r=await this.dataProvider.generateAllIndexedDocuments(e);await this.lexicalEngine.reIndexAll(r),this.isLexicalEngineUpToDate=!0}async updateDocRefsByMtime(){var e;if(!this.isLexicalEngineUpToDate){let t=new Map(this.dataProvider.allFilesToBeIndexed().map(a=>[a.path,a])),r=new Map((e=await this.database.getDocumentRefs())==null?void 0:e.map(a=>[a.path,a])),i=[],s=[];for(let[a,l]of t){let u=r.get(a);u?l.stat.mtime>u.lexicalMtime&&(s.push(l.path),i.push(l)):i.push(l)}for(let a of r.keys())t.has(a)||s.push(a);P.trace(`docs to delete: ${s.length}`),P.trace(`docs to add: ${i.length}`),await this.deleteDocuments(s),await this.addDocuments(i);let o=Array.from(t.values()).map(a=>({path:a.path,lexicalMtime:a.stat.mtime,embeddingMtime:a.stat.mtime}));this.database.setDocumentRefs(o),P.trace(`${o.length} doc refs updated`),this.isLexicalEngineUpToDate=!0}}};B([Ee],$e.prototype,"initAsync",1),$e=B([(0,cc.singleton)()],$e);var ts=class{constructor(e,t){this.time=performance.now();this.type=e,typeof t=="string"?this.path=t:this.path=t.path}},fn=class extends ts{constructor(t){super("add",t);this.file=t}},hn=class extends ts{constructor(e){super("delete",e)}};var st=class{constructor(){this.plugin=x(et);this.shouldReload=!1}async initAsync(){await this.loadSettings(),dn.container.register(se,{useValue:this.setting}),this.plugin.addSettingTab(x(kr))}async saveSettings(){await this.plugin.saveData(this.setting)}async postSettingUpdated(){this.saveSettings(),this.shouldReload&&(this.shouldReload=!1,await this.downloadAndRefresh())}async loadSettings(){this.setting=ut.mergeDeep(Tl,await this.plugin.loadData()),P.setLevel(this.setting.logLevel)}async downloadAndRefresh(){x(De).refreshAll(),await x(Be).initAsync(),await x(tt).initAsync(),x(Ie).init(),await x($e).refreshAllAsync()}};st=B([(0,dn.singleton)()],st);var kr=class extends te.PluginSettingTab{constructor(t){super(t.app,t);this.settingManager=x(st);this.setting=x(se)}hide(){this.settingManager.postSettingUpdated()}display(){let{containerEl:t}=this;t.empty(),new te.Setting(t).setName(U("Max items count")).setDesc(U("Max items count desc")).addSlider(a=>a.setLimits(1,300,1).setValue(this.setting.ui.maxItemResults).setDynamicTooltip().onChange(l=>{this.setting.ui.maxItemResults=l})),new te.Setting(t).setName(U("Floating window for in-file search")).setDesc(U("Floating window for in-file search desc")).addToggle(a=>a.setValue(this.setting.ui.floatingWindowForInFile).onChange(l=>this.setting.ui.floatingWindowForInFile=l)),new te.Setting(t).setName(U("English word blacklist")).setDesc(U("English word blacklist desc")).addToggle(a=>a.setValue(this.setting.enableStopWordsEn).onChange(l=>{this.setting.enableStopWordsEn=l,this.settingManager.shouldReload=!0})),new te.Setting(t).setName(U("Chinese patch")).setDesc(U("Chinese patch desc")).addToggle(a=>a.setValue(this.setting.enableChinesePatch).onChange(async l=>{this.setting.enableChinesePatch=l,P.info(`enable chinese: ${x(se).enableChinesePatch}`),this.settingManager.shouldReload=!0})),new te.Setting(t).setName(U("Chinese word blacklist")).setDesc(U("Chinese word blacklist desc")).addToggle(a=>a.setValue(this.setting.enableStopWordsZh).onChange(async l=>{this.setting.enableStopWordsZh=l,this.settingManager.shouldReload=!0})),new te.Setting(t).setName(U("Advanced")).setDesc(U("Advanced.desc")),new te.Setting(t).setName(U("Excluded files")).addButton(a=>a.setButtonText(U("Manage")).onClick(()=>{new Pa(x(te.App)).open()})),new te.Setting(t).setName(U("Customize extensions")).addButton(a=>a.setButtonText(U("Manage")).onClick(()=>new Ia(x(te.App)).open()));let r=t.createDiv("cs-dev-setting-group");r.style.marginTop="1.5em";let i=r.createDiv({cls:"cs-setting-group-dev-title",text:U("For Development")}),s=r.createDiv({cls:"cs-setting-group-dev-content"}),o=this.setting.ui.collapseDevSettingByDefault;s.style.display=o?"none":"block",i.style.setProperty("--cs-dev-collapse-icon",o?Ys:Qs),i.onclick=()=>{let a=s.style.display==="none";s.style.display=a?"block":"none",i.style.setProperty("--cs-dev-collapse-icon",a?Qs:Ys)},new te.Setting(s).setName(U("Collapse development setting by default")).addToggle(a=>a.setValue(this.setting.ui.collapseDevSettingByDefault).onChange(l=>{this.setting.ui.collapseDevSettingByDefault=l})),new te.Setting(s).setName(U("Reindex the vault")).addButton(a=>{a.setButtonText(U("Reindex")).onClick(async()=>{await x($e).refreshAllAsync()})}),new te.Setting(s).setName(U("Log level")).addDropdown(a=>a.addOptions({trace:"trace",debug:"debug",info:"info",warn:"warn",error:"error",none:"none"}).setValue(this.setting.logLevel.toLowerCase()).onChange(async l=>{let u=l;P.setLevel(u),this.setting.logLevel=u})),new te.Setting(s).setName(U("Reset floating window position")).setDesc(U("Reset floating window position desc")).addButton(a=>a.setButtonText(U("Reset position")).onClick(l=>{x(Le).resetAllPositions()})),new te.Setting(s).setName(U("Support the Project")).setDesc(U("Support the Project desc")).addButton(a=>{a.setButtonText(U("Visit GitHub")).onClick(()=>{window.open("https://github.com/yan42685/obsidian-clever-search","_blank")})}),new te.Setting(s).setName("API provider1").setDesc("domain and key").addText(a=>a.setPlaceholder("api.openai.com").setValue(this.setting.apiProvider1.domain).onChange(l=>{this.setting.apiProvider1.domain=l,this.settingManager.saveSettings()})).addText(a=>a.setPlaceholder("API key").setValue(this.setting.apiProvider1.key).onChange(l=>{this.setting.apiProvider1.key=l})),new te.Setting(s).setName("API provider2").setDesc("description").addText(a=>a.setPlaceholder("api.openai.com").setValue(this.setting.apiProvider2.domain).onChange(l=>{this.setting.apiProvider2.domain=l})).addText(a=>a.setPlaceholder("API key").setValue(this.setting.apiProvider2.key).onChange(l=>{this.setting.apiProvider2.key=l}))}};kr=B([(0,dn.singleton)(),Wr(0,(0,dn.inject)(et))],kr);var Pa=class extends te.Modal{constructor(t){super(t);this.settingManager=x(st);this.setting=x(se);this.excludedPaths=this.setting.excludedPaths;this.allPaths=new Set;this.allFolders=new Set;let r=x(te.Vault).getAllLoadedFiles();for(let i of r)this.allPaths.add(i.path),i instanceof te.TFolder&&this.allFolders.add(i.path)}onOpen(){var r;this.modalEl.style.width="48vw",this.modalEl.style.marginBottom="5em",(r=this.modalEl.querySelector(".modal-close-button"))==null||r.remove();let t=this.contentEl;new te.Setting(t).setName(U("Follow Obsidian Excluded Files")).addToggle(i=>i.setValue(this.setting.followObsidianExcludedFiles).onChange(s=>{this.setting.followObsidianExcludedFiles=s,this.settingManager.shouldReload=!0})),t.createEl("h2",{text:U("Excluded files")}),this.excludesEl=t.createDiv(),this.renderExcludedList(this.excludesEl),new te.Setting(t).addText(i=>{this.inputEl=i.inputEl,i.setPlaceholder(U("Enter path...")).onChange(s=>{this.suggester.close(),this.suggester.open()})}).addButton(i=>{i.setButtonText(U("Add")).onClick(()=>{this.addPath(this.inputEl.value)})}),this.suggester=new Ki(this.inputEl,this.allFolders,i=>{this.addPath(i)}),setTimeout(()=>{this.inputEl.focus()},1)}renderExcludedList(t){t.empty(),this.excludedPaths.forEach((r,i)=>{let s=t.createDiv();s.style.overflow="auto",s.style.display="flex",s.style.margin="0.7em 0 0.7em 0",s.style.justifyContent="space-between";let o=s.createSpan();o.setText(r),o.style.width="90%",o.style.overflow="auto";let a=s.createSpan();a.setText("\u2715"),a.style.cursor="pointer",a.onClickEvent(()=>{this.excludedPaths.splice(i,1),this.settingManager.shouldReload=!0,this.renderExcludedList(t)})})}addPath(t){t&&!this.excludedPaths.includes(t)&&(this.allPaths.has(t)?(this.excludedPaths.push(t),this.settingManager.shouldReload=!0,this.renderExcludedList(this.excludesEl)):new Ge(`Path doesn't exist: ${t}`,5e3))}},Ia=class extends te.Modal{constructor(){super(...arguments);this.setting=x(se);this.settingManager=x(st)}onOpen(){var r;this.modalEl.style.width="60vw",(r=this.modalEl.querySelector(".modal-close-button"))==null||r.remove();let t=this.contentEl;new te.Setting(t).setDesc(U("extensionModal.desc")),new te.Setting(t).setName(U("extensionModal.plaintextName")).setDesc(U("extensionModal.plaintextDesc")).addTextArea(i=>{i.inputEl.style.minWidth="20vw",i.inputEl.style.minHeight="20vh",i.setValue(this.setting.customExtensions.plaintext.join(" ")),i.onChange(s=>{let o=s.split(/[\s\n]+/).map(a=>a.startsWith(".")?a.substring(1):a).filter(a=>a.length>0);this.setting.customExtensions.plaintext=o,this.settingManager.shouldReload=!0})}),new te.Setting(t).setName("Image").setDesc("Todo")}};var Va=ue(fe());function At(){}function Da(n){return n()}function fc(){return Object.create(null)}function Tt(n){n.forEach(Da)}function ns(n){return typeof n=="function"}function dc(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function pc(n){return Object.keys(n).length===0}var mc=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global,Lr=class{constructor(e){this.options=e,this._listeners="WeakMap"in mc?new WeakMap:void 0}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!==null&&e!==void 0?e:this._observer=new ResizeObserver(t=>{var r;for(let i of t)Lr.entries.set(i.target,i),(r=this._listeners.get(i.target))===null||r===void 0||r(i)})}};Lr.entries="WeakMap"in mc?new WeakMap:void 0;var gc=!1;function Gp(){gc=!0}function Xp(){gc=!1}function Te(n,e){n.appendChild(e)}function yc(n,e,t){let r=Yp(n);if(!r.getElementById(e)){let i=ye("style");i.id=e,i.textContent=t,Qp(r,i)}}function Yp(n){if(!n)return document;let e=n.getRootNode?n.getRootNode():n.ownerDocument;return e&&e.host?e:n.ownerDocument}function Qp(n,e){return Te(n.head||n,e),e.sheet}function We(n,e,t){n.insertBefore(e,t||null)}function Re(n){n.parentNode&&n.parentNode.removeChild(n)}function La(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function ye(n){return document.createElement(n)}function Jp(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function ss(n){return document.createTextNode(n)}function Vn(){return ss(" ")}function Ra(){return ss("")}function Ut(n,e,t,r){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}function ve(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function Zp(n){return Array.from(n.childNodes)}function vc(n,e){e=""+e,n.data!==e&&(n.data=e)}function Na(n,e){n.value=e==null?"":e}function jr(n,e,t){n.classList[t?"add":"remove"](e)}var rs=class{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=Jp(t.nodeName):this.e=ye(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)We(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(Re)}};var Rr;function Dr(n){Rr=n}function em(){if(!Rr)throw new Error("Function called outside component initialization");return Rr}function os(n){em().$$.on_destroy.push(n)}var Bn=[];var Nr=[],zn=[],hc=[],_c=Promise.resolve(),Oa=!1;function bc(){Oa||(Oa=!0,_c.then(wc))}function Br(){return bc(),_c}function ka(n){zn.push(n)}var Ma=new Set,jn=0;function wc(){if(jn!==0)return;let n=Rr;do{try{for(;jn<Bn.length;){let e=Bn[jn];jn++,Dr(e),tm(e.$$)}}catch(e){throw Bn.length=0,jn=0,e}for(Dr(null),Bn.length=0,jn=0;Nr.length;)Nr.pop()();for(let e=0;e<zn.length;e+=1){let t=zn[e];Ma.has(t)||(Ma.add(t),t())}zn.length=0}while(Bn.length);for(;hc.length;)hc.pop()();Oa=!1,Ma.clear(),Dr(n)}function tm(n){if(n.fragment!==null){n.update(),Tt(n.before_update);let e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(ka)}}function nm(n){let e=[],t=[];zn.forEach(r=>n.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),zn=e}var rm=new Set;function im(n,e){n&&n.i&&(rm.delete(n),n.i(e))}var sm=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],F_=new Set([...sm]);function om(n,e,t,r){let{fragment:i,after_update:s}=n.$$;i&&i.m(e,t),r||ka(()=>{let o=n.$$.on_mount.map(Da).filter(ns);n.$$.on_destroy?n.$$.on_destroy.push(...o):Tt(o),n.$$.on_mount=[]}),s.forEach(ka)}function xc(n,e){let t=n.$$;t.fragment!==null&&(nm(t.after_update),Tt(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function am(n,e){n.$$.dirty[0]===-1&&(Bn.push(n),bc(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function Ec(n,e,t,r,i,s,o,a=[-1]){let l=Rr;Dr(n);let u=n.$$={fragment:null,ctx:[],props:s,update:At,not_equal:i,bound:fc(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:fc(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(u.root);let c=!1;if(u.ctx=t?t(n,e.props||{},(h,f,...d)=>{let p=d.length?d[0]:f;return u.ctx&&i(u.ctx[h],u.ctx[h]=p)&&(!u.skip_bound&&u.bound[h]&&u.bound[h](p),c&&am(n,h)),f}):[],u.update(),c=!0,Tt(u.before_update),u.fragment=r?r(u.ctx):!1,e.target){if(e.hydrate){Gp();let h=Zp(e.target);u.fragment&&u.fragment.l(h),h.forEach(Re)}else u.fragment&&u.fragment.c();e.intro&&im(n.$$.fragment),om(n,e.target,e.anchor,e.customElement),Xp(),wc()}Dr(l)}var lm;typeof HTMLElement=="function"&&(lm=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){let{on_mount:n}=this.$$;this.$$.on_disconnect=n.map(Da).filter(ns);for(let e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(n,e,t){this[n]=t}disconnectedCallback(){Tt(this.$$.on_disconnect)}$destroy(){xc(this,1),this.$destroy=At}$on(n,e){if(!ns(e))return At;let t=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return t.push(e),()=>{let r=t.indexOf(e);r!==-1&&t.splice(r,1)}}$set(n){this.$$set&&!pc(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}});var is=class{$destroy(){xc(this,1),this.$destroy=At}$on(e,t){if(!ns(t))return At;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let i=r.indexOf(t);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!pc(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};function pn(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?s(c.value):i(c.value).then(a,l)}u((r=r.apply(n,e||[])).next())})}var as=require("obsidian");var Sc=ue(fe());var Kn=class{constructor(){this.app=x(as.App);this.privateApi=x(qe);this.setting=x(se)}updateSubItemIndex(e,t,r){let i=e[t],s=e.length-1;return this.scrollTo("center",i,"auto"),r==="next"?t<s?t+1:t:t>0?t-1:t}async handleConfirmAsync(e,t,r,i,s){if(e(),i)if(r===1){let o=i;await this.jumpInVaultAsync(t,o.line.row,o.line.col)}else if(r===2){let o=i,a=o.viewType;if(s!==-1){let l=o.subItems[s];if(a==="markdown")await this.jumpInVaultAsync(o.path,l.row,l.col);else throw Error("unsupported viewType to jump")}else await this.jumpInVaultAsync(o.path,0,0)}else throw Error(`unsupported search type to jump ${r}`)}scrollTo(e,t,r){setTimeout(()=>{t&&t.element&&t.element.scrollIntoView({behavior:r,block:e})},0)}focusInput(){setTimeout(()=>{let e=document.getElementById("cs-search-input");e==null||e.focus()},0)}async jumpInVaultAsync(e,t,r){let i=!1;this.app.workspace.iterateAllLeaves(s=>{var o;((o=s.getViewState().state)==null?void 0:o.file)===e&&(this.app.workspace.setActiveLeaf(s,{focus:!0}),i=!0)}),i?this.scrollIntoViewForExistingView(t,r):(await this.app.workspace.openLinkText(e,"",this.setting.ui.openInNewPane),this.app.workspace.onLayoutReady(()=>this.scrollIntoViewForExistingView(t,r)))}scrollIntoViewForExistingView(e,t){let r=this.app.workspace.getActiveViewOfType(as.MarkdownView),i={line:e,ch:t};if(r){let s=r.getState();s.mode="source",r.setState(s,{history:!1}),r.editor.setCursor(i),r.editor.scrollIntoView({from:i,to:i},!0),this.privateApi.executeCommandById("editor:focus")}else P.info("No markdown view to jump")}};Kn=B([(0,Sc.singleton)()],Kn);function um(n){yc(n,"svelte-1ytln9p",`div.svelte-1ytln9p.svelte-1ytln9p.svelte-1ytln9p,button.svelte-1ytln9p.svelte-1ytln9p.svelte-1ytln9p{user-select:text}.search-container.svelte-1ytln9p.svelte-1ytln9p.svelte-1ytln9p{display:flex;white-space:pre-wrap;overflow-wrap:break-word}.search-container mark{background-color:var(--cs-highlight-bgc, rgba(219, 204, 149, 0.9));color:var(--cs-highlight-char-color, #111)}.left-pane.svelte-1ytln9p.svelte-1ytln9p.svelte-1ytln9p{display:flex;flex-direction:column;align-items:left;width:27.5vw}.search-bar.svelte-1ytln9p.svelte-1ytln9p.svelte-1ytln9p{position:sticky;top:-0.2em;left:0;width:97%;height:30px}.search-bar.svelte-1ytln9p.svelte-1ytln9p.svelte-1ytln9p::after{content:attr(data-match-count);position:absolute;right:0.6em;top:1.4em;font-size:0.8em;transform:translateY(-50%);color:var(--cs-hint-char-color, grey)}.search-bar.svelte-1ytln9p input.svelte-1ytln9p.svelte-1ytln9p{width:100%;padding:8px 12px;border:none;border-radius:10px;background-color:var(--cs-search-bar-bgc, #20202066);box-shadow:0 2px 4px rgba(0, 0, 0, 0.07),
			0 2px 3px rgba(0, 0, 0, 0.1)}.result-items.svelte-1ytln9p.svelte-1ytln9p.svelte-1ytln9p{display:flex;flex-direction:column;height:70vh;margin-top:0.15em}.result-items.svelte-1ytln9p ul.svelte-1ytln9p.svelte-1ytln9p{padding:0 0.5em 0 0;margin-bottom:0;width:97%;overflow-x:hidden}.result-items.svelte-1ytln9p ul.svelte-1ytln9p button.svelte-1ytln9p{align-items:center;justify-content:left;padding:0.65em;margin:0.5em 0 0 0.15em;width:25.35vw;height:fit-content;text-align:left;background-color:var(--cs-pane-bgc, #20202066);border-radius:4px;cursor:pointer}.result-items.svelte-1ytln9p ul.svelte-1ytln9p button.svelte-1ytln9p:hover,.result-items.svelte-1ytln9p ul.svelte-1ytln9p button.selected.svelte-1ytln9p{background-color:var(--cs-item-selected-color, rgba(85, 85, 85, 0.35))}.result-items.svelte-1ytln9p ul button .line-item.svelte-1ytln9p.svelte-1ytln9p,.result-items.svelte-1ytln9p ul button .file-item.svelte-1ytln9p.svelte-1ytln9p{text-wrap:wrap;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}.result-items.svelte-1ytln9p ul button .file-item.svelte-1ytln9p.svelte-1ytln9p{-webkit-line-clamp:6}.result-items.svelte-1ytln9p ul button .file-item span.filename.svelte-1ytln9p.svelte-1ytln9p{margin-top:-0.2em;display:block}.result-items.svelte-1ytln9p ul button .file-item span.file-folder-path.svelte-1ytln9p.svelte-1ytln9p{color:var(--cs-secondary-font-color, #a29c9c);display:block}.right-pane.svelte-1ytln9p.svelte-1ytln9p.svelte-1ytln9p{background-color:var(--cs-pane-bgc, #20202066);border-radius:6px;height:73.97vh;width:60%}.right-pane.svelte-1ytln9p .preview-container.svelte-1ytln9p.svelte-1ytln9p{margin:0.7em 0 0 0.7em;height:72.5vh;overflow-y:auto}.right-pane.svelte-1ytln9p .preview-container p.svelte-1ytln9p.svelte-1ytln9p,.right-pane.svelte-1ytln9p .preview-container ul.svelte-1ytln9p.svelte-1ytln9p{margin:0;padding:0;overflow-x:hidden}.right-pane.svelte-1ytln9p .preview-container p.svelte-1ytln9p.svelte-1ytln9p{width:39.7vw}.right-pane.svelte-1ytln9p .preview-container ul button.file-sub-item.svelte-1ytln9p.svelte-1ytln9p{text-wrap:wrap;display:block;text-overflow:ellipsis;justify-content:left;margin-bottom:1em;height:fit-content;width:39.2vw;text-align:left;background-color:var(--cs-pane-bgc, #20202066);border-radius:4px;font-size:medium}.right-pane.svelte-1ytln9p .preview-container ul button.file-sub-item.selected.svelte-1ytln9p.svelte-1ytln9p{background-color:var(--cs-item-selected-color, rgba(85, 85, 85, 0.35))}.right-pane.svelte-1ytln9p .preview-container.svelte-1ytln9p span.matched-line{display:inline-block;width:100%}.right-pane.svelte-1ytln9p .preview-container.svelte-1ytln9p span.matched-line.highlight-bg{background-color:var(--cs-hint-char-color, #468eeb33)}`)}function Ac(n,e,t){let r=n.slice();return r[34]=e[t],r[35]=e,r[36]=t,r}function Tc(n,e,t){let r=n.slice();return r[37]=e[t],r[38]=e,r[36]=t,r}function cm(n){let e,t,r=n[37].basename+Js+(n[37].extension==="md"?"":n[37].extension)+"",i,s,o=n[37].folderPath+"",a;return{c(){e=ye("span"),t=ye("span"),i=Vn(),s=ye("span"),a=ss(o),ve(t,"class","filename svelte-1ytln9p"),ve(s,"class","file-folder-path svelte-1ytln9p"),ve(e,"class","file-item svelte-1ytln9p")},m(l,u){We(l,e,u),Te(e,t),t.innerHTML=r,Te(e,i),Te(e,s),Te(s,a)},p(l,u){u[0]&8&&r!==(r=l[37].basename+Js+(l[37].extension==="md"?"":l[37].extension)+"")&&(t.innerHTML=r),u[0]&8&&o!==(o=l[37].folderPath+"")&&vc(a,o)},d(l){l&&Re(e)}}}function fm(n){let e,t=n[37].line.text+"";return{c(){e=ye("span"),ve(e,"class","line-item svelte-1ytln9p")},m(r,i){We(r,e,i),e.innerHTML=t},p(r,i){i[0]&8&&t!==(t=r[37].line.text+"")&&(e.innerHTML=t)},d(r){r&&Re(e)}}}function Cc(n){let e,t,r=n[38],i=n[36],s,o;function a(p,m){if(p[37]instanceof zt)return fm;if(p[37]instanceof kn)return cm}let l=a(n,[-1,-1]),u=l&&l(n),c=()=>n[16](e,r,i),h=()=>n[16](null,r,i);function f(...p){return n[17](n[36],...p)}function d(...p){return n[18](n[36],...p)}return{c(){e=ye("button"),u&&u.c(),t=Vn(),ve(e,"class","svelte-1ytln9p"),jr(e,"selected",n[36]===n[4])},m(p,m){We(p,e,m),u&&u.m(e,null),Te(e,t),c(),s||(o=[Ut(e,"click",f),Ut(e,"contextmenu",d)],s=!0)},p(p,m){n=p,l===(l=a(n,m))&&u?u.p(n,m):(u&&u.d(1),u=l&&l(n),u&&(u.c(),u.m(e,t))),(r!==n[38]||i!==n[36])&&(h(),r=n[38],i=n[36],c()),m[0]&16&&jr(e,"selected",n[36]===n[4])},d(p){p&&Re(e),u&&u.d(),h(),s=!1,Tt(o)}}}function Fc(n){let e,t;function r(o,a){if(o[2]===1)return dm;if(o[2]===2)return hm}let i=r(n,[-1,-1]),s=i&&i(n);return{c(){e=ye("div"),t=ye("div"),s&&s.c(),ve(t,"class","preview-container svelte-1ytln9p"),ve(e,"class","right-pane svelte-1ytln9p")},m(o,a){We(o,e,a),Te(e,t),s&&s.m(t,null)},p(o,a){i===(i=r(o,a))&&s?s.p(o,a):(s&&s.d(1),s=i&&i(o),s&&(s.c(),s.m(t,null)))},d(o){o&&Re(e),s&&s.d()}}}function hm(n){let e;function t(s,o){return s[6]&&s[6].viewType==="markdown"?mm:pm}let r=t(n,[-1,-1]),i=r(n);return{c(){i.c(),e=Ra()},m(s,o){i.m(s,o),We(s,e,o)},p(s,o){r===(r=t(s,o))&&i?i.p(s,o):(i.d(1),i=r(s),i&&(i.c(),i.m(e.parentNode,e)))},d(s){i.d(s),s&&Re(e)}}}function dm(n){let e,t=n[5]&&Ic(n);return{c(){t&&t.c(),e=Ra()},m(r,i){t&&t.m(r,i),We(r,e,i)},p(r,i){r[5]?t?t.p(r,i):(t=Ic(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){t&&t.d(r),r&&Re(e)}}}function pm(n){let e;return{c(){e=ye("span"),e.textContent=`${yt?"no result or to be impl":"no matched content"}`},m(t,r){We(t,e,r)},p:At,d(t){t&&Re(e)}}}function mm(n){let e,t=n[7],r=[];for(let i=0;i<t.length;i+=1)r[i]=Pc(Ac(n,t,i));return{c(){e=ye("ul");for(let i=0;i<r.length;i+=1)r[i].c();ve(e,"class","svelte-1ytln9p")},m(i,s){We(i,e,s);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(e,null)},p(i,s){if(s[0]&12672){t=i[7];let o;for(o=0;o<t.length;o+=1){let a=Ac(i,t,o);r[o]?r[o].p(a,s):(r[o]=Pc(a),r[o].c(),r[o].m(e,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=t.length}},d(i){i&&Re(e),La(r,i)}}}function Pc(n){let e,t,r=n[34].text+"",i,s=n[35],o=n[36],a,l;function u(...d){return n[20](n[36],...d)}function c(...d){return n[21](n[36],...d)}let h=()=>n[22](e,s,o),f=()=>n[22](null,s,o);return{c(){e=ye("button"),t=new rs(!1),i=Vn(),t.a=i,ve(e,"class","file-sub-item svelte-1ytln9p"),jr(e,"selected",n[36]===n[8])},m(d,p){We(d,e,p),t.m(r,e),Te(e,i),h(),a||(l=[Ut(e,"click",u),Ut(e,"contextmenu",c)],a=!0)},p(d,p){n=d,p[0]&128&&r!==(r=n[34].text+"")&&t.p(r),(s!==n[35]||o!==n[36])&&(f(),s=n[35],o=n[36],h()),p[0]&256&&jr(e,"selected",n[36]===n[8])},d(d){d&&Re(e),f(),a=!1,Tt(l)}}}function Ic(n){let e,t,r;return{c(){e=ye("p"),ve(e,"class","svelte-1ytln9p")},m(i,s){We(i,e,s),e.innerHTML=n[5],t||(r=Ut(e,"contextmenu",n[19]),t=!0)},p(i,s){s[0]&32&&(e.innerHTML=i[5])},d(i){i&&Re(e),t=!1,r()}}}function gm(n){let e,t,r,i,s,o,a,l,u,c,h=n[3].items,f=[];for(let p=0;p<h.length;p+=1)f[p]=Cc(Tc(n,h,p));let d=n[1]!=="floatingWindow"&&Fc(n);return{c(){e=ye("div"),t=ye("div"),r=ye("div"),i=ye("input"),s=Vn(),o=ye("div"),a=ye("ul");for(let p=0;p<f.length;p+=1)f[p].c();l=Vn(),d&&d.c(),ve(i,"id","cs-search-input"),ve(i,"class","svelte-1ytln9p"),ve(r,"class","search-bar svelte-1ytln9p"),ve(r,"data-match-count",n[9]),ve(a,"class","svelte-1ytln9p"),ve(o,"class","result-items svelte-1ytln9p"),ve(t,"class","left-pane svelte-1ytln9p"),ve(e,"class","search-container svelte-1ytln9p")},m(p,m){We(p,e,m),Te(e,t),Te(t,r),Te(r,i),Na(i,n[0]),Te(t,s),Te(t,o),Te(o,a);for(let y=0;y<f.length;y+=1)f[y]&&f[y].m(a,null);Te(e,l),d&&d.m(e,null),u||(c=[Ut(i,"input",n[15]),Ut(i,"input",n[10])],u=!0)},p(p,m){if(m[0]&1&&i.value!==p[0]&&Na(i,p[0]),m[0]&512&&ve(r,"data-match-count",p[9]),m[0]&10266){h=p[3].items;let y;for(y=0;y<h.length;y+=1){let g=Tc(p,h,y);f[y]?f[y].p(g,m):(f[y]=Cc(g),f[y].c(),f[y].m(a,null))}for(;y<f.length;y+=1)f[y].d(1);f.length=h.length}p[1]!=="floatingWindow"?d?d.p(p,m):(d=Fc(p),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},i:At,o:At,d(p){p&&Re(e),La(f,p),d&&d.d(),u=!1,Tt(c)}}}function ym(n,e,t){let r,i=x(it),s=x(Kn),{uiType:o}=e,{onConfirmExternal:a}=e,{searchType:l}=e,{queryText:u}=e,c=new Map,h=new Bt("",[]),f=-1,d="",p=null,m=[],y,g=-1;function _(M){return pn(this,void 0,void 0,function*(){yield Br();let L=h.items;if(M>=0&&M<L.length){if(t(4,f=M),l===1){let H=L[M];t(5,d=H.context)}else if(l===2)t(6,p=L[M]),t(6,p.subItems=yield i.getFileSubItems(u,p),p),t(7,m=p.subItems),t(8,g=m.length>0?0:-1),yield Br(),s.scrollTo("start",m[g],"instant");else throw Error(`unsupported search type: ${l}`);yield Br(),s.scrollTo("center",L[M],"smooth")}else t(5,d=""),t(6,p=null),t(7,m=[]),t(4,f=-1),t(8,g=-1)})}let w=Pu(100,()=>b());function b(){return pn(this,void 0,void 0,function*(){if(c.has(u)){t(3,h=c.get(u)),yield _(0);return}if(l===1)t(3,h=yield i.searchInFile(u));else if(l===2)t(3,h=yield i.searchInVault(u));else throw Error(bn);c.set(u,h),yield _(0)})}function S(M){return pn(this,void 0,void 0,function*(){yield _(M)})}function A(){return pn(this,void 0,void 0,function*(){yield _(Math.min(f+1,h.items.length-1)),o==="floatingWindow"&&I(null)})}function T(){return pn(this,void 0,void 0,function*(){yield _(Math.max(f-1,0)),o==="floatingWindow"&&I(null)})}function F(M){t(8,g=M)}function k(){t(8,g=s.updateSubItemIndex(m,g,"next"))}function j(){t(8,g=s.updateSubItemIndex(m,g,"prev"))}function I(M){return pn(this,void 0,void 0,function*(){M==null||M.preventDefault();let L=h.items[f];yield s.handleConfirmAsync(a,h.sourcePath,l,L,g)})}os(()=>{P.trace("mounted element has been destroyed.")});function N(M,L){Wt.on(M,L),os(()=>{Wt.off(M,L)})}o==="floatingWindow"?(N(3,A),N(6,T)):(N(2,A),N(5,T),N(4,k),N(7,j),N(8,I)),s.focusInput(),b();function D(){u=this.value,t(0,u)}function z(M,L,H){Nr[M?"unshift":"push"](()=>{L[H].element=M,t(3,h)})}let J=(M,L)=>{S(M),o==="floatingWindow"&&I(null)},X=async(M,L)=>{await S(M),await I(L)},Z=M=>I(M),ne=(M,L)=>F(M),de=(M,L)=>{t(8,g=M),I(L)};function ot(M,L,H){Nr[M?"unshift":"push"](()=>{L[H].element=M,t(7,m)})}return n.$$set=M=>{"uiType"in M&&t(1,o=M.uiType),"onConfirmExternal"in M&&t(14,a=M.onConfirmExternal),"searchType"in M&&t(2,l=M.searchType),"queryText"in M&&t(0,u=M.queryText)},n.$$.update=()=>{if(n.$$.dirty[0]&24){e:t(9,r=`${f+1} / ${h.items.length}`)}},[u,o,l,h,f,d,p,m,g,r,w,S,F,I,a,D,z,J,X,Z,ne,de,ot]}var Ba=class extends is{constructor(e){super(),Ec(this,e,ym,gm,dc,{uiType:1,onConfirmExternal:14,searchType:2,queryText:0},um,[-1,-1])}},ls=Ba;var Le=class{toggle(e){if(e==="inFile")x($n).toggle();else throw Error(bn)}resetAllPositions(){let e=x(se).ui;e.inFileFloatingWindowLeft="2.7em",e.inFileFloatingWindowTop="2.5em",x(Le).toggle("inFile"),x(Le).toggle("inFile")}onunload(){x($n).onClose()}};Le=B([(0,Va.singleton)()],Le);var za=class{constructor(){this.isDragging=!1;this.dragStartX=0;this.dragStartY=0;this.uiSetting=x(se).ui;this.mountedElement=null;this.onClose=()=>{var e,t;document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),(e=this.mountedElement)==null||e.$destroy(),this.mountedElement=null,(t=this.containerEl)==null||t.remove()};this.handleMouseDown=e=>{this.isDragging=!0,this.containerEl.style.opacity="0.75",this.dragStartX=e.pageX-this.containerEl.offsetLeft,this.dragStartY=e.pageY-this.containerEl.offsetTop,e.preventDefault()};this.handleMouseMove=e=>{this.isDragging&&(this.containerEl.style.left=`${e.pageX-this.dragStartX}px`,this.containerEl.style.top=`${e.pageY-this.dragStartY}px`)};this.handleMouseUp=()=>{this.isDragging=!1,this.containerEl.style.opacity="1",this.saveContainerElStates(),x(st).postSettingUpdated()}}toggle(){if(this.mountedElement!==null)return this.onClose(),this;this.containerEl=document.body.createDiv(),this.frameEl=this.containerEl.createDiv(),this.contentEl=this.containerEl.createDiv(),this.frameEl.addEventListener("mousedown",this.handleMouseDown),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp),this.containerEl.addClass("cs-floating-window-container"),this.containerEl.style.position="fixed",this.loadContainerElStates(),this.containerEl.style.zIndex="20",this.containerEl.style.border="1px solid #454545",this.containerEl.style.borderRadius="10px",this.containerEl.style.overflow="hidden",this.containerEl.style.boxShadow="0 2px 4px rgba(0,0,0,0.2)",this.frameEl.style.width="100%",this.frameEl.style.height="20px",this.frameEl.style.backgroundColor="#333",this.frameEl.style.cursor="move",this.frameEl.style.color="#fff",this.frameEl.style.display="flex",this.frameEl.style.alignItems="center",this.frameEl.style.justifyContent="right",this.frameEl.style.padding="10px 0 10px 10px";let e=this.frameEl.createSpan();return e.innerText="\u2716",e.style.cursor="pointer",e.style.fontSize="13px",e.style.margin="5px",e.addEventListener("click",this.onClose),this.contentEl.style.padding="10px 0 10px 10px",this.mountComponent(),this}},$n=class extends za{mountComponent(){this.mountedElement=new ls({target:this.contentEl,props:{uiType:"floatingWindow",onConfirmExternal:()=>{},searchType:1,queryText:""}})}loadContainerElStates(){this.containerEl.style.top=this.uiSetting.inFileFloatingWindowTop,this.containerEl.style.left=this.uiSetting.inFileFloatingWindowLeft}saveContainerElStates(){this.uiSetting.inFileFloatingWindowLeft=this.containerEl.style.left,this.uiSetting.inFileFloatingWindowTop=this.containerEl.style.top}};$n=B([(0,Va.singleton)()],$n);var Mc=require("obsidian");var Wn=class extends Mc.Modal{constructor(t,r,i){var a;super(t);let s=((a=window.getSelection())==null?void 0:a.toString())||"",o=i||s;this.modalEl.replaceChildren(),this.modalEl.addClass("cs-modal"),this.mountedElement=new ls({target:this.modalEl,props:{uiType:"modal",onConfirmExternal:()=>this.close(),searchType:r,queryText:o||""}}),new us(this.scope).registerAll()}onOpen(){}onClose(){this.mountedElement.$destroy()}};var $a=ue(fe());var Oc=ue(fe());var Ht=class{constructor(){this.privacyModeEnabled=!1;this.plugin=x(Un)}togglePrivacyMode(){this.privacyModeEnabled=!this.privacyModeEnabled,this.privacyModeEnabled?document.body.classList.add("cs-privacy-blur"):document.body.classList.remove("cs-privacy-blur")}init(){this.watchSelectionAndAutoCopy()}watchSelectionAndAutoCopy(){this.plugin.registerDomEvent(document,"mousedown",e=>{vm(e,["cs-modal","cs-floating-window-container"])&&document.addEventListener("mouseup",()=>{_m()},{once:!0})})}};Ht=B([(0,Oc.singleton)()],Ht);function vm(n,e){let t=n.target;for(;t;){if(e.some(r=>t==null?void 0:t.classList.contains(r)))return!0;t=t.parentElement}return!1}function _m(){let n=window.getSelection();if(n&&n.rangeCount>0){let t=n.getRangeAt(0).toString();t&&navigator.clipboard.writeText(t).then(()=>P.debug(`selection copied: ${t}`))}}var qt=class{constructor(){this.plugin=x(et);this.setting=x(se);this.app=x(Ka.App);x(Hn).registerAll()}addDevCommands(){yt&&(this.addCommand({id:"cs-in-file-search-floating-window",name:"In file search - floating window",callback:()=>x(Le).toggle("inFile")}),this.addCommand({id:"clever-search-triggerTest",name:"clever-search-triggerTest",callback:async()=>await oc()}),this.addCommand({id:"cs-open-test-modal",name:"Open test modal",callback:()=>this.plugin.openTestModal()}))}addCommandsWithoutDependency(){this.addCommand({id:"clever-search-in-file",name:"Search in file",callback:()=>{this.setting.ui.floatingWindowForInFile?x(Le).toggle("inFile"):new Wn(this.app,1).open()}}),this.addCommand({id:"cs-toggle-privacy-mode",name:"Toggle privacy mode",callback:()=>x(Ht).togglePrivacyMode()})}addInVaultLexicalCommands(){this.addCommand({id:"clever-search-in-vault",name:"Search in Vault",callback:()=>{Wt.emit(9),new Wn(this.app,2).open()}}),this.addCommand({id:"cs-in-file-search-with-omnisearch-query",name:"Search in file with last Omnisearch query",callback:async()=>{new Wn(this.app,1,await x(rt).getLastQuery()).open()}})}onunload(){x(Hn).unregisterAll()}addCommand(e){this.plugin.addCommand(e)}};qt=B([(0,$a.singleton)()],qt);function bm(n){return e=>{e.preventDefault(),Wt.emit(n),console.log("emit...")}}var cs=class{constructor(e){this.handlers=[];this.scope=e}unregisterAll(){this.handlers.forEach(e=>{this.scope.unregister(e)}),this.handlers=[]}register(e,t,r){this.handlers.push(this.scope.register(e,t,bm(r)))}},Hn=class extends cs{constructor(){super(x(Ka.App).scope)}registerAll(){let e=io;this.handlers=[],this.register([e],"J",3),this.register([e],"K",6)}};Hn=B([(0,$a.singleton)()],Hn);var us=class extends cs{constructor(e){super(e)}registerAll(){let e=io;this.register([e],"J",2),this.register([e],"K",5),this.register([],"ArrowDown",2),this.register([],"ArrowUp",5),this.register([],"Enter",8),this.register([e],"N",4),this.register([e],"P",7)}};var gn=class{async onload(){await x(st).initAsync(),x(De).init(),x(qt).addCommandsWithoutDependency(),await x(Be).initAsync(),await x(tt).initAsync(),await x(jt).createChildThreads(),x(Ht).init()}async onLayoutReady(){await x($e).initAsync(),await x(rt).initAsync();let e=x(qt);e.addInVaultLexicalCommands(),e.addDevCommands()}onunload(){x(qt).onunload(),x($e).onunload(),x(Le).onunload()}onAppQuit(){}};gn=B([(0,kc.singleton)()],gn);var Un=class extends pe.Plugin{async onload(){fs.container.register(et,{useValue:this}),fs.container.register(pe.App,{useValue:this.app}),fs.container.register(pe.Vault,{useValue:this.app.vault});let e=x(gn);await e.onload(),this.app.workspace.onLayoutReady(()=>{e.onLayoutReady()}),this.registerEvent(this.app.workspace.on("quit",()=>e.onAppQuit(),this))}onunload(){document.body.classList.remove("cs-privacy-blur"),x(gn).onunload()}openTestModal(){let e=this.app.workspace.getActiveViewOfType(pe.MarkdownView);if(e){let t="",r=e.contentEl.querySelector(".markdown-source-view");if(r){let s=document.createElement("div");s.appendChild(r.cloneNode(!0)),t=s.innerHTML}new Ua(this.app,t).open()}else throw Error("no active MarkdownView")}exampleCode(){this.addRibbonIcon("dice","Sample Plugin",r=>{new pe.Notice("This is a notice!")}).addClass("my-plugin-ribbon-class"),this.addStatusBarItem().setText("Status Bar Text"),this.addCommand({id:"open-sample-modal-simple",name:"Open sample modal (simple)",callback:()=>{new Wa(this.app).open()}}),this.addCommand({id:"sample-editor-command",name:"Sample editor command",editorCallback:r=>{console.log(r.getSelection()),r.replaceSelection("Sample Editor Command")}}),this.registerDomEvent(document,"click",r=>{console.log("click",r)}),this.registerInterval(window.setInterval(()=>console.log("setInterval"),5*60*1e3))}},Wa=class extends pe.Modal{constructor(e){super(e)}onOpen(){let{contentEl:e}=this;e.setText("Woah!")}onClose(){let{contentEl:e}=this;e.empty()}},Ua=class extends pe.Modal{constructor(t,r){super(t);this.contentHTML=r}onOpen(){pe.MarkdownView,pe.HoverPopover,console.log(this.contentHTML),this.containerEl.style.backgroundColor="black",this.containerEl.innerHTML=this.contentHTML}onClose(){let{contentEl:t}=this;t.empty()}},es=class extends pe.Modal{constructor(t,r){super(t);this.mdContent=r}onOpen(){this.containerEl.empty(),this.containerEl.style.display="block",this.containerEl.style.overflow="auto",this.containerEl.style.backgroundColor="black",pe.MarkdownRenderer.render(x(pe.App),this.mdContent,this.containerEl,"",new pe.Component)}onClose(){}};0&&(module.exports={RenderMarkdownModal});
/*! Bundled license information:

tslib/tslib.es6.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

fzf/dist/fzf.es.js:
  (** @license
   * fzf v0.5.2
   * Copyright (c) 2021 Ajit
   * Licensed under BSD 3-Clause
   *)
*/
